<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Wacky AI هَـبَـل</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Rakkas&amp;family=Tajawal:wght@300;400;500;700&amp;family=Inter:wght@300;400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
<style>
        :root {
            /* Original Colors */
            --button-bg-color-light: #3b82f6;
            --button-bg-color-dark: #60a5fa;
            --button-text-color-light: #ffffff;
            --button-text-color-dark: #111827;

            --input-bg-light: #ffffff;
            --input-text-light: #1f2937;
            --input-placeholder-light: #9ca3af;
            --input-border-light: #d1d5db;

            --input-bg-dark: #374151;
            --input-text-dark: #f3f4f6;
            --input-placeholder-dark: #9ca3af;
            --input-border-dark: #4b5563;

            --header-icon-color-light-initial: #ffffff;
            --header-icon-color-light-chat: #374151; /* This is rgba(55, 65, 81, 1) */
            --header-icon-color-dark: #d1d5db;

            --header-text-color-light: var(--button-bg-color-light);
            --header-text-color-dark: var(--button-bg-color-dark);

            --chat-bubble-user-bg-light: #3b82f6; 
            --chat-bubble-user-text-light: #ffffff; 
            --chat-bubble-ai-bg-light: #e5e7eb; 
            --chat-bubble-ai-text-light: #1f2937; 

            --chat-bubble-user-bg-dark: #2563eb; 
            --chat-bubble-user-text-dark: #eff6ff; 
            --chat-bubble-ai-bg-dark: #4b5563; 
            --chat-bubble-ai-text-dark: #f3f4f6; 


            --card-bg-light: rgba(255, 255, 255, 0.3);
            --card-bg-dark: rgba(26, 32, 44, 0.3);
            
            --settings-header-bg-light: #f9fafb;
            --settings-header-bg-dark: #1f2937;

            --text-color-light: #1a202c;
            --text-color-dark: #f3f4f6;
            
            /* UPDATED: Previous Chat Item Backgrounds */
            --chat-item-bg-light: #ffffff;
            --chat-item-bg-dark: #374151; /* Match other dark inputs */
            --chat-item-hover-bg-light: #f3f4f6; /* A bit darker white */
            --chat-item-hover-bg-dark: #4b5563; /* A bit lighter dark */


            /* Fixed Values */
            --main-title-y-fixed: -14px;
            --subtitle-y-fixed: -9px;
            --input-y-fixed: -5px;
            --send-btn-y-fixed: 0px;

            --bot-gif-x-fixed: 57%; 
            --bot-gif-y-fixed: 7%;  
            --bot-gif-size-fixed: 135px;
            --settings-panel-blur-fixed: 20px;

            --initial-view-elements-offset: 0px;

            --chat-title-size-fixed: 1.625rem;
            --chat-main-title-y-fixed: 5px; 
            --chat-header-padding-fixed: 0.5rem;

            /* Game View Specific CSS Variables - Fixed values */
            --game-return-btn-y: 90%; 
            --game-return-btn-size: 64px; 
            --game-box-main-width: 95%;
            --game-box-main-height: 84%;
            --game-box-main-y: 41%;
        }

        html { height: 100%; }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #000; /* Fallback, videos will cover */
            color: var(--text-color-dark);
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
            overflow: hidden; 
            margin: 0; padding: 0;
            position: relative;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        .font-rakkas { font-family: 'Rakkas', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-tajawal-bold { font-family: 'Tajawal', sans-serif; font-weight: 700; }

        .bg-video-element {
            position: fixed; top: 0; left: 0;
            min-width: 100%; min-height: 100%;
            width: auto; height: auto;
            z-index: -2;
            object-fit: cover;
            display: none; 
            opacity: 0; 
            transition: opacity 0.6s ease; 
        }
        .bg-video-element.video-visible {
            opacity: 1; 
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.55);
            z-index: -1;
            transition: background-color 0.5s ease;
        }
        body.light .overlay { background-color: rgba(0, 0, 0, 0.25); }
        body.dark .overlay { background-color: rgba(0, 0, 0, 0.65); }

        body.light { color: var(--text-color-light); }

        .themed-input {
            background-color: var(--current-input-bg) !important;
            color: var(--current-input-text) !important;
            border-color: var(--current-input-border) !important;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        .themed-input::placeholder { color: var(--current-input-placeholder) !important; opacity: 1; }
        .themed-input:-ms-input-placeholder { color: var(--current-input-placeholder) !important; }
        .themed-input::-ms-input-placeholder { color: var(--current-input-placeholder) !important; }

        body.light .themed-input {
            --current-input-bg: var(--input-bg-light); --current-input-text: var(--input-text-light);
            --current-input-placeholder: var(--input-placeholder-light); --current-input-border: var(--input-border-light);
        }
        body.dark .themed-input {
            --current-input-bg: var(--input-bg-dark); --current-input-text: var(--input-text-dark);
            --current-input-placeholder: var(--input-placeholder-dark); --current-input-border: var(--input-border-dark);
        }

        .header-icon {
            transition: color 0.3s ease, transform 0.1s ease;
            position: relative;
            padding: 0.5rem; 
            border-radius: 9999px; 
        }
        .header-icon:hover { background-color: rgba(255,255,255,0.1); }
        body.light #main-header:not(.chat-active) .header-icon,
        body.light #game-view-header .header-icon { color: var(--header-icon-color-light-initial) !important; }
        
        body.light #main-header.chat-active .header-icon { color: var(--header-icon-color-light-chat) !important; }
        body.dark .header-icon { color: var(--header-icon-color-dark) !important; } 
        
        #settings-toggle-btn svg, #new-chat-btn svg,
        #game-settings-btn svg, #game-new-chat-btn svg { 
            transform: none !important; 
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(128, 128, 128, 0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(128, 128, 128, 0.4); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(128, 128, 128, 0.6); }
        .no-scrollbar { scrollbar-width: none; -ms-overflow-style: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        .popup-scale-transition { transition: opacity 0.25s ease, transform 0.25s ease; }
        .popup-hidden { opacity: 0; transform: scale(0.95) translateY(10px); pointer-events: none; visibility: hidden; }
        .popup-visible { opacity: 1; transform: scale(1) translateY(0px); pointer-events: auto; visibility: visible; }

        .page-loader-container {
          position: fixed; top: 0; left: 0;
          width: 100%; height: 100%;
          background-image: url('https://dl.dropbox.com/scl/fi/3keggzqnxwb8eyio37pe2/20250603_185117.gif?rlkey=lw1psw33uejdac853bvj6egrm&st=g9rju0bw&dl=0');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
          display: flex; 
          flex-direction: column; 
          align-items: center; 
          justify-content: center;
          z-index: 10000; 
          transition: opacity 0.6s ease, visibility 0.6s ease;
          opacity: 1;
          visibility: visible;
        }
        .page-loader-container.hide {
          opacity: 0;
          visibility: hidden;
          pointer-events: none;
        }
       
        .loader-progress-wrapper {
          width: 80%; max-width: 400px;
          height: 20px;
          background: rgba(51, 51, 51, 0.6); 
          border-radius: 10px;
          overflow: hidden;
          border: 1px solid rgba(255,255,255,0.15); 
          box-shadow: 0 2px 8px rgba(0,0,0,0.4); 
          position: relative; 
          z-index: 2; 
        }
        .loader-progress-bar-fill {
          width: 0%; height: 100%;
          background: #3b82f6; 
          transition: width 0.2s ease;
        }

        #app-view-container {
            flex-grow: 1;
            overflow-y: auto; 
            display: flex;
            flex-direction: column;
            width: 100%;
            transition: opacity 0.6s ease, padding-bottom 0.2s ease-out; 
            opacity: 0; 
            visibility: hidden; 
        }
        #app-view-container.content-visible {
            opacity: 1;
            visibility: visible;
        }

        #main-header, #game-view-header { 
            width: 100%; max-width: 48rem; 
            margin-left: auto; margin-right: auto; padding: 1rem;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            z-index: 20; 
            flex-shrink: 0;
            transition: all 0.3s ease-in-out, transform 0.15s ease-out;
        }
        
        #game-view-header { 
            position: relative; 
        }

        html[dir="rtl"] #main-header,
        html[dir="rtl"] #game-view-header {
            flex-direction: row-reverse;
        }
        #main-header.chat-active { 
            position: sticky; top: 0;
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            transform: translateY(0px) !important;
            padding-top: var(--chat-header-padding-fixed) !important;
            padding-bottom: var(--chat-header-padding-fixed) !important;
        }
        body.light #main-header.chat-active { background-color: var(--card-bg-light); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        body.dark #main-header.chat-active { background-color: var(--card-bg-dark); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }


        #main-header.chat-active #main-title-wrapper,
        #game-view-header #game-title-wrapper { 
            flex-grow: 1; text-align: center; 
        }
        #main-header.chat-active #main-title-wrapper,
        #game-view-header #game-title-wrapper { 
            flex-grow: 1; text-align: center; 
        }
        #main-header.chat-active #main-title-wrapper {
             transform: translateY(var(--chat-main-title-y-fixed)) !important;
        }
         #game-view-header #game-title-wrapper { 
            transform: translateY(calc(var(--chat-main-title-y-fixed) * 0.5)); 
        }

        #main-header.chat-active #main-title.chat-active-title { 
            font-size: var(--chat-title-size-fixed);
            text-shadow: none;
            -webkit-text-stroke-width: 0.5px;
            -webkit-text-stroke-color: rgba(0,0,0,0.7);
            text-stroke-width: 0.5px;
            text-stroke-color: rgba(0,0,0,0.7);
            paint-order: stroke fill;
        }
        body.light #main-header.chat-active #main-title.chat-active-title {
            -webkit-text-stroke-width: 5px !important; 
            text-stroke-width: 5px !important; 
            -webkit-text-stroke-color: rgba(55, 65, 81, 1) !important;
            text-stroke-color: rgba(55, 65, 81, 1) !important;
        }
        #main-header.chat-active #main-title.chat-active-title .title-text-en {
            font-size: calc(var(--chat-title-size-fixed) * 0.8);
        }
        #game-view-header #game-main-title {
            font-size: var(--chat-title-size-fixed);
            text-shadow: none; 
            -webkit-text-stroke-width: 3px; 
            text-stroke-width: 3px; 
            paint-order: stroke fill; 
        }
        body.light #game-view-header #game-main-title { 
            color: var(--button-bg-color-light); 
            -webkit-text-stroke-color: white; 
            text-stroke-color: white; 
        }
        body.dark #game-view-header #game-main-title { 
            color: var(--button-bg-color-dark); 
            -webkit-text-stroke-color: transparent; 
            text-stroke-color: transparent;
        }
        #game-view-header #game-main-title .title-text-en {
            font-size: calc(var(--chat-title-size-fixed) * 0.8);
        }


        #initial-view, #game-view { 
            display: flex; flex-direction: column;
            flex-grow: 1; width: 100%;
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, visibility 0.4s ease-out;
            z-index: 5;
            padding: 0;
            position: relative;
        }
        #initial-view-content {
             padding-top: calc(max(5vh, 2rem));
             padding-bottom: 1rem; 
             padding-left: 1rem; padding-right: 1rem;
             width: 100%;
             display: flex;
             flex-direction: column;
             align-items: center;
             text-align: center;
             flex-grow: 1; 
             justify-content: flex-start; 
             position: relative; 
        }

        #initial-view.hidden-animated, #game-view.hidden-animated {
            opacity: 0; transform: translateY(-20px); pointer-events: none; visibility: hidden; display: none !important;
        }

        #bot-gif-container {
            position: absolute;
            top: var(--bot-gif-y-fixed); 
            left: var(--bot-gif-x-fixed);
            transform: translate(-50%, -50%) translateY(var(--initial-view-elements-offset));
            z-index: 1;
            transition: transform 0.15s ease-out, top 0.3s ease-out, left 0.3s ease-out;
        }
        #bot-gif {
            width: var(--bot-gif-size-fixed);
            height: auto;
            display: block;
        }

        #main-title-wrapper { 
            width: 100%; text-align: center; position: relative;
            z-index: 10;
            transform: translateY(calc(var(--main-title-y-fixed) + var(--initial-view-elements-offset)));
            transition: all 0.3s ease-in-out, transform 0.15s ease-out;
        }
        #main-title { 
            transition: all 0.3s ease-in-out;
            display: inline-block; font-size: 5.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,1);
        }
        body.light #main-title { color: var(--button-bg-color-light); }
        body.dark #main-title { color: var(--button-bg-color-dark); }
        #main-title .title-text-en { font-size: 5rem; }

        #main-subtitle {
            font-family: 'Tajawal', sans-serif; font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,1);
            margin-top: 1.5rem;
            margin-bottom: 1.5rem; font-size: 1.75rem;
            position: relative; z-index: 10;
            transform: translateY(calc(var(--subtitle-y-fixed) + var(--initial-view-elements-offset)));
            transition: transform 0.15s ease-out;
        }
        body.light #main-subtitle { color: #2dd4bf; }
        body.dark #main-subtitle { color: #34d399; }

        .auto-grow-textarea {
            overflow-y: hidden;
            resize: none; min-height: 44px;
            padding-top: 10px; padding-bottom: 10px;
            line-height: 1.5;
            max-height: 150px; 
        }
        #initial-input {
            margin-bottom: 1.25rem;
            border: 1px solid;
            width: 100%; max-width: 28rem;
            border-radius: 0.75rem;
            position: relative; z-index: 10;
            transform: translateY(var(--input-y-fixed));
        }
        body.light #initial-input {
            background-color: #ffffff !important;
            color: #1f2937 !important;
            border-color: var(--input-border-light) !important;
        }
        body.light #initial-input::placeholder { color: var(--input-placeholder-light) !important; }

        #initial-send-btn {
            width: auto; padding: 0.85rem 2.5rem; font-size: 1.125rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, background-color 0.3s ease, color 0.3s ease;
            font-weight: 700;
            position: relative; z-index: 10;
            transform: translateY(var(--send-btn-y-fixed));
        }
        body.light #initial-send-btn { background-color: var(--button-bg-color-light); color: var(--button-text-color-light) !important; }
        body.dark #initial-send-btn { background-color: var(--button-bg-color-dark); color: var(--button-text-color-dark) !important; }
        #initial-send-btn:hover {
            transform: translateY(calc(var(--send-btn-y-fixed) - 1px));
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        #initial-send-btn:active { transform: translateY(var(--send-btn-y-fixed)); }

        #new-playstation-button { 
            position: relative; 
            display: flex; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            background-color: rgba(255, 80, 80, 0.85);
            border-radius: 50%; border: none;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 5; 
            transition: background-color 0.3s ease, transform 0.2s ease;
            padding: 5px;
            margin-top: 1.25rem; 
            align-self: center;
            /* تنزيل رفع زر اللعبة */
            transform: translateY(14px);
        }
        #new-playstation-button:hover {
            background-color: rgba(255, 60, 60, 0.95);
        }
        #new-playstation-button img {
            width: 30px;
            height: 30px;
            margin-bottom: 3px;
        }
        #new-playstation-button span {
            font-size: 0.7rem;
            color: white;
            font-weight: 500;
        }
        #new-playstation-button.keyboard-visible {
             opacity: 0 !important;
             visibility: hidden !important;
             pointer-events: none !important;
             display: none !important;
        }

        #chat-view {
            flex-grow: 1; display: flex; flex-direction: column;
            width: 100%; max-width: 48rem; margin: 0 auto;
            padding: 0 1rem; 
            overflow: hidden; 
            z-index: 10; 
        }
        #chat-view.hidden-animated { display: none !important; }

        #chat-messages { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0.5rem; 
            display: flex; 
            flex-direction: column; 
            gap: 0.75rem; 
        }
        #chat-messages::-webkit-scrollbar-thumb { background: var(--current-button-bg); }
        body.light #chat-messages::-webkit-scrollbar-thumb { --current-button-bg: var(--button-bg-color-light); }
        body.dark #chat-messages::-webkit-scrollbar-thumb { --current-button-bg: var(--button-bg-color-dark); }

        #chat-message-spacer { 
            flex-grow: 1;
            min-height: 0; 
        }

        .chat-bubble {
            padding: 0.875rem 1.25rem;
            border-radius: 1.25rem;
            max-width: 80%;
            word-wrap: break-word;
            backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.1);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .chat-bubble-user { 
            border-bottom-right-radius: 0.375rem; 
            background-color: var(--chat-bubble-user-bg-dark); 
            color: var(--chat-bubble-user-text-dark);
        }
        .chat-bubble-ai { 
            border-bottom-left-radius: 0.375rem; 
            background-color: var(--chat-bubble-ai-bg-dark); 
            color: var(--chat-bubble-ai-text-dark);
        }

        body.light .chat-bubble-user { background-color: var(--chat-bubble-user-bg-light); color: var(--chat-bubble-user-text-light); }
        body.light .chat-bubble-ai { background-color: var(--chat-bubble-ai-bg-light); color: var(--chat-bubble-ai-text-light); }
        
        html[dir="ltr"] .chat-bubble-user.self-end { 
            border-bottom-left-radius: 0.375rem; border-bottom-right-radius: 1.25rem;
        }
        html[dir="ltr"] .chat-bubble-ai.self-start { 
            border-bottom-right-radius: 0.375rem; border-bottom-left-radius: 1.25rem;
        }
        html[dir="rtl"] .chat-bubble-user.self-end { 
            border-bottom-right-radius: 0.375rem; border-bottom-left-radius: 1.25rem;
        }
         html[dir="rtl"] .chat-bubble-ai.self-start { 
            border-bottom-left-radius: 0.375rem; border-bottom-right-radius: 1.25rem;
        }


        .typing-indicator span {
            height: 8px; width: 8px; margin: 0 2px;
            background-color: currentColor;
            border-radius: 50%; display: inline-block;
            animation: typing-bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing-bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        /* MODIFIED: Wrapper for form and note */
        #chat-input-container {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            bottom: 0.75rem;
            width: calc(100% - 1.5rem);
            max-width: 48rem;
            z-index: 15;
            transition: bottom 0.2s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        #chat-input-form {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: 1.5rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            width: 100%;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        body.light #chat-input-form { background-color: var(--card-bg-light); }
        body.dark #chat-input-form { background-color: var(--card-bg-dark); }

        /* ADDED: Style for the new usage note */
        #chat-usage-note {
            font-size: 0.75rem;
            font-weight: 300;
            text-align: center;
            width: 100%;
            padding: 0 0.5rem;
            transition: color 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin-top: 0.35rem
        }
        body.light #chat-usage-note { color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }
        body.dark #chat-usage-note { color: rgba(255,255,255,0.7); }

        #chat-input {
            flex-grow: 1; padding: 0.625rem 1rem;
            border-radius: 1.25rem;
            border: 1px solid transparent;
            transition: all 0.3s ease-in-out;
        }
        #chat-send-btn {
            width: 2.75rem; height: 2.75rem;
            padding: 0;
            border-radius: 9999px;
            color: #ffffff;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; transition: background-color 0.2s ease, opacity 0.2s ease;
            align-self: flex-end;
            margin-bottom: 2px;
        }
        body.light #chat-send-btn { background-color: var(--button-bg-color-light); }
        body.dark #chat-send-btn { background-color: var(--button-bg-color-dark); }
        #chat-send-btn:hover { opacity: 0.85; }

        #app-footer-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 1rem;
            margin-top: 1.5rem; 
            flex-shrink: 0; 
            transition: opacity 0.2s ease-out, visibility 0.2s ease-out, display 0.2s ease-out;
            visibility: visible;
            opacity: 1;
            z-index: 5;
        }
        #app-footer-container.keyboard-visible {
             opacity: 0 !important;
             visibility: hidden !important;
             pointer-events: none !important;
             display: none !important;
        }
        #app-footer {
            text-align: center;
            font-size: 0.65rem;
        }
        body.light #app-footer { color: var(--header-icon-color-light-initial); text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }
        body.dark #app-footer { color: rgba(255,255,255,0.7); text-shadow: 1px 1px 3px rgba(0,0,0,0.7); }
        #app-footer p { margin-bottom: 0.25rem; }

        #instagram-icon svg { width: 26px; height: 26px; margin-top: 0.25rem; }
        body.light #instagram-icon svg { stroke: var(--header-icon-color-light-initial); }
        body.dark #instagram-icon svg { stroke: var(--header-icon-color-dark); }
        #settings-panel-container {
            position: fixed;
            top: 0;
            left: -280px; 
            width: 280px;
            max-width: 80%;
            height: 100%;
            z-index: 110;
            transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex;
            flex-direction: column;
        }
        #settings-panel-container.open {
            left: 0; 
        }

        #settings-panel-header {
            padding-top: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid;
            width: 100%;
            background-color: var(--settings-header-bg-dark);
            flex-shrink: 0;
            z-index: 2;
        }
        body.light #settings-panel-header {
            --current-settings-header-solid-bg: var(--settings-header-bg-light);
            --current-input-border-themed-settings: var(--input-border-light);
        }
        body.dark #settings-panel-header {
            --current-settings-header-solid-bg: var(--settings-header-bg-dark);
            --current-input-border-themed-settings: var(--input-border-dark);
        }

        #settings-panel-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 1rem;
            padding-right: 1rem;
        }
       
        #settings-panel {
            height: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 0;
            overflow: hidden;
            background-color: var(--card-bg-dark);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--input-border-dark);
        }
        body.light #settings-panel { background-color: var(--card-bg-light); border-color: var(--input-border-light); }
        
        #settings-panel-content {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
         #settings-scrollable-area {
            padding-top: 1.25rem; /* Added padding top */
            padding-bottom: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }


        #settings-panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--header-text-color-dark);
        }

        #close-settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
        }

        #close-settings-btn svg {
            stroke: var(--header-icon-color-dark);
        }

        .settings-group {
            padding: 0 1rem;
        }
        
        .settings-group-main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem; /* Space between groups */
        }

        .settings-group.about-links {
            margin-top: auto; /* Pushes this group to the bottom */
            padding-bottom: 1rem; /* Adds some space at the very end */
        }
        
        .settings-group h4, .settings-group .settings-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }

        .settings-group button, .settings-group select {
            width: 100%; padding: 0.75rem; text-align: start;
            border: 1px solid; border-radius: 0.5rem;
            cursor: pointer; font-size: 0.9rem;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        body.light .settings-group button:not(.active-setting-btn):hover, 
        body.light .settings-group select:hover { background-color: rgba(0,0,0,0.05); }
        body.dark .settings-group button:not(.active-setting-btn):hover, 
        body.dark .settings-group select:hover { background-color: rgba(255,255,255,0.08); }

        .active-setting-btn { font-weight: bold; box-shadow: inset 0 0 0 2px; }
        body.light .active-setting-btn { color: var(--button-bg-color-light) !important; border-color: var(--button-bg-color-light) !important; }
        body.dark .active-setting-btn { color: var(--button-bg-color-dark) !important; border-color: var(--button-bg-color-dark) !important; }
        
        .settings-divider { 
            height: 1px; 
            margin: 0.75rem 1rem; /* Adjusted margin */
            opacity: 0.5; 
        }
        body.light .settings-divider { background-color: var(--input-border-light); }
        body.dark .settings-divider { background-color: var(--input-border-dark); }
        .settings-group.about-links button {
             margin-bottom: 0.75rem;
        }

        .settings-group.about-links button:last-child {
            margin-bottom: 0;
        }
        
        /* START: PREVIOUS CHATS UPDATED STYLES V26 */
        [data-translate="longPressHint"] {
            transition: color 0.3s ease;
        }
        body.dark [data-translate="longPressHint"] { color: white; }
        body.light [data-translate="longPressHint"] { color: black; }

        #previous-chats-list {
            max-height: 22.5rem; /* ~8 items * (2.25rem height + 0.5rem gap) */
            overflow-y: auto;
            padding: 0.5rem;
            border-radius: 0.375rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem; /* Space between chat items */
            border: none;
            background-color: transparent;
        }

        .chat-history-item {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border-radius: 0.5rem; /* Slightly more rounded */
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            position: relative;
            background-color: var(--chat-item-bg-dark); /* Default for dark */
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid var(--input-border-dark);
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }
        body.light .chat-history-item {
             background-color: var(--chat-item-bg-light);
             border-color: var(--input-border-light);
             box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .chat-history-item:hover {
            background-color: var(--chat-item-hover-bg-dark); /* Default for dark */
        }
         body.light .chat-history-item:hover {
            background-color: var(--chat-item-hover-bg-light);
        }
        .chat-history-item:active {
            transform: scale(0.98);
        }

        .chat-history-title {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.875rem;
            text-align: right;
            margin-left: 0.75rem;
        }

        .pin-icon {
            width: 16px;
            height: 16px;
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.2s ease-in-out;
            color: #3b82f6;
        }
        .chat-history-item:hover .pin-icon {
            transform: translateY(-50%) scale(1.1);
        }

        /* Context Menu Styling */
        #chat-context-menu {
            min-width: 180px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 1001; /* Above settings panel & overlay */
            transition: background-color 0.3s ease, border-color 0.3s ease;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        body.light #chat-context-menu {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        body.dark #chat-context-menu {
            background-color: rgba(41, 52, 65, 0.8); /* #293441 */
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.3s ease;
        }
        body.light .context-menu-item { color: #374151; }
        body.dark .context-menu-item { color: #d1d5db; }

        body.light .context-menu-item:hover { background-color: rgba(0, 0, 0, 0.05); }
        body.dark .context-menu-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        
        #delete-chat-option { font-weight: 500; }
        body.light #delete-chat-option { color: #b91c1c; } /* red-800 */
        body.dark #delete-chat-option { color: #f87171; } /* red-400 */
        body.light #delete-chat-option:hover { background-color: #fee2e2 !important; color: #991b1b !important; }
        body.dark #delete-chat-option:hover { background-color: #7f1d1d !important; color: #fecaca !important; }

        .context-menu-item .icon-wrapper {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .context-menu-item .unpin-icon { opacity: 0.7; }

        /* Rename Modal - Polished */
        #rename-modal-overlay {
            display: flex;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: 1002; /* Highest layer */
        }
        #rename-modal {
            padding: 1.5rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 22rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 1px solid;
            transform: scale(1);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #rename-modal-overlay.popup-hidden #rename-modal {
            transform: scale(0.9);
        }
        body.light #rename-modal {
            background-color: #f9fafb;
            border-color: var(--input-border-light);
        }
         body.dark #rename-modal {
            background-color: #1f2937;
            border-color: var(--input-border-dark);
        }
        #rename-input {
            padding: 0.8rem 1rem !important;
            border-radius: 0.5rem !important;
            transition: border-color 0.2s ease, box-shadow 0.2s ease !important;
        }
        #rename-input:focus {
             border-color: var(--button-bg-color-dark) !important;
             box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.4) !important;
        }
         body.light #rename-input:focus {
             border-color: var(--button-bg-color-light) !important;
             box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3) !important;
        }


        #rename-modal h3 {
             font-size: 1.25rem;
             font-weight: 700;
             text-align: center;
             margin-bottom: 1.25rem;
             color: var(--header-text-color-dark);
        }
        body.light #rename-modal h3 {
             color: var(--header-text-color-light);
        }
        #rename-modal .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 0.75rem;
            margin-top: 1.25rem;
        }
        #rename-modal button {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s ease;
        }
        #rename-modal button:hover {
            opacity: 0.9;
        }
        #rename-modal button:active {
            transform: scale(0.96);
        }

        #rename-modal #cancel-rename-btn {
            background-color: #4b5563 !important;
        }
        body.light #rename-modal #cancel-rename-btn {
            background-color: #d1d5db !important;
            color: #4b5563 !important;
        }
        /* END: PREVIOUS CHATS UPDATED STYLES */
        
        #user-info-modal-overlay, #language-popup-overlay, #share-app-modal-overlay, #generic-info-modal-overlay, #custom-modal-overlay, #rating-modal-overlay, #habal-level-modal-overlay, #quota-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
            display: flex; align-items: center; justify-content: center;
            z-index: 120;
            backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
        }
        /* MODIFICATION: Increased blur and background opacity for language popup */
        #language-popup-overlay {
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #user-info-modal, #language-popup-modal, #share-app-modal, #generic-info-modal, #custom-modal, #rating-modal, #habal-level-modal, #quota-modal {
            padding: 1.5rem; border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 90%; max-width: 400px; border: 1px solid;
            position: relative;
        }
        body.light #user-info-modal, body.light #language-popup-modal, body.light #share-app-modal, body.light #generic-info-modal, body.light #custom-modal, body.light #rating-modal, body.light #habal-level-modal, body.light #quota-modal { background-color: var(--card-bg-light); border-color: var(--input-border-light); } 
        body.dark #user-info-modal, body.dark #language-popup-modal, body.dark #share-app-modal, body.dark #generic-info-modal, body.dark #custom-modal, body.dark #rating-modal, body.dark #habal-level-modal, body.dark #quota-modal { background-color: var(--card-bg-dark); border-color: var(--input-border-dark); } 

        #user-info-modal h3, #language-popup-modal #language-popup-title-text, #share-app-modal #share-app-modal-title-text, #generic-info-modal #generic-info-modal-title, #habal-level-modal-title, #custom-modal-title { 
            font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;
        }
        body.light #user-info-modal h3, body.light #language-popup-modal #language-popup-title-text, body.light #share-app-modal #share-app-modal-title-text, body.light #generic-info-modal #generic-info-modal-title, body.light #habal-level-modal-title, body.light #custom-modal-title { color: var(--header-text-color-light); }
        body.dark #user-info-modal h3, body.dark #language-popup-modal #language-popup-title-text, body.dark #share-app-modal #share-app-modal-title-text, body.dark #generic-info-modal #generic-info-modal-title, body.dark #habal-level-modal-title, body.dark #custom-modal-title { color: var(--header-text-color-dark); }

        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem; 
        }
        html[dir="rtl"] .modal-close-button {
            left: 0.75rem; right: auto;
        }
        body.light .modal-close-button svg { stroke: var(--header-icon-color-light-chat); }
        body.dark .modal-close-button svg { stroke: var(--header-icon-color-dark); }
        .modal-close-button:hover { background-color: rgba(0,0,0,0.1); }
        body.dark .modal-close-button:hover { background-color: rgba(255,255,255,0.1); }

        #user-info-modal label, #language-popup-modal label { display: block; margin-bottom: 0.5rem; font-weight: 500; } 
        #user-info-modal input[type="text"], #user-info-modal input[type="number"], #user-info-modal select,
        #language-popup-modal select { 
            width: 100%; padding: 0.75rem; margin-bottom: 1rem;
            border-radius: 0.5rem; border: 1px solid;
        }

        #user-info-modal .gender-options { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        #user-info-modal .gender-options label { margin-bottom: 0; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;}
        #user-info-modal input[type="radio"] { accent-color: var(--current-button-bg); }
        body.light #user-info-modal input[type="radio"] { --current-button-bg: var(--button-bg-color-light); }
        body.dark #user-info-modal input[type="radio"] { --current-button-bg: var(--button-bg-color-dark); }

        #user-info-modal .modal-buttons, #language-popup-modal .modal-buttons, #habal-level-modal .modal-buttons { display: flex; justify-content: space-between; gap: 1rem; margin-top:1rem; } 
        #user-info-modal .modal-buttons button,
        #language-popup-modal .modal-buttons button,
        #language-popup-modal #confirm-arabic-dialect-btn,
        #language-popup-modal #confirm-english-dialect-btn,
        #language-popup-modal #cancel-language-popup-btn,
        #habal-level-modal button {
            flex-grow: 1; padding: 0.75rem; border-radius: 0.5rem;
            font-weight: bold; border: none; cursor: pointer; transition: opacity 0.2s, background-color 0.3s, color 0.3s;
        }
        
        #share-app-modal .share-button {
            background-color: #3b82f6; 
            color: white;
            text-align: center !important;
            font-weight: bold;
            padding: 0.75rem 1rem !important;
            border-radius: 0.5rem; 
            border: none; 
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%; 
            margin-bottom: 0.5rem; 
        }
        #share-app-modal .share-button:hover {
            background-color: #2563eb; 
        }
        #share-app-modal .share-prompt-text {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        #user-info-modal .modal-buttons button:hover,
        #language-popup-modal .modal-buttons button:hover,
        #language-popup-modal #confirm-arabic-dialect-btn:hover,
        #language-popup-modal #confirm-english-dialect-btn:hover,
        #language-popup-modal #cancel-language-popup-btn:hover,
        #habal-level-modal button:hover { opacity: 0.85; } 

        body.light #popup-save-info-btn, body.light #confirm-arabic-dialect-btn, body.light #confirm-english-dialect-btn, body.light #confirm-habal-level-btn { background-color: var(--button-bg-color-light); color: var(--button-text-color-light); } 
        body.dark #popup-save-info-btn, body.dark #confirm-arabic-dialect-btn, body.dark #confirm-english-dialect-btn, body.dark #confirm-habal-level-btn { background-color: var(--button-bg-color-dark); color: var(--button-text-color-dark); } 
        body.dark #popup-skip-info-btn, body.dark #cancel-language-popup-btn, body.dark #cancel-habal-level-btn { background-color: #4b5563; color: #f3f4f6; } 

        /* Habal Level Modal Specifics */
        #habal-level-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        #habal-level-options button {
            background-color: transparent;
            border: 1px solid var(--current-input-border);
            color: var(--current-input-text);
            font-weight: 500;
        }
        #habal-level-options button.active-level {
            font-weight: bold;
            box-shadow: inset 0 0 0 2px;
            color: var(--current-button-bg-dynamic) !important;
            border-color: var(--current-button-bg-dynamic) !important;
        }
        body.light #habal-level-options button.active-level { --current-button-bg-dynamic: var(--button-bg-color-light); }
        body.dark #habal-level-options button.active-level { --current-button-bg-dynamic: var(--button-bg-color-dark); }
        
        #custom-modal {
             width: 90%; max-width: 360px;
             text-align: center;
        }
        #custom-modal-message { 
            margin-top: 0.5rem;
            margin-bottom: 1.5rem; 
            line-height: 1.6; 
        }
        #custom-modal-buttons { display: flex; gap: 0.75rem; justify-content: center; }
        #custom-modal-buttons button {
            padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-weight: 500;
            border: none; cursor: pointer; transition: opacity 0.2s;
        }
        #custom-modal-buttons button:hover { opacity: 0.8; }
        body.light .modal-ok-btn { background-color: var(--button-bg-color-light); color: var(--button-text-color-light); }
        body.dark .modal-ok-btn { background-color: var(--button-bg-color-dark); color: var(--button-text-color-dark); }

        body.light .modal-confirm-btn { background-color: #ef4444; color: white; }
        body.dark .modal-confirm-btn { background-color: #dc2626; color: white; }
        body.light .modal-cancel-btn { background-color: #9ca3af; color: white; }
        body.dark .modal-cancel-btn { background-color: #6b7280; color: white; }

        #settings-overlay {
            position: fixed; inset: 0; background-color: rgba(0,0,0,0.3);
            z-index: 109;
            opacity: 0; transition: opacity 0.3s ease; pointer-events: none;
        }
        #settings-overlay.active { opacity: 1; pointer-events: auto; }

        #generic-info-modal-content {
            margin-top: 1rem;
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 0.5rem;
            direction: rtl;
        }
        html[dir="ltr"] #generic-info-modal-content {
             padding-right: 0;
             padding-left: 0.5rem;
             direction: ltr;
        }
        #generic-info-modal-text {
            line-height: 1.7;
            text-align: start;
        }

        /* Game View Specific Styles */
        #game-view {
        }
        #game-content-area {
            flex-grow: 1;
            position: relative; 
            display: flex; 
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        #return-to-initial-view-btn { 
            position: absolute;
            left: 50%; 
            top: var(--game-return-btn-y);
            width: var(--game-return-btn-size);
            height: var(--game-return-btn-size);
            /* رفع زر المحادثة قليلاً */
            transform: translate(-50%, -50%) translateY(-4px); 
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            transition: background-color 0.3s ease, transform 0.2s ease, width 0.2s ease, height 0.2s ease, top 0.2s ease;
            z-index: 20;
            padding: 5px; 
        }

        /* New style for the note under the game button */
        #game-usage-note {
            position: absolute;
            left: 50%;
            top: calc(var(--game-return-btn-y) + (var(--game-return-btn-size) / 2) + 5px); /* Position below the button */
            transform: translateX(-50%);
            font-size: 0.65rem; /* Smaller font size */
            font-weight: 300;
            text-align: center;
            width: 100%;
            padding: 0 0.5rem;
            transition: color 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        body.light #game-usage-note { color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }
        body.dark #game-usage-note { color: rgba(255,255,255,0.7); }


        #return-to-initial-view-btn img.chat-icon { 
            width: calc(var(--game-return-btn-size) * 0.5); 
            height: calc(var(--game-return-btn-size) * 0.5); 
            margin-bottom: calc(var(--game-return-btn-size) * 0.05); 
            object-fit: contain; 
        }
        #return-to-initial-view-btn span {
            font-size: calc(var(--game-return-btn-size) * 0.15); 
            font-weight: 500;
            text-align: center;
            color: white !important; 
        }

        #game-box-main { 
            position: absolute; 
            left: 50%;
            top: var(--game-box-main-y);
            width: var(--game-box-main-width);
            height: var(--game-box-main-height);
            transform: translate(-50%, -50%);
            border-radius: 0.75rem; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); 
            padding: 0 !important;
            transition: background-color 0.3s ease, color 0.3s ease, width 0.2s ease, height 0.2s ease, top 0.2s ease;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body.light #game-box-main {
            background-color: #ffffff;
            color: var(--text-color-light);
            border: 1px solid var(--input-border-light);
        }
        body.dark #game-box-main {
            background-color: #2d3748; 
            color: var(--text-color-dark);
            border: 1px solid var(--input-border-dark);
        }
        #interstitial-ad-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.85); 
            z-index: 20000;
            display: flex;
            align-items: center;
            justify-content: center;
        } 
        #interstitial-ad-content { 
            color: white; 
            text-align: center; 
            font-family: 'Tajawal', sans-serif; 
        } 
        #interstitial-ad-content h3 { 
            font-size: 1.75rem; 
            font-weight: bold; 
            margin-bottom: 1rem; 
        } 
        #ad-timer { 
            margin-top: 1.5rem; 
            font-size: 1.25rem; 
            font-weight: 500; 
        }
        
        #rating-modal {
            text-align: center;
        }
        #rating-modal h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        #rating-stars-container { 
            display: flex; 
            justify-content: center; 
            gap: 0.5rem; 
            margin-bottom: 1.5rem; 
            flex-direction: row-reverse;
        } 
        .rating-star { 
            font-size: 2.5rem; 
            color: #9ca3af;
            cursor: pointer; 
            transition: color 0.2s, transform 0.2s; 
        } 
        .rating-star:hover { 
            transform: scale(1.2); 
        } 
        .rating-star.active { 
            color: #f59e0b;
        }
        #submit-rating-btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s, background-color 0.3s, color 0.3s;
        }
        body.light #submit-rating-btn { background-color: var(--button-bg-color-light); color: var(--button-text-color-light); }
        body.dark #submit-rating-btn { background-color: var(--button-bg-color-dark); color: var(--button-text-color-dark); }
        #submit-rating-btn:hover { opacity: 0.85; }
        
        #advanced-stupidity-test-game {
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            position: relative;
            z-index: 10;
            padding: 1.5rem; border-radius: 0.75rem;
            background-color: transparent;
        }

        #gif-movable-container {
            position: absolute;
            width: 88px;
            right: 0px;
            bottom: -3px;
            z-index: 20; user-select: none; opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #gif-movable-container.visible { opacity: 1; }
        #game-background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.1; 
            pointer-events: none;    
            overflow: hidden;
            border-radius: 0.75rem;
        }
        #gameBackgroundGif { width: 100%; height: 100%; object-fit: cover; }
        #question-area-wrapper::-webkit-scrollbar { width: 8px; }
        #question-area-wrapper::-webkit-scrollbar-track { background: rgba(229, 231, 235, 0.5); border-radius: 10px; }
        #question-area-wrapper::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        #question-area-wrapper::-webkit-scrollbar-thumb:hover { background: #aaa; }
        #question-area-wrapper { scrollbar-width: thin; scrollbar-color: #ccc rgba(229, 231, 235, 0.5); }
        
        #score-box {
            height: 30px;      
            line-height: 30px; 
            text-align: center; 
            padding-left: 1rem;
            padding-right: 1rem;
        }
        #question-text {
            font-size: 17px !important;
        }
        .btn-option {
            background-color: #f3f4f6; 
            color: #374151; 
            border: 1px solid #d1d5db; 
            width: 100%;
            font-size: 15px !important; 
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-next {
            width: 222px;
            height: 30px;
        }
        
        .btn { font-weight: 600; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); transition: all 0.2s ease-in-out; transform: scale(1); border-radius: 0.5rem; }
        .btn:hover { transform: scale(1.05); }
        .btn:active { transform: scale(0.95); filter: brightness(0.9); }

        .btn-next { background-color: #DC2626; color: white; border-radius: 50px; }
        .btn-next:hover:not(:disabled) { background-color: #B91C1C; }
        body.dark .btn-option { background-color: #374151; color: #f3f4f6; border: 1px solid #4b5563; }
        .btn-option:hover { background-color: #e5e7eb; }
        body.dark .btn-option:hover { background-color: #4b5563; }

        .btn-option.correct { background-color: #3b82f6 !important; color: white !important; border-color: #2563eb !important; }
        .btn-option.incorrect { background-color: #DC2626 !important; color: white !important; border-color: #B91C1C !important; }
        .btn-option:disabled { opacity: 0.7; cursor: not-allowed; transform: scale(1); filter: none; }
        
        #explanation-modal-overlay { position: absolute; inset: 0; background-color: rgba(0, 0, 0, 0.4); backdrop-filter: blur(2px); z-index: 500; display: none; align-items: center; justify-content: center; padding: 1rem; border-radius: 0.75rem;}
        #explanation-modal-content { background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 90%; max-width: 400px; text-align: center; opacity: 0; transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out; transform: scale(0.9); }
        body.dark #explanation-modal-content { background-color: #2d3748; }
        #explanation-modal-content.visible { opacity: 1; transform: scale(1); }
        #explanation-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        body.light #explanation-modal-title {
            color: #2563eb; 
        }
        body.dark #explanation-modal-title {
            color: #60a5fa; 
        }
        
        #explanation-modal-title.error {
            color: #DC2626 !important; 
        }
        #explanation-modal-text { font-size: 1rem; margin-bottom: 1.25rem; line-height: 1.6; }
        body.light #explanation-modal-text { color: #374151; } body.dark #explanation-modal-text { color: #d1d5db; }
        #explanation-modal-close-btn { background-color: #3b82f6; color: white; border-radius: 9999px; padding: 0.75rem 1.5rem; font-weight: 600; transition: background-color 0.2s; border: none; }
        #explanation-modal-close-btn:hover { background-color: #2563eb; }
        #explanation-modal-close-btn.error { background-color: #DC2626; }
        #explanation-modal-close-btn.error:hover { background-color: #B91C1C; }

        #info-modal { position: absolute; inset: 0; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 600; display: none; align-items: center; justify-content: center; padding: 1rem; border-radius: 0.75rem; }
        #info-modal > div { background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-width: 90%; width: 400px; text-align: center; position: relative; }
        body.dark #info-modal > div { background-color: #2d3748; }
        #info-close { position: absolute; top: 0.5rem; left: 0.75rem; color: #6b7280; font-size: 2rem; font-weight: 700; background: none; border: none; cursor: pointer; }
        body.dark #info-close { color: #9ca3af; }
        #info-close:hover { color: #1f2937; }
        body.dark #info-close:hover { color: #f9fafb; }
        #info-modal p { margin-top: 1rem; line-height: 1.7; }
        body.light #info-modal p { color: #1f2937; } body.dark #info-modal p { color: #e5e7eb; }
        #message-modal { position: absolute; inset: 0; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 600; display: none; align-items: center; justify-content: center; padding: 1rem; border-radius: 0.75rem; }
        #message-modal > div > div { background-color: white; color: #1f2937; padding: 1.5rem; border-radius: 0.5rem; max-width: 90%; width: 360px; text-align: center; }
        body.dark #message-modal > div > div { background-color: #2d3748; color: #e5e7eb; }

        body.dark #score-box {
            background-color: #374151;
            color: #f3f4f6;
        }
        body.dark #question-area-wrapper {
            background-color: #2d3748;
        }
            body.dark #score-box .text-gray-800 {
            color: #f3f4f6;            
        }
        body.dark #question-text {
            color: #f3f4f6;
        }
    
        #custom-modal.save-info-modal {
            max-width: 180px !important;
            min-width: 110px !important;
            padding: 1rem 0.4rem !important;
        }
        #initial-view #new-chat-btn { display: none; }
        /* START: Quota Modal Styles */
        #quota-modal-overlay {
            z-index: 25000; /* Above everything else */
        }
        #quota-modal {
            text-align: center;
            padding-top: 3rem; /* Add space for the close button */
        }
        .quota-close-button {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem; /* For RTL layout */
            background: transparent;
            border: none;
            font-size: 2rem;
            line-height: 1;
            cursor: pointer;
            color: var(--header-icon-color-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 50%;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        body.light .quota-close-button {
             color: var(--header-icon-color-light-chat);
        }
        .quota-close-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        body.light .quota-close-button:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        #quota-message {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: var(--text-color-dark);
        }
        body.light #quota-message {
            color: var(--text-color-light);
        }
        #countdown-timer {
            display: flex;
            justify-content: center;
            gap: 1rem;
            direction: ltr; /* Ensure timer reads left-to-right */
        }
        .countdown-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .countdown-number {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
            padding: 0.5rem;
            border-radius: 0.5rem;
            min-width: 60px;
        }
        body.light .countdown-number {
            background-color: rgba(0,0,0,0.05);
            color: var(--header-text-color-light);
        }
        body.dark .countdown-number {
            background-color: rgba(255,255,255,0.1);
            color: var(--header-text-color-dark);
        }
        .countdown-label {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }
        /* END: Quota Modal Styles */
    </style>

<style>
/* ✅ دالة تحكم ذكية لسمك خط Tajawal */
/* لتغيير السمك، عدل القيمة التالية: */
:root {
  --tajawal-weight: 500;
}

body, .font-tajawal-bold, .font-tajawal-custom {
  font-family: 'Tajawal', sans-serif !important;
  font-weight: var(--tajawal-weight) !important;
}
</style>
</head>
<body class="dark">

<!-- Page Loader -->
<div class="page-loader-container" id="page-loader">
    <div class="loader-progress-wrapper">
        <div class="loader-progress-bar-fill" id="loader-progress-bar"></div>
    </div>
</div>
<!-- Background Videos and Overlay -->
<video autoplay="" class="bg-video-element" id="lightBgVideo" loop="" muted="" playsinline=""></video>
<video autoplay="" class="bg-video-element" id="darkBgVideo" loop="" muted="" playsinline=""></video>
<div class="overlay"></div>

<!-- Main Application Container -->
<div class="custom-scrollbar" id="app-view-container">
    <!-- Initial View (Home Screen) -->
    <div id="initial-view">
        <header id="main-header">
            <button aria-label="Toggle Settings" class="header-icon" id="settings-toggle-btn">
                <svg fill="none" height="26" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="26" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
            <button aria-label="New Chat" class="header-icon" id="new-chat-btn">
                <svg fill="none" height="26" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="26" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    <line x1="12" x2="12" y1="7" y2="13"></line>
                    <line x1="9" x2="15" y1="10" y2="10"></line>
                </svg>
            </button>
        </header>
        <div id="initial-view-content">
            <div id="main-title-wrapper"> <h1 id="main-title">
                <span class="font-rakkas title-text-ar">هَــبَــل</span>
                <span class="font-inter title-text-en">AI</span>
                </h1>
            </div>
            <div id="bot-gif-container">
                <img alt="Bot Animation" id="bot-gif" onerror="this.onerror=null; this.src='https://placehold.co/135x135/transparent/white?text=Bot+GIF'; console.error('Bot GIF failed to load, fallback triggered.');" src="https://dl.dropbox.com/scl/fi/ksf2n19dqxjmmxk931w2r/the-bot.gif?rlkey=jjui9v79a2z2g1pcxa250ivz9&amp;st=mt8maqmy&dl=0"/>
            </div>
            <h2 data-translate="askMe" id="main-subtitle">اسألني سؤال زي وجهك</h2>
            <textarea class="themed-input auto-grow-textarea custom-scrollbar" data-translate-placeholder="inputPlaceholderInitial" id="initial-input" placeholder="  حط هالسؤال .." rows="1"></textarea>
            <button id="initial-send-btn">
                <span data-translate="sendButtonInitial">يلا تنشوف</span>
            </button>
            <button aria-label="Game Button" id="new-playstation-button">
                <img alt="Game Icon" onerror="this.onerror=null; this.src='https://placehold.co/30x30/transparent/white?text=Game'; this.style.display='none'; this.nextElementSibling.style.marginTop='0';" src="https://dl.dropbox.com/scl/fi/ywsqnr0ro7tbwkjmwghdt/Picsart_25-05-30_19-28-31-262.png?rlkey=u5ugzwqufqp07jlv8nx08gjhm&amp;st=uyfjqukd&dl=0"/>
                <span data-translate="gameButton">اللعبة</span>
            </button>
        </div>
        <div id="app-footer-container">
            <footer id="app-footer">
                <p data-translate="copyright" id="copyright-text">جميع حقوق النشر محفوظة 2025©</p>
                <p data-translate="mustafaDeveloped" id="developer-text">تم تطوير هذا النموذج بواسطة مصطفى حشايكة</p>
            </footer>
            <div id="instagram-icon">
                <a aria-label="Instagram Profile" href="#" onclick="openRemoteLink('https://dl.dropbox.com/scl/fi/50p647r7162qrivfwmvdb/.txt?rlkey=qwaf4ahb9k62iq3aku9l1zw85&st=8vzdc5l7&dl=0'); return false;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
</svg>
                </a>
            </div>
        </div>
    </div>
    <!-- Chat View -->
    <div class="hidden-animated" id="chat-view">
        <div class="custom-scrollbar" id="chat-messages">
            <div id="chat-message-spacer" style="flex-grow: 1;"></div>
            <!-- Chat messages will be dynamically added here by JavaScript -->
        </div>
    </div>

    <!-- Game View -->
    <div class="hidden-animated" id="game-view">
        <header id="game-view-header">
            <button aria-label="Toggle Settings" class="header-icon" id="game-settings-btn">
                <svg fill="none" height="26" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="26" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
            <div id="game-title-wrapper">
                <h1 id="game-main-title">
                    <span class="font-rakkas title-text-ar">هَــبَــل</span>
                    <span class="font-inter title-text-en">AI</span>
                </h1>
            </div>
            <button aria-label="New Chat" class="header-icon" id="game-new-chat-btn">
                <svg fill="none" height="26" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="26" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    <line x1="12" x2="12" y1="7" y2="13"></line>
                    <line x1="9" x2="15" y1="10" y2="10"></line>
                </svg>
            </button>
        </header>
        <div id="game-content-area">
            <div id="game-box-main">
                <div id="game-background-container">
                    <img alt="خلفية متحركة" id="gameBackgroundGif" src="https://dl.dropbox.com/scl/fi/62g7j3t82l7zea9zyk0rl/ezgif-4641659cc1830c.gif?rlkey=4uvgo8tcu1ucxbdv6u50waj9f&st=jz6eet0e&dl=0"/>
                </div>
                <div id="gif-movable-container">
                    <img alt="صورة متحركة للعبة" id="gameGif" src="https://dl.dropbox.com/scl/fi/il8keygpy3ogs9twd2e06/20250606_033806.gif?rlkey=94ipkjns8111th45tyl6gsusi&st=sroe323c&dl=0"/>
                </div>
                <button class="absolute top-4 left-4 z-50 p-1.5 rounded-full bg-red-600 hover:bg-red-700 text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-white" id="info-button" data-translate-title="infoButtonTitle">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <button class="absolute top-16 left-4 z-50 p-1.5 rounded-full bg-red-600 hover:bg-red-700 text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-white" id="reset-game-btn" data-translate-title="resetGameTitle">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 4v5h5M20 20v-5h-5" stroke-linecap="round" stroke-linejoin="round"></path>
                        <path d="M4 9a9 9 0 0114.13-4.13M20 15a9 9 0 01-14.13 4.13" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <div class="absolute top-4 right-4 z-50 flex flex-col gap-2" id="audio-controls-container">
                    <button class="p-1.5 rounded-full bg-red-600 hover:bg-red-700 text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-white" id="mute-music-btn" data-translate-title="muteMusicTitle">
                        <svg fill="none" height="20" id="music-on-icon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                        <svg class="hidden" fill="none" height="20" id="music-off-icon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><line x1="1" x2="23" y1="1" y2="23"></line><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                    </button>
                    <button class="p-1.5 rounded-full bg-red-600 hover:bg-red-700 text-white shadow-lg focus:outline-none focus:ring-2 focus:ring-white" id="mute-sfx-btn" data-translate-title="muteSfxTitle">
                        <svg fill="none" height="20" id="sfx-on-icon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                        <svg class="hidden" fill="none" height="20" id="sfx-off-icon" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M13.73 21a2 2 0 0 1-3.46 0"></path><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M1 1l22 22"></path></svg>
                    </button>
                </div>
                <div id="advanced-stupidity-test-game">
                    <header class="w-full mb-3 sm:mb-4 flex-shrink-0 flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-0">
                        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-center sm:text-right flex items-center" style="color: #DC2626;" data-translate="gameTitle">
                            لعبة الهبل الذكية AI
                        </h1>
                        <div class="font-semibold bg-gray-100 rounded-md shadow" id="score-box">
                            <span>
                                <span class="text-gray-800" data-translate="questionsLabel">الأسئلة:</span> <span id="total-questions">0</span> |
                                <span style="color: #DC2626;" data-translate="wrongLabel">خطأ:</span> <span id="wrong-count">0</span> |
                                <span style="color: #3b82f6;" data-translate="correctLabel">صح:</span> <span id="score">0</span>
                            </span>
                        </div>
                    </header>
                    <main class="w-full flex-1 bg-gray-50 p-4 sm:p-6 rounded-xl shadow-lg my-3 sm:my-4 overflow-y-auto" id="question-area-wrapper">
                        <div class="hidden" id="question-content">
                            <p class="font-medium mb-4 text-center text-gray-800" id="question-text"></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4" id="options-container"></div>
                        </div>
                        <div class="w-full h-full flex flex-col justify-center items-center text-center" id="loading-state">
                            <svg class="animate-spin h-10 w-10 mx-auto" fill="none" style="color: #DC2626;" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" fill="currentColor"></path>
                            </svg>
                            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400" id="loading-text" data-translate="gameLoadingFirst">عم بحضرلك أول سؤال مرتب...</p>
                        </div>
                    </main>
                    <footer class="w-full flex justify-center mt-auto pt-3 flex-shrink-0">
                        <button class="btn btn-next flex items-center justify-center opacity-50 cursor-not-allowed" disabled="" id="next-question-btn">
                            <svg class="mr-2" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="m9 18 6-6-6-6"></path></svg>
                            <span data-translate="nextQuestionButton">السؤال اللي بعده</span>
                        </button>
                    </footer>
                </div>
                <div id="explanation-modal-overlay"><div id="explanation-modal-content"><h3 id="explanation-modal-title" data-translate="explanationTitle">التفسير:</h3><p id="explanation-modal-text"></p><button class="btn w-full mt-4" id="explanation-modal-close-btn" data-translate="closeButton">إغلاق</button></div></div>
                <div id="info-modal"><div class="relative"><button id="info-close">×</button><p data-translate="gameInfoText">الأسئلة ليست جاهزة ومخزنة، بل يتم توليد الأسئلة والخيارات والتفسير مباشرة بالذكاء الاصطناعي بشكل لا محدود. قد يحدث صياغة لسؤال او لخيارات او لتفسير غير متناسق ولكن هذا الأمر نادراً ،مع العلم تم بذل جهد للحفاظ على الصياغة المتناسقة قدر الأمكان.</p></div></div>
                <div id="message-modal"><div><p id="message-text"></p><button class="btn btn-modal w-full" id="close-modal-btn" data-translate="gotItButton">ماشي</button></div></div>
            </div>
            <button id="return-to-initial-view-btn">
                <img alt="Chat Icon" class="chat-icon" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.marginTop = 'calc(var(--game-return-btn-size) * 0.1)';" src="https://dl.dropbox.com/scl/fi/n1xfe6zwg9jw0hucqqofo/Picsart_25-06-02_14-52-52-849.png?rlkey=vl9y6xlfav696w751spmq8f4j&st=cfc6lmc1&dl=0"/>
                <span data-translate="chatButton">المحادثة</span>
            </button>
            <p id="game-usage-note" data-translate="usageLimitNote">ملاحظة : يوجد حد شهري للاستخدام يتجدد كل شهر</p>
        </div>
    </div>
</div>
<!-- Chat Input Container -->
<div id="chat-input-container" style="display: none;">
    <form id="chat-input-form">
        <textarea class="themed-input auto-grow-textarea custom-scrollbar" data-translate-placeholder="chatInputPlaceholder" id="chat-input" placeholder="حط هالرسالة تعيتك..." rows="1"></textarea>    
        <button aria-label="Send Message" id="chat-send-btn" type="submit">
            <svg fill="currentColor" height="20" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
        </button>
    </form>
<p id="chat-usage-note" data-translate="usageLimitNote" style="font-weight:400;">ملاحظة : يوجد حد شهري للاستخدام يتجدد كل شهر</p>
</div>
<div id="settings-panel-container">
    <div id="settings-panel-header">
        <div id="settings-panel-header-content">
            <h2 data-translate="settings" id="settings-panel-title">الإعدادات</h2>
            <button aria-label="Close Settings" class="header-icon" id="close-settings-btn">
                <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
            </button>
        </div>
    </div>
    <div id="settings-panel"> 
        <div class="custom-scrollbar" id="settings-panel-content">
            <div class="flex flex-col h-full pt-4">

                <div class="px-4">
                    <div class="settings-group !p-0 !m-0">
                        <h4 data-translate="previousChats">المحادثات السابقة :</h4>
                        <p class="text-xs font-normal -mt-1 mb-3" data-translate="longPressHint">(اضغط مطولاً لتسمية او حذف او تثبيت المحادثة)</p>
                        <div class="custom-scrollbar" id="previous-chats-list">
                            <p class="text-sm opacity-70 p-4 text-center" data-translate="noPreviousChats">لا توجد محادثات سابقة بعد.</p>
                        </div>
                    </div>

                    <div class="settings-divider !mx-0 my-4"></div>

                    <div class="settings-group !p-0 !m-0">
                        <h4 data-translate="theme">الثيم :</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <button class="themed-input" data-theme-setting="light" data-translate="light">فاتح</button>
                            <button class="themed-input" data-theme-setting="dark" data-translate="dark">مظلم</button>
                            <button class="themed-input active-setting-btn" data-theme-setting="auto" data-translate="auto">تلقائي</button>
                        </div>
                    </div>

                    <div class="settings-divider !mx-0 my-4"></div>

                    <div class="settings-group !p-0 !m-0">
                        <label class="settings-label" data-translate="habalLevel" for="habal-level-btn">مستوى الهبل :</label>
                        <button class="themed-input" id="habal-level-btn"></button>
                    </div>

                    <div class="settings-divider !mx-0 my-4"></div>

                    <div class="settings-group !p-0 !m-0">
                        <button class="themed-input" data-translate="enterYourInfo" id="edit-user-info-settings-btn">عرفني على حالك</button>
                    </div>

                    <div class="settings-divider !mx-0 my-4"></div>

                    <div class="settings-group !p-0 !m-0">
                        <button class="themed-input" data-translate="languageAndDialect" id="language-dialect-settings-btn">اللغة واللهجة</button>
                    </div>

                    <div class="settings-divider !mx-0 my-4"></div>

                    <div class="settings-group !p-0 !m-0">
                        <button class="themed-input" data-translate="shareWithPal" id="share-app-settings-btn">تبخلش على صاحبك بهالتطبيق</button>
                    </div>
                </div>

                <div class="mt-auto px-4 pb-20">
                    <div class="settings-divider !mx-0 my-4"></div>
                    <div class="settings-group !p-0 !m-0 space-y-3">
                        <button class="w-full text-start themed-input" id="rating-btn" data-translate="rateUs">قيمنا وتستحيش</button>
                        <button class="w-full text-start themed-input" data-translate="aboutApp" id="about-app-btn">حول التطبيق</button>
                        <button class="w-full text-start themed-input" data-translate="privacyPolicy" id="privacy-policy-btn">سياسة الخصوصية</button>
                        <button class="w-full text-start themed-input" data-translate="contact" id="contact-us-btn">تواصل معنا</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<div id="settings-overlay"></div>
<div class="popup-scale-transition popup-hidden" id="habal-level-modal-overlay">
    <div class="themed-input" id="habal-level-modal">
        <h3 class="pt-3" data-translate="habalLevelTitle" id="habal-level-modal-title">مستوى الهبل</h3>
        <div class="mt-4 space-y-3" id="habal-level-options">
            </div>
        <div class="modal-buttons mt-6">
            <button class="modal-cancel-btn" data-translate="cancel" id="cancel-habal-level-btn">إلغاء</button>
            <button data-translate="confirm" id="confirm-habal-level-btn">تأكيد</button>
        </div>
    </div>
</div>

<div class="popup-scale-transition popup-hidden" id="language-popup-overlay">
    <div class="themed-input" id="language-popup-modal">
        <h3 class="pt-3" data-translate="languagePopupTitle" id="language-popup-title-text"></h3>
        <div class="space-y-3 mt-3">
            <button class="w-full font-semibold py-3 rounded-lg text-lg" data-translate="arabic" id="lang-arabic-btn">العربية</button>
            <button class="w-full font-semibold py-3 rounded-lg text-lg" data-translate="english" id="lang-english-btn">English</button>
        </div>
        <div class="mt-6 hidden space-y-3" id="dialect-selection-arabic">
            <h3 class="text-lg font-medium mb-2 text-center" data-translate="chooseDialect">اختر لهجتك</h3>
            <select class="w-full p-3 themed-input border rounded-md text-base" id="arabic-dialect-select">
            </select>
            <button class="w-full font-semibold py-3 rounded-lg mt-3 text-lg" data-translate="confirm" id="confirm-arabic-dialect-btn">تأكيد</button>
        </div>
        <div class="mt-6 hidden space-y-3" id="dialect-selection-english">
            <h3 class="text-lg font-medium mb-2 text-center" data-translate="chooseAccent">Choose your accent</h3>
            <select class="w-full p-3 themed-input border rounded-md text-base" id="english-dialect-select">
            </select>
            <button class="w-full font-semibold py-3 rounded-lg mt-3 text-lg" data-translate="confirm" id="confirm-english-dialect-btn">Confirm</button>
        </div>
        <button class="w-full mt-4 themed-input py-2.5 rounded-lg text-sm" data-translate="cancel" id="cancel-language-popup-btn" style="display:none;">إلغاء</button>
    </div>
</div>
<div class="popup-scale-transition popup-hidden" id="user-info-modal-overlay">
    <div class="themed-input" id="user-info-modal">
        <h3 data-translate="enterYourInfo" id="user-info-modal-title">عرفني على حالك</h3>
        <div>
            <label data-translate="nameLabel" for="popup-user-name-input">الاسم الكريم:</label>
            <input class="themed-input" id="popup-user-name-input" type="text"/>
        </div>
        <div>
            <label data-translate="ageLabel" for="popup-user-age-input">كم عمرك؟</label>
            <input class="themed-input" id="popup-user-age-input" type="number"/>
        </div>
        <div>
            <label data-translate="genderLabel">الجنس:</label>
            <div class="gender-options">
                <label for="popup-gender-male">
                    <input checked="" id="popup-gender-male" name="popupUserGender" type="radio" value="male"/> <span data-translate="male">ذكر</span>
                </label>
                <label for="popup-gender-female">
                    <input id="popup-gender-female" name="popupUserGender" type="radio" value="female"/> <span data-translate="female">أنثى</span>
                </label>
                <label for="popup-gender-alien">
                    <input id="popup-gender-alien" name="popupUserGender" type="radio" value="alien"/> <span data-translate="alien">مخلوق فضائي</span>
                </label>
                <label for="popup-gender-other">
                    <input id="popup-gender-other" name="popupUserGender" type="radio" value="other"/> <span data-translate="other">آخر</span>
                </label>
            </div>
        </div>
        <p class="text-xs opacity-70 my-3" data-translate="userInfoNote">"هذول المعلومات فقط عشان النموذج الذكاء الاصطناعي يتفاعل معك على اساسهن فقط ، مثلا ينادي باسمك ويرد عليك بحسب جنسك وعمرك فقط هكذا"</p>
        <div class="modal-buttons">
            <button data-translate="saveAndContinue" id="popup-save-info-btn">حفظ ومتابعة</button>
            <button data-translate="skip" id="popup-skip-info-btn">لبعدين</button>
        </div>
    </div>
</div>
<!-- Share App Popup -->
<div class="popup-scale-transition popup-hidden" id="share-app-modal-overlay">
    <div class="themed-input" id="share-app-modal">
        <button aria-label="Close Share App" class="modal-close-button" id="close-share-app-modal-btn">
            <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
        </button>
        <div class="space-y-4 pt-8"> <div class="text-center">
            <p class="share-prompt-text" data-translate="shareIOSPrompt">شارك التطبيق مع صديقك الأيفوني:</p>
            <button class="share-button" data-translate="shareActionText" id="share-ios-btn">مشاركة</button>
        </div>
        <div class="mt-3 mb-1 border-t border-gray-500/30"></div> <div class="text-center">
            <p class="share-prompt-text pt-2" data-translate="shareAndroidPrompt">شارك التطبيق مع صديقك الأندرويدي:</p>
            <button class="share-button" data-translate="shareActionText" id="share-android-btn">مشاركة</button>
        </div>
        </div>
    </div>
</div>
<!-- Generic Info Popup -->
<div class="popup-scale-transition popup-hidden" id="generic-info-modal-overlay">
    <div class="themed-input" id="generic-info-modal">
        <button aria-label="Close Info" class="modal-close-button" id="close-generic-info-modal-btn">
            <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
        </button>
        <h3 class="text-xl font-bold mb-4 text-center pt-2" id="generic-info-modal-title"></h3>
        <div class="custom-scrollbar" id="generic-info-modal-content">
            <p class="text-sm" id="generic-info-modal-text"></p>
        </div>
    </div>
</div>

<!-- Custom Confirmation/Alert Modal -->
<div class="popup-scale-transition popup-hidden" id="custom-modal-overlay">
    <div class="themed-input" id="custom-modal">
        <h3 id="custom-modal-title"></h3>
        <div id="custom-modal-message"></div>
        <div class="mt-4" id="custom-modal-buttons">
            <button class="modal-ok-btn">طيب</button>
        </div>
    </div>
</div>

<!-- Rating Modal -->
<div class="popup-scale-transition popup-hidden" id="rating-modal-overlay">
    <div class="themed-input" id="rating-modal">
        <button aria-label="Close Rating" class="modal-close-button" id="close-rating-modal-btn">
            <svg fill="none" height="20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewbox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
        </button>
        <h3 class="pt-2" data-translate="ratingTitle">رأيك بهمنا!</h3>
        <div id="rating-stars-container">
            <span class="rating-star" data-value="5">★</span>
            <span class="rating-star" data-value="4">★</span>
            <span class="rating-star" data-value="3">★</span>
            <span class="rating-star" data-value="2">★</span>
            <span class="rating-star" data-value="1">★</span>
        </div>
        <button id="submit-rating-btn" data-translate="rateOnStore">قيّمنا على المتجر</button>
    </div>
</div>
<!-- Ad Slot Placeholder -->
<div id="ad-slot-1"></div>

<!-- START: CONTEXT MENU & RENAME MODAL HTML -->
<div id="chat-context-menu" class="hidden absolute rounded-md py-1">
    <div id="rename-chat-option" class="context-menu-item">
        <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z" /><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z" /></svg>
        </div>
        <span data-translate="renameChat">تسمية المحادثة</span>
    </div>
    <div id="pin-chat-option" class="context-menu-item">
        <div class="icon-wrapper" id="pin-icon-wrapper">
            <!-- Pin/Unpin icon will be dynamically inserted here -->
        </div>
        <span id="pin-option-text" data-translate="pinChat">تثبيت المحادثة</span>
    </div>
    <div id="delete-chat-option" class="context-menu-item">
        <div class="icon-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193v-.443A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25-.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" /></svg>
        </div>
        <span data-translate="deleteChat">حذف المحادثة</span>
    </div>
</div>

<div id="rename-modal-overlay" class="popup-scale-transition popup-hidden">
    <div id="rename-modal">
        <h3 data-translate="renameChatTitle">إعادة تسمية المحادثة</h3>
        <input type="text" id="rename-input" class="themed-input w-full" data-translate-placeholder="renameChatPlaceholder" placeholder="أدخل الاسم الجديد...">
        <div class="modal-buttons">
            <button id="cancel-rename-btn" data-translate="cancel">إلغاء</button>
            <button id="confirm-rename-btn" data-translate="save">حفظ</button>
        </div>
    </div>
</div>
<!-- END: CONTEXT MENU & RENAME MODAL HTML -->

<!-- START: QUOTA LIMIT MODAL -->
<div class="popup-scale-transition popup-hidden" id="quota-modal-overlay">
    <div class="themed-input" id="quota-modal">
        <button class="quota-close-button" id="quota-close-btn" aria-label="Close Quota Modal">&times;</button>
        <p id="quota-message" data-translate="quotaMessage">
            والله احنا متأسفين الك 😢 حاليا خلص الحد الشهري لتعامل مع الذكاء الاصطناعي وهاذ الاشي بصير بسبب كثرة الطلبات على هذا النموذج من الذكاء الاصطناعي او بسبب الضغط الشديد على النموذج من قبل المستخدمين ، بس عادي ولا يهمك ولا تقلق كل ما عليك انك تستنى ينتهي العد التنازلي الي بدخلك على بداية شهر جديد وبالتالي بداية حد شهري جديد واستمتع ! 😍
        </p>
        <div id="countdown-timer">
            <div class="countdown-unit">
                <span id="countdown-days" class="countdown-number">00</span>
                <span class="countdown-label" data-translate="days">أيام</span>
            </div>
            <div class="countdown-unit">
                <span id="countdown-hours" class="countdown-number">00</span>
                <span class="countdown-label" data-translate="hours">ساعات</span>
            </div>
            <div class="countdown-unit">
                <span id="countdown-minutes" class="countdown-number">00</span>
                <span class="countdown-label" data-translate="minutes">دقائق</span>
            </div>
            <div class="countdown-unit">
                <span id="countdown-seconds" class="countdown-number">00</span>
                <span class="countdown-label" data-translate="seconds">ثواني</span>
            </div>
        </div>
    </div>
</div>
<!-- END: QUOTA LIMIT MODAL -->
<!-- JAVASCRIPT SECTION -->
<script>
        // --- DOM Elements ---
        const dom = {
            html: document.documentElement,
            body: document.body,
            lightBgVideo: document.getElementById('lightBgVideo'),
            darkBgVideo: document.getElementById('darkBgVideo'),
            pageLoader: document.getElementById('page-loader'),
            loaderProgressBar: document.getElementById('loader-progress-bar'),
            overlay: document.querySelector('.overlay'),
            appViewContainer: document.getElementById('app-view-container'),
            mainHeader: document.getElementById('main-header'), 
            mainTitleWrapper: document.getElementById('main-title-wrapper'), 
            mainTitle: document.getElementById('main-title'), 
            initialView: document.getElementById('initial-view'),
            initialViewContent: document.getElementById('initial-view-content'),
            initialInput: document.getElementById('initial-input'),
            initialSendBtn: document.getElementById('initial-send-btn'),
            chatView: document.getElementById('chat-view'),
            chatMessages: document.getElementById('chat-messages'), 
            chatInputContainer: document.getElementById('chat-input-container'), // MODIFIED
            chatInputForm: document.getElementById('chat-input-form'),
            chatInput: document.getElementById('chat-input'),
            chatSendBtn: document.getElementById('chat-send-btn'),
            newChatBtn: document.getElementById('new-chat-btn'), 
            settingsToggleBtn: document.getElementById('settings-toggle-btn'), 
            
            settingsPanelContainer: document.getElementById('settings-panel-container'),
            settingsPanelHeader: document.getElementById('settings-panel-header'),
            settingsPanelHeaderContent: document.getElementById('settings-panel-header-content'),
            settingsPanel: document.getElementById('settings-panel'),
            settingsPanelContent: document.getElementById('settings-panel-content'),
            
            closeSettingsBtn: document.getElementById('close-settings-btn'),
            settingsOverlay: document.getElementById('settings-overlay'),
            themeSettingBtns: document.querySelectorAll('#settings-panel button[data-theme-setting]'),
            habalLevelBtn: document.getElementById('habal-level-btn'),
            editUserInfoSettingsBtn: document.getElementById('edit-user-info-settings-btn'),
            languageDialectSettingsBtn: document.getElementById('language-dialect-settings-btn'),
            appFooterContainer: document.getElementById('app-footer-container'),
            previousChatsList: document.getElementById('previous-chats-list'),

            botGifContainer: document.getElementById('bot-gif-container'),
            botGif: document.getElementById('bot-gif'),
            newPlaystationButton: document.getElementById('new-playstation-button'), 
            mainSubtitle: document.getElementById('main-subtitle'),

            // New Habal Level Modal elements
            habalLevelModalOverlay: document.getElementById('habal-level-modal-overlay'),
            habalLevelModalTitle: document.getElementById('habal-level-modal-title'),
            habalLevelOptions: document.getElementById('habal-level-options'),
            confirmHabalLevelBtn: document.getElementById('confirm-habal-level-btn'),
            cancelHabalLevelBtn: document.getElementById('cancel-habal-level-btn'),

            languagePopupOverlay: document.getElementById('language-popup-overlay'),
            languagePopupModal: document.getElementById('language-popup-modal'),
            languagePopupTitleText: document.getElementById('language-popup-title-text'),
            langArabicBtn: document.getElementById('lang-arabic-btn'),
            langEnglishBtn: document.getElementById('lang-english-btn'),
            dialectSelectionArabic: document.getElementById('dialect-selection-arabic'),
            arabicDialectSelect: document.getElementById('arabic-dialect-select'),
            confirmArabicDialectBtn: document.getElementById('confirm-arabic-dialect-btn'),
            dialectSelectionEnglish: document.getElementById('dialect-selection-english'),
            englishDialectSelect: document.getElementById('english-dialect-select'),
            confirmEnglishDialectBtn: document.getElementById('confirm-english-dialect-btn'),
            cancelLanguagePopupBtn: document.getElementById('cancel-language-popup-btn'),

            userInfoModalOverlay: document.getElementById('user-info-modal-overlay'),
            userInfoModalTitle: document.getElementById('user-info-modal-title'),
            popupUserNamaInput: document.getElementById('popup-user-name-input'),
            popupUserAgeInput: document.getElementById('popup-user-age-input'),
            popupGenderMale: document.getElementById('popup-gender-male'),
            popupGenderFemale: document.getElementById('popup-gender-female'),
            popupGenderAlien: document.getElementById('popup-gender-alien'),
            popupGenderOther: document.getElementById('popup-gender-other'),
            popupSaveInfoBtn: document.getElementById('popup-save-info-btn'),
            popupSkipInfoBtn: document.getElementById('popup-skip-info-btn'),

            shareAppSettingsBtn: document.getElementById('share-app-settings-btn'),
            shareAppModalOverlay: document.getElementById('share-app-modal-overlay'),
            closeShareAppModalBtn: document.getElementById('close-share-app-modal-btn'),
            shareIosBtn: document.getElementById('share-ios-btn'),
            shareAndroidBtn: document.getElementById('share-android-btn'),

            genericInfoModalOverlay: document.getElementById('generic-info-modal-overlay'),
            genericInfoModalTitle: document.getElementById('generic-info-modal-title'),
            genericInfoModalText: document.getElementById('generic-info-modal-text'),
            closeGenericInfoModalBtn: document.getElementById('close-generic-info-modal-btn'),
            aboutAppBtn: document.getElementById('about-app-btn'),
            privacyPolicyBtn: document.getElementById('privacy-policy-btn'),
            contactUsBtn: document.getElementById('contact-us-btn'),

            customModalOverlay: document.getElementById('custom-modal-overlay'),
            customModalTitle: document.getElementById('custom-modal-title'),
            customModalMessage: document.getElementById('custom-modal-message'),
            customModalButtons: document.getElementById('custom-modal-buttons'),

            gameView: document.getElementById('game-view'),
            gameViewHeader: document.getElementById('game-view-header'),
            gameSettingsBtn: document.getElementById('game-settings-btn'),
            gameTitleWrapper: document.getElementById('game-title-wrapper'),
            gameMainTitle: document.getElementById('game-main-title'),
            gameNewChatBtn: document.getElementById('game-new-chat-btn'),
            gameContentArea: document.getElementById('game-content-area'),
            gameBoxMain: document.getElementById('game-box-main'), 
            returnToInitialViewBtn: document.getElementById('return-to-initial-view-btn'),
            gameUsageNote: document.getElementById('game-usage-note'), // Added for the game usage note

            // New Previous Chat Menu Elements
            chatContextMenu: document.getElementById('chat-context-menu'),
            renameChatOption: document.getElementById('rename-chat-option'),
            pinChatOption: document.getElementById('pin-chat-option'),
            deleteChatOption: document.getElementById('delete-chat-option'),
            pinIconWrapper: document.getElementById('pin-icon-wrapper'),
            pinOptionText: document.getElementById('pin-option-text'),
            renameModalOverlay: document.getElementById('rename-modal-overlay'),
            renameModal: document.getElementById('rename-modal'),
            renameInput: document.getElementById('rename-input'),
            confirmRenameBtn: document.getElementById('confirm-rename-btn'),
            cancelRenameBtn: document.getElementById('cancel-rename-btn'),

            // START: Quota Timer Elements
            quotaModalOverlay: document.getElementById('quota-modal-overlay'),
            quotaCloseBtn: document.getElementById('quota-close-btn'),
            countdownDays: document.getElementById('countdown-days'),
            countdownHours: document.getElementById('countdown-hours'),
            countdownMinutes: document.getElementById('countdown-minutes'),
            countdownSeconds: document.getElementById('countdown-seconds'),
            // END: Quota Timer Elements
        };
        // --- State Variables ---
        let currentTheme = 'auto'; // MODIFIED: Default to 'auto'
        let currentLang = localStorage.getItem('habelAiLangSim') || 'ar-PS';
        let currentHabalLevel = localStorage.getItem('habelAiLevelSim') || 'اهبل رسمي';
        let chatStarted = false; 
        let gameViewActive = false; 
        let isSettingsPanelOpen = false;
        let lastFocusedInputId = null;
        let isLanguagePopupForSettings = false;
        let isKeyboardVisible = false;
        const onboardingStorageKey = 'habelAiOnboardingComplete_v1_0_3'; // Version bump
        let initialInputBaseHeight = 44;
        let tempHabalLevel = currentHabalLevel; // For modal selection
        
        // Chat state
        let currentChatId = null; // Use ID to track the active chat
        let currentChatMessages = [];
        const CHATS_STORAGE_KEY = 'habelAiChats_v4'; // Incremented version for new structure
        
        // Previous Chat Menu State
        let currentContextMenuItem = null;
        let chatIdToRename = null; // RELIABLE WAY TO STORE ID FOR RENAMING
        let longPressTimer;
        const LONG_PRESS_DURATION = 500;


        // Game state
        let gameAudio = { correct: null, incorrect: null, click: null, backgroundMusic: null };

        // START: Quota Timer State
        let quotaCountdownInterval = null;
        const QUOTA_RESET_TIME_KEY = 'habelAiQuotaResetTime';
        // END: Quota Timer State

        
        const videoThemes = {
          light: 'https://dl.dropbox.com/scl/fi/m35oawzd22ww0gedcvk30/4471213-hd_1920_1080_30fps.mp4?rlkey=k6h7k5gv3frhhtjicb2f5ovi7&st=bhtneh7h&dl=0',
          dark: 'https://dl.dropbox.com/scl/fi/zuxlqrtni5yvq85ygu47d/159300-818469277.mp4?rlkey=lxcj3iosmdj2n6hdoc2xiaemq&st=wluyz6tp&dl=0'
        };
        // --- Translations ---
        const translations = {
            // ARABIC DIALECTS
            'ar-PS': { // Palestinian (Default Arabic)
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال زي وجهك",
                inputPlaceholderInitial: "حط هالسؤال ..",
                sendButtonInitial: "يلا تنشوف",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "حط هالرسالة تعيتك...",
                usageLimitNote: "ملاحظة : يوجد حد شهري للاستخدام يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة :",
                longPressHint: "(اضغط مطولاً لتسمية او حذف او تثبيت المحادثة)",
                noPreviousChats: "لا توجد محادثات سابقة بعد.",
                theme: "الثيم :",
                light: "فاتح",
                dark: "مظلم",
                auto: "تلقائي",
                habalLevel: "مستوى الهبل :",
                enterYourInfo: "عرفني على حالك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "تبخلش على صاحبك بهالتطبيق",
                rateUs: "قيمنا وتستحيش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبل",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "", // Empty for onboarding
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختر لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم الكريم:",
                ageLabel: "كم عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هذول المعلومات فقط عشان النموذج الذكاء الاصطناعي يتفاعل معك على اساسهن فقط ، مثلا ينادي باسمك ويرد عليك بحسب جنسك وعمرك فقط هكذا\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "لبعدين",
                shareIOSPrompt: "شارك التطبيق مع صديقك الأيفوني:",
                shareAndroidPrompt: "شارك التطبيق مع صديقك الأندرويدي:",
                shareActionText: "مشاركة",
                ok: "طيب",
                ratingTitle: "رأيك بهمنا!",
                rateOnStore: "قيّمنا على المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "حذف المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "أدخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله احنا متأسفين الك 😢 حاليا خلص الحد الشهري لتعامل مع الذكاء الاصطناعي وهاذ الاشي بصير بسبب كثرة الطلبات على هذا النموذج من الذكاء الاصطناعي او بسبب الضغط الشديد على النموذج من قبل المستخدمين ، بس عادي ولا يهمك ولا تقلق كل ما عليك انك تستنى ينتهي العد التنازلي الي بدخلك على بداية شهر جديد وبالتالي بداية حد شهري جديد واستمتع ! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقائق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبل الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صح:",
                gameLoadingFirst: "عم بحضرلك أول سؤال مرتب...",
                nextQuestionButton: "السؤال اللي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة ليست جاهزة ومخزنة، بل يتم توليد الأسئلة والخيارات والتفسير مباشرة بالذكاء الاصطناعي بشكل لا محدود. قد يحدث صياغة لسؤال او لخيارات او لتفسير غير متناسق ولكن هذا الأمر نادراً ،مع العلم تم بذل جهد للحفاظ على الصياغة المتناسقة قدر الأمكان.",
                gotItButton: "ماشي",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي بس مرح شوي', 'اهبل بس عن ذكاء': 'اهبل بس عن ذكاء', 'اهبل رسمي': 'اهبل رسمي', 'ثقيل دم وسخيف': 'ثقيل دم وسخيف', 'بحب النكت كثير': 'بحب النكت كثير' },
                errorOccurred: "اكتبلك اشي !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف هالتطبيق المميز الي فعلاً اسلوبو غريب وبضحك من القلب بنصحك اجربو انا جربتو وعجبني كثير للامانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك لا يدعم خاصية المشاركة المباشرة. يمكنك نسخ الرابط ومشاركته يدوياً.",
                webShareError: "فشلت عملية المشاركة. حاول مرة أخرى أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوي",
                aboutAppText: "<p>هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.</p><p>تم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.</p><p>في كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد</p><p>بل يأخذك في رحلة من الضحك والمواقف الغريبة.</p><p>سواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال</p><p>فإن هبل AI هو رفيقك المثالي للترفيه والتسلية.</p><p>جربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .</p>لعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.<br>تواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!<br>الذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.<br>هل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!<br><br><p>تم تطوير هذا التطبيق والنموذج بواسطة مصطفى حشايكة.</p>",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.<br>لا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.<br>يُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.<br>يتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.<br>المحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.<br>باستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.<br>لأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!<br><br>إذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : <a href=\"#\" onclick=\"openRemoteLink('https://dl.dropbox.com/scl/fi/36ohp10445zjvrfs1869y/.txt?rlkey=ftwf5375rlzvs2bvcgaguve2v&st=4uiahs7w&dl=0'); return false;\" class=\"text-blue-500 hover:underline\">راسلنا</a>.<br><br>أو تواصل معنا عبر صفحتنا على الانستغرام<br><a href=\"#\" onclick=\"openRemoteLink('https://dl.dropbox.com/scl/fi/50p647r7162qrivfwmvdb/.txt?rlkey=qwaf4ahb9k62iq3aku9l1zw85&st=8vzdc5l7&dl=0'); return false;\" class=\"text-blue-500 hover:underline\">اضغط هنا</a>.<br><br>نحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>حذف المحادثة ؟</b>",
                confirmDeleteChatMessage: "هل أنت متأكد أنك تريد حذف هذه المحادثة بشكل نهائي؟",
                delete: "حذف",
                chatDeleted: "تم حذف المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "يرجى تعبئة جميع المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "عم بجيبلك سؤال مرتب جديد...",
            },
            'ar-EG': { // Egyptian
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال على قدك",
                inputPlaceholderInitial: "اكتب سؤالك هنا ..",
                sendButtonInitial: "يلا بينا نشوف",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "اكتب رسالتك...",
                usageLimitNote: "ملحوظة: فيه حد شهري للاستخدام بيتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة:",
                longPressHint: "(دوس جامد عشان تسمي أو تمسح أو تثبت المحادثة)",
                noPreviousChats: "مافيش محادثات سابقة لسه.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "غامق",
                auto: "تلقائي",
                habalLevel: "مستوى الهبل:",
                enterYourInfo: "عرفني بنفسك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ماتبخلش على صاحبك بالتطبيق ده",
                rateUs: "قيمنا وماتتكسفش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبل",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختار لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم:",
                ageLabel: "عندك كام سنة؟",
                genderLabel: "النوع:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"المعلومات دي بس عشان نموذج الذكاء الاصطناعي يتفاعل معاك على أساسها، يعني مثلاً ينادي باسمك ويرد عليك حسب نوعك وسنك وبس كده\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعدين",
                shareIOSPrompt: "شارك التطبيق مع صاحبك اللي معاه أيفون:",
                shareAndroidPrompt: "شارك التطبيق مع صاحبك اللي معاه أندرويد:",
                shareActionText: "مشاركة",
                ok: "ماشي",
                ratingTitle: "رأيك يهمنا!",
                rateOnStore: "قيمنا على المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "مسح المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "اكتب الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله إحنا آسفين ليك 😢 حالياً الحد الشهري للتعامل مع الذكاء الاصطناعي خلص وده بيحصل بسبب كتر الطلبات على النموذج ده أو بسبب الضغط الشديد عليه من المستخدمين، بس عادي ولا يهمك وماتقلقش كل اللي عليك إنك تستنى العد التنازلي يخلص عشان تدخل على بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبل الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "غلط:",
                correctLabel: "صح:",
                gameLoadingFirst: "بحضرلك أول سؤال جامد...",
                nextQuestionButton: "السؤال اللي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة مش جاهزة ومتخزنة، لكن بيتم توليدها بالخيارات والتفسير مباشرة بالذكاء الاصطناعي بشكل غير محدود. ممكن يحصل صياغة لسؤال أو خيارات أو تفسير مش متناسق لكن ده نادر، مع العلم إنه تم بذل مجهود للحفاظ على الصياغة متناسقة على قد ما نقدر.",
                gotItButton: "ماشي",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جاد بس دمه خفيف شوية', 'اهبل بس عن ذكاء': 'أهبل بس بذكاء', 'اهبل رسمي': 'أهبل رسمي', 'ثقيل دم وسخيف': 'دمه تقيل وسخيف', 'بحب النكت كثير': 'بيحب النكت أوي' },
                errorOccurred: "اكتب حاجة !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف التطبيق المميز ده اللي أسلوبه غريب وبيضحك من القلب بجد، بنصحك تجربه أنا جربته وعجبني أوي الصراحة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك مش بيدعم خاصية المشاركة المباشرة. ممكن تنسخ اللينك وتشاركه بنفسك.",
                webShareError: "فشلت عملية المشاركة. حاول تاني أو انسخ اللينك.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>مسح المحادثة؟</b>",
                confirmDeleteChatMessage: "متأكد إنك عايز تمسح المحادثة دي بشكل نهائي؟",
                delete: "مسح",
                chatDeleted: "تم مسح المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "لو سمحت املأ كل المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "بحضرلك سؤال جديد...",
            },
            'ar-SA': { // Saudi
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال على قد وجهك",
                inputPlaceholderInitial: "اكتب سؤالك ..",
                sendButtonInitial: "يلا نشوف",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "اكتب رسالتك...",
                usageLimitNote: "ملاحظة: يوجد حد شهري للاستخدام يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة:",
                longPressHint: "(اضغط باستمرار لتسمية أو حذف أو تثبيت المحادثة)",
                noPreviousChats: "لا توجد محادثات سابقة حتى الآن.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "داكن",
                auto: "تلقائي",
                habalLevel: "مستوى الهبال:",
                enterYourInfo: "عرفني عليك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "لا تبخل على خويك بهالتطبيق",
                rateUs: "قيمنا ولا تستحي",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختر لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم الكريم:",
                ageLabel: "كم عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هالمعلومات بس عشان نموذج الذكاء الاصطناعي يتفاعل معك على أساسها، مثلاً يناديك باسمك ويرد عليك حسب جنسك وعمرك وبس\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعدين",
                shareIOSPrompt: "شارك التطبيق مع خويك اللي معه آيفون:",
                shareAndroidPrompt: "شارك التطبيق مع خويك اللي معه أندرويد:",
                shareActionText: "مشاركة",
                ok: "طيب",
                ratingTitle: "رأيك يهمنا!",
                rateOnStore: "قيمنا على المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "حذف المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "أدخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله حنا آسفين لك 😢 حالياً خلص الحد الشهري للتعامل مع الذكاء الاصطناعي وهذا الشيء يصير بسبب كثرة الطلبات على هالنموذج أو بسبب الضغط الشديد عليه من المستخدمين، بس عادي ولا يهمك ولا تقلق كل اللي عليك إنك تنتظر العد التنازلي يخلص عشان تدخل على بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صح:",
                gameLoadingFirst: "جالس أجهز لك أول سؤال مرتب...",
                nextQuestionButton: "السؤال اللي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة ما هي بجاهزة ومخزنة، بل يتم توليد الأسئلة والخيارات والتفسير مباشرة بالذكاء الاصطناعي بشكل لا محدود. يمكن يصير صياغة لسؤال أو خيارات أو تفسير غير متناسق لكن هالشيء نادر، مع العلم إنه تم بذل جهد للحفاظ على الصياغة متناسقة قدر الإمكان.",
                gotItButton: "طيب",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي بس فيه شوية مزح', 'اهبل بس عن ذكاء': 'أهبل بس بذكاء', 'اهبل رسمي': 'أهبل رسمي', 'ثقيل دم وسخيف': 'ثقيل طينة وسخيف', 'بحب النكت كثير': 'يحب النكت مرة' },
                errorOccurred: "اكتب شيء !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف هالتطبيق المميز اللي صدق أسلوبه غريب ويضحك من قلب، أنصحك تجربه أنا جربته وعجبني مرة للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك لا يدعم خاصية المشاركة المباشرة. يمديك تنسخ الرابط وتشاركه يدوياً.",
                webShareError: "فشلت عملية المشاركة. حاول مرة ثانية أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوي",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>حذف المحادثة؟</b>",
                confirmDeleteChatMessage: "هل أنت متأكد أنك تبي تحذف هالمحادثة بشكل نهائي؟",
                delete: "حذف",
                chatDeleted: "تم حذف المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "الرجاء تعبئة جميع المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "جالس أجهز لك سؤال جديد...",
            },
            'ar-MA': { // Moroccan
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "سولني شي سؤال على قد وجهك",
                inputPlaceholderInitial: "كتب السؤال ديالك ..",
                sendButtonInitial: "يلاه نشوفو",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "كتب الرسالة ديالك...",
                usageLimitNote: "ملاحظة: كاين واحد الحد شهري ديال الاستخدام كيتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات لي فاتو:",
                longPressHint: "(ورك مطولاً باش تسمي ولا تمسح ولا تثبت المحادثة)",
                noPreviousChats: "ماكاينينش محادثات سابقين دابا.",
                theme: "التيم:",
                light: "فاتح",
                dark: "مظلم",
                auto: "تلقائي",
                habalLevel: "نيفو ديال لهبال:",
                enterYourInfo: "عرفني على راسك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ماتبخلش على صاحبك بهاد التطبيق",
                rateUs: "قيمنا وماتحشمش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "نيفو ديال لهبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "ختار اللهجة ديالك",
                chooseAccent: "Choose your accent",
                nameLabel: "السمية:",
                ageLabel: "شحال ف عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هاد المعلومات غير باش نموذج الذكاء الإصطناعي يتفاعل معاك على حسابها، مثلا يعيط ليك بسميتك ويجاوبك على حساب جنسك وعمرك، هادشي لي كاين\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "من بعد",
                shareIOSPrompt: "بارطاجي التطبيق مع صاحبك لي عندو الأيفون:",
                shareAndroidPrompt: "بارطاجي التطبيق مع صاحبك لي عندو الأندرويد:",
                shareActionText: "مشاركة",
                ok: "واخا",
                ratingTitle: "الرأي ديالك كيهمّنا!",
                rateOnStore: "قيمنا فالمتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "مسح المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "دخل السمية الجديدة...",
                save: "حفظ",
                quotaMessage: "والله كنعتذرو ليك 😢 دابا سالا الحد الشهري ديال التعامل مع الذكاء الإصطناعي وهادشي كيوقع بسبب كثرة الطلبات على هاد النموذج ولا بسبب الضغط الكبير عليه من المستخدمين، ولكن عادي ماتهزش لهم وماتقلقش كل ما عليك هو تسنا العد التنازلي يسالي باش تدخل فبداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "سوايع",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة لهبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صحيح:",
                gameLoadingFirst: "كنوجد ليك أول سؤال واعر...",
                nextQuestionButton: "السؤال لي موراه",
                explanationTitle: "التفسير:",
                closeButton: "سد",
                gameInfoText: "الأسئلة ماشي واجدة ومخزنة، بل كيتولدو الأسئلة والخيارات والتفسير مباشرة بالذكاء الإصطناعي بشكل غير محدود. يقدر يوقع صياغة ديال شي سؤال ولا خيارات ولا تفسير ماشي متناسق ولكن هاد الأمر نادر، مع العلم أنه تم بذل جهد باش نحافظو على صياغة متناسقة قدر الإمكان.",
                gotItButton: "واخا",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي ولكن فيه شوية ديال الضحك', 'اهبل بس عن ذكاء': 'مهبول ولكن بذكاء', 'اهبل رسمي': 'مهبول رسمي', 'ثقيل دم وسخيف': 'تقيل دم وباسل', 'بحب النكت كثير': 'كيعجبوه النكت بزاف' },
                errorOccurred: "كتب شي حاجة !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "سمع شوف هاد التطبيق الواعر لي بصح الأسلوب ديالو غريب وكيضحك من القلب، كنصحك تجربه أنا جربتو وعجبني بزاف للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "المتصفح ديالك مكيدعمش خاصية المشاركة المباشرة. تقدر تنسخ الرابط وتبارطاجيه بيديك.",
                webShareError: "فشلت عملية المشاركة. عاود مرة خرى ولا نسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>مسح المحادثة؟</b>",
                confirmDeleteChatMessage: "واش متأكد باغي تمسح هاد المحادثة بصفة نهائية؟",
                delete: "مسح",
                chatDeleted: "تمسحت المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "عافاك عمّر جميع المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "عاود اللعبة",
                muteMusicTitle: "صمّت الموسيقى",
                muteSfxTitle: "صمّت المؤثرات الصوتية",
                gameLoadingNew: "كنوجد ليك سؤال جديد...",
            },
            'ar-DZ': { // Algerian
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "سقسيني سؤال كيما وجهك",
                inputPlaceholderInitial: "أكتب السؤال نتاعك ..",
                sendButtonInitial: "يالا نشوفو",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "أكتب الرسالة نتاعك...",
                usageLimitNote: "ملاحظة: كاينة حصة شهرية للاستعمال تتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات لي فاتو:",
                longPressHint: "(أعبز وبقى معبز باش تسمي ولا تمحي ولا تثبت المحادثة)",
                noPreviousChats: "ماكانش محادثات فاتو ضرك.",
                theme: "التام:",
                light: "فاتح",
                dark: "مظلم",
                auto: "تلقائي",
                habalLevel: "نيفو تاع لهبال:",
                enterYourInfo: "عرفني بروحك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ماتشحش على صاحبك بهاد لابليكاسيون",
                rateUs: "قيمنا وماتحشمش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "نيفو تاع لهبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "خير اللهجة نتاعك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم:",
                ageLabel: "شحال في عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هاد المعلومات غير باش نموذج الذكاء الإصطناعي يتفاعل معاك على أساسها، مثلا يعيطلك باسمك ويرد عليك على حساب جنسك وعمرك، هذا ماكان\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "من بعد",
                shareIOSPrompt: "بارطاجي لابليكاسيون مع صاحبك لي عندو أيفون:",
                shareAndroidPrompt: "بارطاجي لابليكاسيون مع صاحبك لي عندو أندرويد:",
                shareActionText: "مشاركة",
                ok: "صحا",
                ratingTitle: "رايك يهمنا!",
                rateOnStore: "قيمنا فالمتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "محو المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "أدخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله رانا متأسفين ليك 😢 ضرك خلاص الحد الشهري تاع التعامل مع الذكاء الإصطناعي وهادي الحاجة تصير بسّبة كثرة الطلبات على هاد النموذج ولا بسّبة الضغط الكبير عليه من المستعملين، بصح عادي ما يهمكش وماتتقلقش كل ما عليك هو تستنى العد التنازلي يخلاص باش تدخل في بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "سوايع",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة لهبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صحيح:",
                gameLoadingFirst: "راني نوجدلك أول سؤال شباب...",
                nextQuestionButton: "السؤال لي موراه",
                explanationTitle: "التفسير:",
                closeButton: "أغلق",
                gameInfoText: "الأسئلة ماشي واجدة ومخزنة، بل يتم توليدها بالخيارات والتفسير مباشرة بالذكاء الإصطناعي بشكل غير محدود. قادرة تصرالها صياغة تاع سؤال ولا خيارات ولا تفسير ماشي متناسق بصح هاد الحاجة نادرة، مع العلم أنه تم بذل جهد باش نحافظو على صياغة متناسقة قد ما نقدرو.",
                gotItButton: "صحا",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي بصح يضحك شوية', 'اهبل بس عن ذكاء': 'مهبول بصح بذكاء', 'اهبل رسمي': 'مهبول رسمي', 'ثقيل دم وسخيف': 'ثقيل دم وسامط', 'بحب النكت كثير': 'يحب النكت بزاف' },
                errorOccurred: "أكتب كاش حاجة !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف هاد لابليكاسيون المميزة لي صح أسلوبها غريب وتضحك من القلب، ننصحك تجربها أنا جربتها وعجبتني بزاف للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "المتصفح نتاعك مايدعمش خاصية المشاركة المباشرة. تقدر تنسخ الرابط وتبارطاجيه بيدك.",
                webShareError: "فشلت عملية المشاركة. سيي مرة خرى ولا نسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>محو المحادثة؟</b>",
                confirmDeleteChatMessage: "راك متأكد بلي حاب تمحي هاد المحادثة بشكل نهائي؟",
                delete: "محو",
                chatDeleted: "تمحّات المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "من فضلك عمّر كامل المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "عاود اللعبة",
                muteMusicTitle: "صمّت الموسيقى",
                muteSfxTitle: "صمّت المؤثرات الصوتية",
                gameLoadingNew: "راني نوجدلك سؤال جديد...",
            },
            'ar-LY': { // Libyan
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال زي وجهك",
                inputPlaceholderInitial: "اكتب السؤال ..",
                sendButtonInitial: "هيّا نشوفو",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "اكتب رسالتك...",
                usageLimitNote: "ملاحظة: فيه حد شهري للاستخدام يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة:",
                longPressHint: "(اضغط باستمرار لتسمية أو مسح أو تثبيت المحادثة)",
                noPreviousChats: "مافيش محادثات سابقة لتوا.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "داكن",
                auto: "تلقائي",
                habalLevel: "مستوى الهبال:",
                enterYourInfo: "عرفني بروحك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ماتبخلش على صاحبك بالتطبيق هذا",
                rateUs: "قيمنا وماتتحشمش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختار لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم:",
                ageLabel: "كم عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"المعلومات هذي بس عشان نموذج الذكاء الاصطناعي يتفاعل معاك على أساسها، مثلاً يناديك باسمك ويرد عليك حسب جنسك وعمرك هكي بس\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعدين",
                shareIOSPrompt: "شارك التطبيق مع صاحبك اللي عنده أيفون:",
                shareAndroidPrompt: "شارك التطبيق مع صاحبك اللي عنده أندرويد:",
                shareActionText: "مشاركة",
                ok: "باهي",
                ratingTitle: "رأيك يهمنا!",
                rateOnStore: "قيمنا على المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "مسح المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "دخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله إحني آسفين ليك 😢 حالياً الحد الشهري للتعامل مع الذكاء الاصطناعي تم وهذا يصير بسبب كثرة الطلبات على النموذج هذا أو بسبب الضغط الشديد عليه من المستخدمين، لكن عادي ولا يهمك وماتقلقش كل اللي عليك إنك تستنى العد التنازلي يكمل عشان تخش على بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صح:",
                gameLoadingFirst: "قاعد نجهزلك في أول سؤال سمح...",
                nextQuestionButton: "السؤال اللي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة مش واتية ومخزنة، لكن يتم توليدها بالخيارات والتفسير طول بالذكاء الاصطناعي بشكل لا محدود. ممكن تصير صياغة لسؤال أو خيارات أو تفسير مش متناسق لكن الموضوع هذا نادر، مع العلم إنه تم بذل جهد للحفاظ على الصياغة متناسقة قدر الإمكان.",
                gotItButton: "باهي",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي لكن دمه خفيف شوية', 'اهبل بس عن ذكاء': 'مهبول لكن بذكاء', 'اهبل رسمي': 'مهبول رسمي', 'ثقيل دم وسخيف': 'دمه ثقيل وبايخ', 'بحب النكت كثير': 'يحب النكت هلبا' },
                errorOccurred: "اكتب شي !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف التطبيق المميز هذا اللي فعلاً أسلوبه غريب ويضحك من القلب، ننصحك تجربه أنا جربته وعجبني هلبا للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك مايدعمش خاصية المشاركة المباشرة. تقدر تنسخ الرابط وتشاركه بروحك.",
                webShareError: "فشلت عملية المشاركة. حاول مرة تانية أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>مسح المحادثة؟</b>",
                confirmDeleteChatMessage: "متأكد إنك تبي تمسح المحادثة هذي بشكل نهائي؟",
                delete: "مسح",
                chatDeleted: "تم مسح المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "لو سمحت عبي كل المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "قاعد نجهزلك في سؤال جديد...",
            },
            'ar-TN': { // Tunisian
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال كيف وجهك",
                inputPlaceholderInitial: "أكتب السؤال متاعك ..",
                sendButtonInitial: "يالا نشوفو",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "أكتب الميساج متاعك...",
                usageLimitNote: "ملاحظة: فمة حد شهري للاستعمال يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات إلي فاتت:",
                longPressHint: "(انزل مطولاً باش تسمي وإلا تفسخ وإلا تثبت المحادثة)",
                noPreviousChats: "ما فماش محادثات سابقة توا.",
                theme: "التام:",
                light: "فاتح",
                dark: "مظلم",
                auto: "تلقائي",
                habalLevel: "مستوى لهبال:",
                enterYourInfo: "عرفني على روحك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ماتبخلش على صاحبك بالتطبيق هذا",
                rateUs: "قيمنا وماتحشمش",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى لهبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختار اللهجة متاعك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم:",
                ageLabel: "قداش عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"المعلومات هاذي كان بش نموذج الذكاء الإصطناعي يتفاعل معاك على أساسها، مثلا يعيطلك باسمك ويجاوبك حسب جنسك وعمرك، أكهو\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعد",
                shareIOSPrompt: "بارطاجي التطبيق مع صاحبك إلي عندو أيفون:",
                shareAndroidPrompt: "بارطاجي التطبيق مع صاحبك إلي عندو أندرويد:",
                shareActionText: "مشاركة",
                ok: "باهي",
                ratingTitle: "رايك يهمنا!",
                rateOnStore: "قيمنا ع المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "فسخ المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "دخل الإسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله أحنا متأسفين ليك 😢 توا وفا الحد الشهري متاع التعامل مع الذكاء الإصطناعي والحكاية هاذي تصير على خاطر كثرة الطلبات على النموذج هذا وإلا على خاطر الضغط الكبير عليه من المستعملين، أما عادي ما يهمكش وما تتقلقش كل ما عليك هو إنك تستنى العد التنازلي يوفى بش تدخل في بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "سوايع",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة لهبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "غالط:",
                correctLabel: "صحيح:",
                gameLoadingFirst: "قاعد نحضرلك في أول سؤال مزيان...",
                nextQuestionButton: "السؤال إلي بعدو",
                explanationTitle: "التفسير:",
                closeButton: "سكر",
                gameInfoText: "الأسئلة موش حاضرة ومخزنة، أما يتم توليدها بالخيارات والتفسير مباشرة بالذكاء الإصطناعي بشكل غير محدود. ينجم يصير صياغة متاع سؤال وإلا خيارات وإلا تفسير موش متناسق أما الحكاية هاذي نادرة، مع العلم أنه تم بذل جهد بش نحافظو على صياغة متناسقة قد ما نجمو.",
                gotItButton: "باهي",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي أما يضحك شوية', 'اهبل بس عن ذكاء': 'مهبول أما بذكاء', 'اهبل رسمي': 'مهبول رسمي', 'ثقيل دم وسخيف': 'دمو ثقيل وباسل', 'بحب النكت كثير': 'يحب النكت برشة' },
                errorOccurred: "أكتب حاجة !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف التطبيق الباهي هذا إلي بالرسمي أسلوبو غريب ويضحك من القلب، ننصحك تجربو أنا جربتو وعجبني برشة للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "المتصفح متاعك مايدعمش خاصية المشاركة المباشرة. تنجم تنسخ الرابط وتبارطاجيه وحدك.",
                webShareError: "فشلت عملية المشاركة. عاود مرة أخرى وإلا انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>تفسخ المحادثة؟</b>",
                confirmDeleteChatMessage: "متأكد تحب تفسخ المحادثة هاذي بصفة نهائية؟",
                delete: "فسخ",
                chatDeleted: "تفصخت المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "يرجى تعمير المعلومات الكل",
                infoButtonTitle: "معلومات",
                resetGameTitle: "عاود اللعبة",
                muteMusicTitle: "صمّت الموسيقى",
                muteSfxTitle: "صمّت المؤثرات الصوتية",
                gameLoadingNew: "قاعد نحضرلك في سؤال جديد...",
            },
            'ar-KW': { // Kuwaiti
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "سألني سؤال نفس ويهك",
                inputPlaceholderInitial: "حط سؤالك ..",
                sendButtonInitial: "يلا نشوف",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "حط رسالتك...",
                usageLimitNote: "ملاحظة: في حد شهري للاستخدام يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة:",
                longPressHint: "(علّق صبعك عشان تسمي أو تحذف أو تثبت المحادثة)",
                noPreviousChats: "ماكو محادثات سابقة للحين.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "غامج",
                auto: "تلقائي",
                habalLevel: "مستوى الخبال:",
                enterYourInfo: "عرفني على نفسك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "لا تبخل على رفيجك بهالتطبيق",
                rateUs: "قيمنا ولا تستحي",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الخبال",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختر لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم الكريم:",
                ageLabel: "جم عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هالمعلومات بس عشان نموذج الذكاء الاصطناعي يتفاعل وياك على أساسها، مثلاً يناديك باسمك ويرد عليك حسب جنسك وعمرك بس\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعدين",
                shareIOSPrompt: "شارك التطبيق مع رفيجك اللي عنده آيفون:",
                shareAndroidPrompt: "شارك التطبيق مع رفيجك اللي عنده أندرويد:",
                shareActionText: "مشاركة",
                ok: "زين",
                ratingTitle: "رايك يهمنا!",
                rateOnStore: "قيمنا بالمتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "حذف المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "حط الاسم اليديد...",
                save: "حفظ",
                quotaMessage: "والله حنّا آسفين لك 😢 الحين خلص الحد الشهري للتعامل مع الذكاء الاصطناعي وهالشي يصير بسبب كثرة الطلبات على هالنموذج أو بسبب الضغط الشديد عليه من المستخدمين، بس عادي ولا يهمك ولا تحاتي كل اللي عليك إنك تنطر العد التنازلي يخلص عشان تدش بداية شهر يديد وبالتالي حد شهري يديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة الخبال الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صح:",
                gameLoadingFirst: "قاعد أجهز لك أول سؤال عدل...",
                nextQuestionButton: "السؤال اللي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة مو جاهزة ومخزنة، بس يتم توليدها مع الخيارات والتفسير دايركت بالذكاء الاصطناعي بشكل لا محدود. يمكن تصير صياغة لسؤال أو خيارات أو تفسير مو متناسق بس هالشي نادر، مع العلم إنه تم بذل جهد عشان نحافظ على الصياغة متناسقة كثر ما نقدر.",
                gotItButton: "زين",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي بس دمه خفيف شوي', 'اهبل بس عن ذكاء': 'خبل بس بذكاء', 'اهبل رسمي': 'خبل رسمي', 'ثقيل دم وسخيف': 'ثقيل طينة وسخيف', 'بحب النكت كثير': 'يحب النكت وايد' },
                errorOccurred: "اكتب شي !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف هالتطبيق المميز اللي صج أسلوبه غريب ويضحك من قلب، أنصحك تجربه أنا جربته وعجبني وايد للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك ما يدعم خاصية المشاركة المباشرة. تقدر تنسخ الرابط وتشاركه بنفسك.",
                webShareError: "فشلت عملية المشاركة. حاول مرة ثانية أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوي",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>حذف المحادثة؟</b>",
                confirmDeleteChatMessage: "متأكد تبي تحذف هالمحادثة بشكل نهائي؟",
                delete: "حذف",
                chatDeleted: "تم حذف المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "الرجاء تعبئة كل المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "صك الموسيقى",
                muteSfxTitle: "صك المؤثرات الصوتية",
                gameLoadingNew: "قاعد أجهز لك سؤال جديد...",
            },
            'ar-YE': { // Yemeni
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال مثل وجهك",
                inputPlaceholderInitial: "اكتب السؤال حقك ..",
                sendButtonInitial: "يالله نشوف",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "اكتب رسالتك...",
                usageLimitNote: "ملاحظة: يوجد حد شهري للاستخدام يتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات السابقة:",
                longPressHint: "(اضغط باستمرار لتسمية أو حذف أو تثبيت المحادثة)",
                noPreviousChats: "ما به أي محادثات سابقة للآن.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "غامق",
                auto: "تلقائي",
                habalLevel: "مستوى الهبالة:",
                enterYourInfo: "عرفني بنفسك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "لا تبخل على صاحبك بهذا التطبيق",
                rateUs: "قيمنا ولا تستحي",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبالة",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختر لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم الكريم:",
                ageLabel: "كم عمرك؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"هذه المعلومات بس عشان نموذج الذكاء الاصطناعي يتفاعل معك على أساسها، مثلاً يناديك باسمك ويرد عليك بحسب جنسك وعمرك هكذا وبس\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "بعدين",
                shareIOSPrompt: "شارك التطبيق مع صاحبك الذي معه آيفون:",
                shareAndroidPrompt: "شارك التطبيق مع صاحبك الذي معه أندرويد:",
                shareActionText: "مشاركة",
                ok: "تمام",
                ratingTitle: "رأيك يهمنا!",
                rateOnStore: "قيمنا على المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "حذف المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "أدخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله إحنا آسفين لك 😢 حالياً قد خلص الحد الشهري للتعامل مع الذكاء الاصطناعي وهذا الشيء يحصل بسبب كثرة الطلبات على هذا النموذج أو بسبب الضغط الشديد عليه من المستخدمين، بس عادي ولا يهمك ولا تقلق كل ما عليك هو أنك تنتظر العد التنازلي يخلص عشان تدخل على بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقائق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبالة الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "خطأ:",
                correctLabel: "صح:",
                gameLoadingFirst: "جالس أجهز لك أول سؤال حالي...",
                nextQuestionButton: "السؤال الذي بعده",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة ما هي جاهزة ومخزنة، لكن يتم توليدها مع الخيارات والتفسير مباشرة بالذكاء الاصطناعي بشكل لا محدود. قد يحصل صياغة لسؤال أو خيارات أو تفسير غير متناسق لكن هذا الأمر نادر، مع العلم إنه تم بذل جهد للحفاظ على الصياغة متناسقة قدر الإمكان.",
                gotItButton: "تمام",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جدي بس فيه شوية مرح', 'اهبل بس عن ذكاء': 'أهبل بس بذكاء', 'اهبل رسمي': 'أهبل رسمي', 'ثقيل دم وسخيف': 'ثقيل دم وسخيف', 'بحب النكت كثير': 'يحب النكت قوي' },
                errorOccurred: "اكتب شي !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف هذا التطبيق المميز الذي فعلاً أسلوبه غريب ويضحك من القلب، أنصحك تجربه أنا جربته وعجبني قوي للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك لا يدعم خاصية المشاركة المباشرة. يمكنك نسخ الرابط ومشاركته يدوياً.",
                webShareError: "فشلت عملية المشاركة. حاول مرة أخرى أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>حذف المحادثة؟</b>",
                confirmDeleteChatMessage: "هل أنت متأكد أنك تشتي تحذف هذه المحادثة بشكل نهائي؟",
                delete: "حذف",
                chatDeleted: "تم حذف المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "الرجاء تعبئة جميع المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "جالس أجهز لك سؤال جديد...",
            },
            'ar-SD': { // Sudanese
                pageTitle: "هَبَل AI",
                mainTitle: "هَــبَــل AI",
                askMe: "اسألني سؤال قدر وشك ده",
                inputPlaceholderInitial: "خت سؤالك ..",
                sendButtonInitial: "يلا نعاين",
                gameButton: "اللعبة",
                copyright: "جميع حقوق النشر محفوظة 2025©",
                mustafaDeveloped: "تم تطوير هذا النموذج بواسطة مصطفى حشايكة",
                chatButton: "المحادثة",
                chatInputPlaceholder: "خت رسالتك...",
                usageLimitNote: "ملحوظة: في حد شهري للاستخدام بتجدد كل شهر",
                settings: "الإعدادات",
                previousChats: "المحادثات الفاتت:",
                longPressHint: "(دوس مسافة عشان تسمي أو تحذف أو تثبت المحادثة)",
                noPreviousChats: "مافي أي محادثات فاتت هسي.",
                theme: "الثيم:",
                light: "فاتح",
                dark: "مظلم",
                auto: "تلقائي",
                habalLevel: "مستوى الهبالة:",
                enterYourInfo: "عرفني بنفسك",
                languageAndDialect: "اللغة واللهجة",
                shareWithPal: "ما تبخل على صاحبك بالتطبيق ده",
                rateUs: "قيمنا وما تخجل",
                aboutApp: "حول التطبيق",
                privacyPolicy: "سياسة الخصوصية",
                contact: "تواصل معنا",
                habalLevelTitle: "مستوى الهبالة",
                cancel: "إلغاء",
                confirm: "تأكيد",
                languagePopupTitle: "",
                languageSettingsTitle: "إعدادات اللغة واللهجة",
                arabic: "العربية",
                english: "English",
                chooseDialect: "اختار لهجتك",
                chooseAccent: "Choose your accent",
                nameLabel: "الاسم:",
                ageLabel: "عمرك كم؟",
                genderLabel: "الجنس:",
                male: "ذكر",
                female: "أنثى",
                alien: "مخلوق فضائي",
                other: "آخر",
                userInfoNote: "\"المعلومات دي بس عشان نموذج الذكاء الاصطناعي يتفاعل معاك على أساسها، مثلاً يناديك باسمك ويرد عليك حسب نوعك وعمرك وبس\"",
                saveAndContinue: "حفظ ومتابعة",
                skip: "لبعدين",
                shareIOSPrompt: "شارك التطبيق مع صاحبك العندو آيفون:",
                shareAndroidPrompt: "شارك التطبيق مع صاحبك العندو أندرويد:",
                shareActionText: "مشاركة",
                ok: "تمام",
                ratingTitle: "رأيك بهمنا!",
                rateOnStore: "قيمنا في المتجر",
                renameChat: "تسمية المحادثة",
                pinChat: "تثبيت المحادثة",
                unpinChat: "إلغاء تثبيت المحادثة",
                deleteChat: "حذف المحادثة",
                renameChatTitle: "إعادة تسمية المحادثة",
                renameChatPlaceholder: "أدخل الاسم الجديد...",
                save: "حفظ",
                quotaMessage: "والله نحنا متأسفين ليك 😢 هسي الحد الشهري للتعامل مع الذكاء الاصطناعي خلص وده بحصل بسبب كترة الطلبات على النموذج ده أو بسبب الضغط الشديد عليه من المستخدمين، لكن عادي وما يهمك وما تقلق كل العليك إنك تستنى العد التنازلي ينتهي عشان تخش على بداية شهر جديد وبالتالي حد شهري جديد واستمتع! 😍",
                days: "أيام",
                hours: "ساعات",
                minutes: "دقايق",
                seconds: "ثواني",
                gameTitle: "لعبة الهبالة الذكية AI",
                questionsLabel: "الأسئلة:",
                wrongLabel: "غلط:",
                correctLabel: "صح:",
                gameLoadingFirst: "قاعد أجهز ليك أول سؤال ظابط...",
                nextQuestionButton: "السؤال البعدو",
                explanationTitle: "التفسير:",
                closeButton: "إغلاق",
                gameInfoText: "الأسئلة ما جاهزة ومخزنة، لكن بتولد الأسئلة والخيارات والتفسير طوالي بالذكاء الاصطناعي بشكل ما محدود. ممكن يحصل صياغة لسؤال أو خيارات أو تفسير ما متناسق لكن الحاجة دي نادرة، مع العلم إنه تم بذل جهد عشان نحافظ على الصياغة متناسقة قدر الإمكان.",
                gotItButton: "تمام",
                dialects: { 'ar-PS': 'فلسطينية', 'ar-EG': 'مصرية', 'ar-SA': 'سعودية', 'ar-MA': 'مغربية', 'ar-DZ': 'جزائرية', 'ar-LY': 'ليبية', 'ar-TN': 'تونسية', 'ar-KW': 'كويتية', 'ar-YE': 'يمنية', 'ar-SD': 'سودانية' },
                habalLevels: { 'جدي بس مرح شوي': 'جاد لكن ظريف شوية', 'اهبل بس عن ذكاء': 'أهبل لكن بذكاء', 'اهبل رسمي': 'أهبل رسمي', 'ثقيل دم وسخيف': 'دمو تقيل وسخيف', 'بحب النكت كثير': 'بحب النكات شديد' },
                errorOccurred: "اكتب حاجة !",
                noInput: "",
                shareTitleIOS: "شارك التطبيق مع صديقك الأيفوني ابو التفاحة",
                shareTitleAndroid: "شارك التطبيق مع صديقك الأندرويدي ابو الروبوت الأخضر",
                shareTitleDefault: "اكتشف تطبيق هبل AI!",
                shareText: "اسمع شوف التطبيق المميز ده الأسلوبو غريب وبضحك من القلب جد، بنصحك تجربو أنا جربتو وعجبني شديد للأمانة",
                webShareNotSupportedTitle: "المشاركة غير مدعومة",
                webShareNotSupportedMessage: "متصفحك ما بدعم خاصية المشاركة المباشرة. ممكن تنسخ الرابط وتشاركو براك.",
                webShareError: "فشلت عملية المشاركة. حاول مرة تانية أو انسخ الرابط.",
                onboardingUserInfoTitle: "عرفنا عليك شوية",
                aboutAppText: "هبل AI هو محاكاة لتطبيق ذكاء اصطناعي فريد من نوعه، مصمم ليكون مسلياً ومختلفاً. يهدف التطبيق إلى تقديم تجربة تفاعلية ممتعة بأسلوب فكاهي.\nتم تطويره بحب وشغف ليرسم البسمة على وجوهكم. نأمل أن تستمتعوا به وتشاركونا الضحكة في كل لحظة استخدام.\nفي كل مرة تطرح فيها سؤالاً، توقّع إجابة غير متوقعة! من الطرافة العفوية إلى التعليقات الساخرة، هبل AI لا يأخذ الأمور على محمل الجد\nبل يأخذك في رحلة من الضحك والمواقف الغريبة.\nسواء كنت تبحث عن فكاهة خفيفة بعد يوم طويل، أو تريد إبهار أصدقائك بردود لا تخطر على بال\nفإن هبل AI هو رفيقك المثالي للترفيه والتسلية.\nجربه الآن ! وكن مستعداً لتكتشف جانباً مجنوناً وجديداً من الذكاء الاصطناعي .\nلعبة الهبل الذكية AI ، هي لعبة ترفيهية مدعومة بالذكاء الاصطناعي، تمزج بين الأسئلة الذكية واللمسات العشوائية الطريفة.\nتواجه فيها ألغازًا وأسئلة غير تقليدية، بعضها منطقي وبعضها يبدو وكأنه قادم من عالم آخر!\nالذكاء الاصطناعي هنا يُستخدم لتوليد الأسئلة بطريقة مبتكرة وغير متوقعة، مما يضفي طابعًا فريدًا على كل جولة.\nهل أنت مستعد لتحدي ذكاء اصطناعي يتمتع بحس فكاهي غريب؟ هذه اللعبة ستربكك وتُضحكك في آنٍ واحد!",
                privacyPolicyText: "نحن في تطبيق هبل AI نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية.\nلا نقوم بجمع أي معلومات تعريفية مثل البريد الإلكتروني أو الموقع الجغرافي.\nيُطلب من المستخدم بشكل اختياري إدخال اسمه، عمره، وجنسه بهدف تحسين التفاعل داخل التطبيق فقط. هذه المعلومات تُستخدم ليتمكن الذكاء الاصطناعي من تخصيص الردود، مثل مناداة المستخدم باسمه أو تعديل أسلوب الرد حسب عمره أو جنسه.\nيتم تخزين هذه المعلومات محليًا في جهازك فقط عبر localStorage ولا تتم مشاركتها مع أي خادم خارجي أو جهة ثالثة.\nالمحادثات السابقة يتم تخزينها أيضًا في localStorage على جهازك، ويمكنك حذفها في أي وقت من الإعدادات.\nباستخدامك للتطبيق، فإنك توافق على هذه السياسة. قد نقوم بتحديثها في المستقبل، وسيتم إعلامك بأي تغييرات داخل التطبيق.\nلأي استفسار بخصوص سياسة الخصوصية، يمكنك التواصل معنا عبر معلومات الدعم داخل التطبيق.",
                contactUsText: "يسعدنا دائماً سماع آرائكم واقتراحاتكم وافكاركم حول تطبيق هبل AI!\nإذا كان لديك أي سؤال، أو واجهتك مشكلة، أو حتى لو أردت فقط أن تقول مرحباً، يمكنك التواصل معنا عبر هذا البريد الأكتروني : راسلنا.\nأو تواصل معنا عبر صفحتنا على الانستغرام\nاضغط هنا.\nنحاول الرد على جميع الرسائل في أقرب وقت ممكن. شكراً لاهتمامك! .",
                confirmDeleteChatTitle: "<b>حذف المحادثة؟</b>",
                confirmDeleteChatMessage: "متأكد إنك داير تحذف المحادثة دي بشكل نهائي؟",
                delete: "حذف",
                chatDeleted: "تم حذف المحادثة.",
                generatingTitle: "جاري إنشاء عنوان...",
                levelSaved: "تم حفظ المستوى",
                userInfoSaved: "تم حفظ معلومات المستخدم بنجاح",
                fillAllInfo: "لو سمحت املأ كل المعلومات",
                infoButtonTitle: "معلومات",
                resetGameTitle: "إعادة اللعبة",
                muteMusicTitle: "كتم الموسيقى",
                muteSfxTitle: "كتم المؤثرات الصوتية",
                gameLoadingNew: "قاعد أجهز ليك سؤال جديد...",
            },
            // ENGLISH DIALECTS
            'en-US': { // American English
                pageTitle: "Wacky AI",
                mainTitle: "Wacky AI",
                askMe: "Ask me somethin' goofy",
                inputPlaceholderInitial: "Drop your question here..",
                sendButtonInitial: "Let's see it",
                gameButton: "The Game",
                copyright: "©2025 All rights reserved",
                mustafaDeveloped: "This model was developed by Mustafa Hashaika",
                chatButton: "Chat",
                chatInputPlaceholder: "Type your message...",
                usageLimitNote: "Note: There's a monthly usage limit that resets each month",
                settings: "Settings",
                previousChats: "Past Chats:",
                longPressHint: "(Long press to rename, delete, or pin chat)",
                noPreviousChats: "No past chats yet.",
                theme: "Theme:",
                light: "Light",
                dark: "Dark",
                auto: "Auto",
                habalLevel: "Wackiness Level:",
                enterYourInfo: "Tell me about yourself",
                languageAndDialect: "Language & Dialect",
                shareWithPal: "Don't be stingy, share this app with your buddy",
                rateUs: "Rate us, don't be shy",
                aboutApp: "About the App",
                privacyPolicy: "Privacy Policy",
                contact: "Contact Us",
                habalLevelTitle: "Wackiness Level",
                cancel: "Cancel",
                confirm: "Confirm",
                languagePopupTitle: "",
                languageSettingsTitle: "Language & Dialect Settings",
                arabic: "العربية",
                english: "English",
                chooseDialect: "Choose your dialect",
                chooseAccent: "Choose your accent",
                nameLabel: "Name:",
                ageLabel: "How old are you?",
                genderLabel: "Gender:",
                male: "Male",
                female: "Female",
                alien: "Alien",
                other: "Other",
                userInfoNote: "\"This info is just so the AI model can interact with you based on it, like calling you by your name and replying based on your gender and age, that's all\"",
                saveAndContinue: "Save & Continue",
                skip: "Later",
                shareIOSPrompt: "Share the app with your iPhone friend:",
                shareAndroidPrompt: "Share the app with your Android friend:",
                shareActionText: "Share",
                ok: "Okay",
                ratingTitle: "Your opinion matters!",
                rateOnStore: "Rate us on the store",
                renameChat: "Rename Chat",
                pinChat: "Pin Chat",
                unpinChat: "Unpin Chat",
                deleteChat: "Delete Chat",
                renameChatTitle: "Rename Chat",
                renameChatPlaceholder: "Enter the new name...",
                save: "Save",
                quotaMessage: "We're really sorry 😢 The monthly limit for interacting with the AI has been reached. This happens due to a high number of requests or heavy usage. But no worries, just wait for the countdown to finish for the new month to start, and with it, a new monthly limit. Enjoy! 😍",
                days: "Days",
                hours: "Hours",
                minutes: "Minutes",
                seconds: "Seconds",
                gameTitle: "Wacky AI Smart Game",
                questionsLabel: "Questions:",
                wrongLabel: "Wrong:",
                correctLabel: "Correct:",
                gameLoadingFirst: "Prepping the first cool question for you...",
                nextQuestionButton: "Next Question",
                explanationTitle: "Explanation:",
                closeButton: "Close",
                gameInfoText: "The questions aren't pre-made. Instead, the questions, options, and explanations are generated on the fly by the AI, endlessly. Sometimes the wording might be a bit off, but that's rare. We've tried our best to keep things consistent.",
                gotItButton: "Got it",
                dialects: { 'en-US': 'American', 'en-GB': 'British' },
                habalLevels: { 'جدي بس مرح شوي': 'Serious but a bit fun', 'اهبل بس عن ذكاء': 'Goofy but smart', 'اهبل رسمي': 'Officially Goofy', 'ثقيل دم وسخيف': 'Annoying and silly', 'بحب النكت كثير': 'Loves jokes a lot' },
                errorOccurred: "Type something!",
                noInput: "",
                shareTitleIOS: "Share Wacky AI with your iPhone friend!",
                shareTitleAndroid: "Share Wacky AI with your Android friend!",
                shareTitleDefault: "Discover Wacky AI!",
                shareText: "Yo, check out this awesome app. Its style is seriously weird and hilarious, I recommend you try it. I tried it and honestly, I really liked it.",
                webShareNotSupportedTitle: "Sharing not supported",
                webShareNotSupportedMessage: "Your browser doesn't support direct sharing. You can copy the link and share it manually.",
                webShareError: "Sharing failed. Try again or copy the link.",
                onboardingUserInfoTitle: "Tell us a bit about you",
                aboutAppText: "Wacky AI is a simulation of a unique artificial intelligence application, designed to be entertaining and different. The app aims to provide a fun interactive experience with a humorous style.\nIt was developed with love and passion to bring a smile to your faces. We hope you enjoy it and share a laugh with us in every moment of use.\nEvery time you ask a question, expect an unexpected answer! From spontaneous wit to sarcastic comments, Wacky AI doesn't take things seriously but takes you on a journey of laughter and strange situations.\nWhether you're looking for light humor after a long day, or want to impress your friends with responses that are out of this world, Wacky AI is your perfect companion for entertainment and fun.\nTry it now! And be ready to discover a crazy and new side of artificial intelligence.\nThe Wacky AI Smart Game is an entertainment game powered by artificial intelligence, blending smart questions with amusingly random touches.\nYou will face unconventional puzzles and questions, some logical and others that seem to come from another world!\nThe AI here is used to generate questions in an innovative and unexpected way, adding a unique character to each round.\nAre you ready to challenge an AI with a strange sense of humor? This game will confuse and amuse you at the same time!",
                privacyPolicyText: "At Wacky AI, we respect your privacy and are committed to protecting your personal data.\nWe do not collect any personally identifiable information such as email or geographic location.\nThe user is optionally asked to enter their name, age, and gender for the sole purpose of improving the in-app interaction. This information is used to allow the AI to personalize responses, such as addressing the user by name or adjusting the reply style according to their age or gender.\nThis information is stored locally on your device only via localStorage and is not shared with any external server or third party.\nPrevious conversations are also stored in your device's localStorage, and you can delete them at any time from the settings.\nBy using the app, you agree to this policy. We may update it in the future, and you will be notified of any changes within the app.\nFor any inquiries regarding the privacy policy, you can contact us through the support information within the app.",
                contactUsText: "We are always happy to hear your opinions, suggestions, and ideas about the Wacky AI app!\nIf you have any questions, encounter a problem, or even if you just want to say hello, you can contact us via this email: Contact Us.\nOr reach out to us on our Instagram page\nClick here.\nWe try to respond to all messages as soon as possible. Thank you for your interest! .",
                confirmDeleteChatTitle: "<b>Delete Chat?</b>",
                confirmDeleteChatMessage: "Are you sure you want to permanently delete this chat?",
                delete: "Delete",
                chatDeleted: "Chat deleted.",
                generatingTitle: "Generating title...",
                levelSaved: "Level saved",
                userInfoSaved: "User info saved successfully",
                fillAllInfo: "Please fill out all the info",
                infoButtonTitle: "Info",
                resetGameTitle: "Reset Game",
                muteMusicTitle: "Mute Music",
                muteSfxTitle: "Mute SFX",
                gameLoadingNew: "Prepping a new question...",
            },
            'en-GB': { // British English
                pageTitle: "Wacky AI",
                mainTitle: "Wacky AI",
                askMe: "Ask me a daft question",
                inputPlaceholderInitial: "Pop your question in here..",
                sendButtonInitial: "Right then, let's see",
                gameButton: "The Game",
                copyright: "©2025 All rights reserved",
                mustafaDeveloped: "This model was developed by Mustafa Hashaika",
                chatButton: "Chat",
                chatInputPlaceholder: "Type your message...",
                usageLimitNote: "Please note: There is a monthly usage limit which resets each month",
                settings: "Settings",
                previousChats: "Previous Chats:",
                longPressHint: "(Press and hold to rename, delete or pin chat)",
                noPreviousChats: "No previous chats yet.",
                theme: "Theme:",
                light: "Light",
                dark: "Dark",
                auto: "Auto",
                habalLevel: "Wackiness Level:",
                enterYourInfo: "Tell me about yourself",
                languageAndDialect: "Language & Dialect",
                shareWithPal: "Don't be tight, share this app with your mate",
                rateUs: "Rate us, don't be shy",
                aboutApp: "About the App",
                privacyPolicy: "Privacy Policy",
                contact: "Contact Us",
                habalLevelTitle: "Wackiness Level",
                cancel: "Cancel",
                confirm: "Confirm",
                languagePopupTitle: "",
                languageSettingsTitle: "Language & Dialect Settings",
                arabic: "العربية",
                english: "English",
                chooseDialect: "Choose your dialect",
                chooseAccent: "Choose your accent",
                nameLabel: "Name:",
                ageLabel: "How old are you?",
                genderLabel: "Gender:",
                male: "Male",
                female: "Female",
                alien: "Alien",
                other: "Other",
                userInfoNote: "\"This information is just so the AI model can interact with you based on it, for instance calling you by your name and replying based on your gender and age, that's it\"",
                saveAndContinue: "Save & Continue",
                skip: "Later",
                shareIOSPrompt: "Share the app with your iPhone friend:",
                shareAndroidPrompt: "Share the app with your Android friend:",
                shareActionText: "Share",
                ok: "Alright",
                ratingTitle: "Your opinion matters!",
                rateOnStore: "Rate us on the store",
                renameChat: "Rename Chat",
                pinChat: "Pin Chat",
                unpinChat: "Unpin Chat",
                deleteChat: "Delete Chat",
                renameChatTitle: "Rename Chat",
                renameChatPlaceholder: "Enter the new name...",
                save: "Save",
                quotaMessage: "We do apologise 😢 The monthly limit for interacting with the AI has been reached. This occurs due to a high volume of requests or heavy usage. But not to worry, simply wait for the countdown to finish for the new month to begin, and with it, a new monthly limit. Cheers! 😍",
                days: "Days",
                hours: "Hours",
                minutes: "Minutes",
                seconds: "Seconds",
                gameTitle: "The Daft AI Smart Game",
                questionsLabel: "Questions:",
                wrongLabel: "Incorrect:",
                correctLabel: "Correct:",
                gameLoadingFirst: "Getting the first brilliant question ready for you...",
                nextQuestionButton: "Next Question",
                explanationTitle: "Explanation:",
                closeButton: "Close",
                gameInfoText: "The questions aren't ready-made and stored. Rather, the questions, options, and explanations are generated directly by the AI, with no limit. Occasionally, the phrasing of a question, option or explanation might be inconsistent, but this is a rare occurrence. Please note that effort has been made to maintain consistent phrasing as much as possible.",
                gotItButton: "Righto",
                dialects: { 'en-US': 'American', 'en-GB': 'British' },
                habalLevels: { 'جدي بس مرح شوي': 'Serious but a bit of a laugh', 'اهبل بس عن ذكاء': 'Daft but clever', 'اهبل رسمي': 'Officially Daft', 'ثقيل دم وسخيف': 'Annoying and daft', 'بحب النكت كثير': 'Loves a good joke' },
                errorOccurred: "Write something!",
                noInput: "",
                shareTitleIOS: "Share Wacky AI with your iPhone friend!",
                shareTitleAndroid: "Share Wacky AI with your Android friend!",
                shareTitleDefault: "Discover Wacky AI!",
                shareText: "Listen, have a look at this brilliant app. Its style is genuinely odd and makes you laugh your head off. I recommend you give it a go. I've tried it and honestly, I quite liked it.",
                webShareNotSupportedTitle: "Sharing not supported",
                webShareNotSupportedMessage: "Your browser does not support direct sharing. You can copy the link and share it manually.",
                webShareError: "Sharing failed. Please try again or copy the link.",
                onboardingUserInfoTitle: "Tell us a bit about yourself",
                aboutAppText: "Wacky AI is a simulation of a unique artificial intelligence application, designed to be entertaining and different. The app aims to provide a fun interactive experience with a humorous style.\nIt was developed with love and passion to bring a smile to your faces. We hope you enjoy it and share a laugh with us in every moment of use.\nEvery time you ask a question, expect an unexpected answer! From spontaneous wit to sarcastic comments, Wacky AI doesn't take things seriously but takes you on a journey of laughter and strange situations.\nWhether you're looking for light humor after a long day, or want to impress your friends with responses that are out of this world, Wacky AI is your perfect companion for entertainment and fun.\nTry it now! And be ready to discover a crazy and new side of artificial intelligence.\nThe Wacky AI Smart Game is an entertainment game powered by artificial intelligence, blending smart questions with amusingly random touches.\nYou will face unconventional puzzles and questions, some logical and others that seem to come from another world!\nThe AI here is used to generate questions in an innovative and unexpected way, adding a unique character to each round.\nAre you ready to challenge an AI with a strange sense of humor? This game will confuse and amuse you at the same time!",
                privacyPolicyText: "At Wacky AI, we respect your privacy and are committed to protecting your personal data.\nWe do not collect any personally identifiable information such as email or geographic location.\nThe user is optionally asked to enter their name, age, and gender for the sole purpose of improving the in-app interaction. This information is used to allow the AI to personalize responses, such as addressing the user by name or adjusting the reply style according to their age or gender.\nThis information is stored locally on your device only via localStorage and is not shared with any external server or third party.\nPrevious conversations are also stored in your device's localStorage, and you can delete them at any time from the settings.\nBy using the app, you agree to this policy. We may update it in the future, and you will be notified of any changes within the app.\nFor any inquiries regarding the privacy policy, you can contact us through the support information within the app.",
                contactUsText: "We are always happy to hear your opinions, suggestions, and ideas about the Wacky AI app!\nIf you have any questions, encounter a problem, or even if you just want to say hello, you can contact us via this email: Contact Us.\nOr reach out to us on our Instagram page\nClick here.\nWe try to respond to all messages as soon as possible. Thank you for your interest! .",
                confirmDeleteChatTitle: "<b>Delete Chat?</b>",
                confirmDeleteChatMessage: "Are you sure you want to permanently delete this chat?",
                delete: "Delete",
                chatDeleted: "Chat deleted.",
                generatingTitle: "Generating title...",
                levelSaved: "Level saved",
                userInfoSaved: "User information saved successfully",
                fillAllInfo: "Please fill in all the information",
                infoButtonTitle: "Info",
                resetGameTitle: "Reset Game",
                muteMusicTitle: "Mute Music",
                muteSfxTitle: "Mute SFX",
                gameLoadingNew: "Getting a new question ready...",
            }
        };
        // --- SVG Icons ---
        const pinIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707-.195-.195.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z"/></svg>`;
        const unpinIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="unpin-icon"><path d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707-.195-.195.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z"/><path d="M2 2 L14 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" /></svg>`;

        // --- START: New Dropbox Link Functions ---
        async function getRemoteLink(url) {
          try {
            const res = await fetch(url);
             if (!res.ok) {
                throw new Error(`Network response was not ok, status: ${res.status}`);
            }
            const link = await res.text();
            return link.trim();
          } catch (err) {
            console.error("Failed to fetch content:", err);
            return null;
          }
        }
        function openRemoteLink(dropboxURL) {
          getRemoteLink(dropboxURL).then(content => {
            if (content) {
              if (content.includes("@") && !content.startsWith("mailto:")) {
                const mailtoLink = "mailto:" + content;
                window.location.href = mailtoLink;
              } else {
                const popup = window.open(content, "_blank");
                if (!popup) {
                  showModal('webShareError', 'يرجى السماح بفتح النوافذ المنبثقة.');
                }
              }
            } else {
              showModal('webShareError', 'فشل في جلب الرابط من الخادم.');
            }
          });
        }
        // --- END: New Dropbox Link Functions ---

// --- Vibration Function ---
function vibratePhone(duration = 100) { // Increased duration for better feedback
    if ("vibrate" in navigator) {
        try {
            navigator.vibrate(duration);
        } catch (e) {
            console.error("Vibration failed:", e);
        }
    }
}

// This function will be called once the document is ready
function setupVibrationListener() {
    // We use event delegation on the body, in the capture phase (true)
    // to make sure it catches the click before anything can stop it.
    document.body.addEventListener('click', function(event) {
        const target = event.target;
        
        // Check if the clicked element (or its parent) is a button, 
        // a chat history item, or a context menu item.
        if (target.closest('button') || target.closest('.chat-history-item') || target.closest('.context-menu-item')) {
            vibratePhone();
        }
    }, true); 
}
        // --- Helper Functions ---
        function _(key, lang = currentLang) {
            const langPack = translations[lang] || translations['ar-PS'];
            const fallbackPack = translations['ar-PS'];
            const keys = key.split('.');
            let val = langPack;
            for (const k of keys) {
                if (val && typeof val === 'object' && k in val) {
                    val = val[k];
                } else {
                    let fallbackVal = fallbackPack;
                    for (const fk of keys) {
                        if (fallbackVal && typeof fallbackVal === 'object' && fk in fallbackVal) {
                            fallbackVal = fallbackVal[fk];
                        } else { return key; }
                    }
                    return typeof fallbackVal === 'string' || typeof fallbackVal === 'object' ? fallbackVal : key;
                }
            }
            return (typeof val === 'string' || typeof val === 'object') ? val : key;
        }

        function setBotPositionBasedOnLanguage() {
            const isRTL = currentLang.startsWith('ar');
            let targetY, targetX;
            if (isRTL) {
                targetY = `7%`;
                targetX = `57%`;
            } else { 
                targetY = `5%`;
                targetX = `60%`;
            }
            document.documentElement.style.setProperty('--bot-gif-y-fixed', targetY);
            document.documentElement.style.setProperty('--bot-gif-x-fixed', targetX);
        }

        function setFixedGameElementPositions() {
            document.documentElement.style.setProperty('--game-return-btn-y', '90%');
            document.documentElement.style.setProperty('--game-return-btn-size', '64px');
            document.documentElement.style.setProperty('--game-box-main-width', '95%');
            document.documentElement.style.setProperty('--game-box-main-height', '84%');
            document.documentElement.style.setProperty('--game-box-main-y', '41%');
        }


        function updateAllTexts() {
            const isRTL = currentLang.startsWith('ar');
            dom.html.lang = isRTL ? 'ar' : 'en';
            dom.html.dir = isRTL ? 'rtl' : 'ltr'; 

            document.title = _('pageTitle');

            setBotPositionBasedOnLanguage(); 

            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                el.innerHTML = _(key);
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                el.placeholder = _(el.dataset.translatePlaceholder);
            });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                el.title = _(el.dataset.translateTitle);
            });
            
            const titleHTMLAr = `<span class="font-rakkas title-text-ar">هَــبَــل</span> <span class="font-inter title-text-en">AI</span>`;
            const titleHTMLEn = `<span class="font-rakkas title-text-ar">Wacky</span> <span class="font-inter title-text-en">AI</span>`;
            const titleHTML = isRTL ? titleHTMLAr : titleHTMLEn;

            dom.mainTitle.innerHTML = titleHTML;
            if (dom.gameMainTitle) dom.gameMainTitle.innerHTML = titleHTML;
            
            if (dom.habalLevelBtn) {
                 const habalLevels = _('habalLevels');
                 dom.habalLevelBtn.textContent = habalLevels[currentHabalLevel] || currentHabalLevel;
            }

            const populateSelect = (selectElement, langCode) => {
                if (!selectElement) return;
                selectElement.innerHTML = '';
                const dialects = _(langCode.startsWith('ar') ? 'dialects' : 'dialects', langCode);
                Object.entries(dialects).forEach(([code, name]) => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = name;
                    if (code === currentLang) option.selected = true;
                    selectElement.appendChild(option);
                });
            };
            populateSelect(dom.arabicDialectSelect, 'ar-PS');
            populateSelect(dom.englishDialectSelect, 'en-US');

            if (dom.languagePopupTitleText) {
                 const titleKey = isLanguagePopupForSettings ? 'languageSettingsTitle' : 'languagePopupTitle';
                 const titleText = _(titleKey);
                 dom.languagePopupTitleText.textContent = titleText;
                 dom.languagePopupTitleText.style.display = titleText ? 'block' : 'none';
            }
            if (dom.userInfoModalTitle) {
                 dom.userInfoModalTitle.textContent = _(localStorage.getItem(onboardingStorageKey) === 'true' ? 'enterYourInfo' : 'onboardingUserInfoTitle');
            }
            updateDynamicButtonColors();
            renderPreviousChats();
        }

        function switchVideoImmediately(newTheme) {
            const lightVideo = dom.lightBgVideo;
            const darkVideo = dom.darkBgVideo;
            const videoToPreloadSrcOtherTheme = (newTheme === 'light') ? videoThemes.dark : videoThemes.light;
            const videoToPreloadElementOtherTheme = (newTheme === 'light') ? darkVideo : lightVideo;

            lightVideo.style.transition = 'none';
            darkVideo.style.transition = 'none';

            if (newTheme === 'light') {
                darkVideo.style.display = 'none';
                darkVideo.classList.remove('video-visible'); 
                if (!darkVideo.paused) darkVideo.pause();

                lightVideo.style.display = 'block';
                lightVideo.classList.add('video-visible'); 
                if (lightVideo.paused) lightVideo.play().catch(e => console.warn("Light video play prevented on switch:", e));
            } else { 
                lightVideo.style.display = 'none';
                lightVideo.classList.remove('video-visible');
                if (!lightVideo.paused) lightVideo.pause();

                darkVideo.style.display = 'block';
                darkVideo.classList.add('video-visible');
                if (darkVideo.paused) darkVideo.play().catch(e => console.warn("Dark video play prevented on switch:", e));
            }
            
            setTimeout(() => {
                lightVideo.style.transition = 'opacity 0.6s ease';
                darkVideo.style.transition = 'opacity 0.6s ease';
            }, 50);

            if (videoToPreloadElementOtherTheme.currentSrc !== videoToPreloadSrcOtherTheme || videoToPreloadElementOtherTheme.readyState < 2) {
                videoToPreloadElementOtherTheme.src = videoToPreloadSrcOtherTheme;
                videoToPreloadElementOtherTheme.load();
                if (videoToPreloadElementOtherTheme.paused) {
                     videoToPreloadElementOtherTheme.play().then(() => videoToPreloadElementOtherTheme.pause()).catch(e => {/*ignore*/});
                }
            }
        }


        function applyTheme(themeChoice) {
            const actualTheme = (themeChoice === 'auto')
                ? (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
                : themeChoice;

            dom.body.classList.remove('light', 'dark');
            dom.body.classList.add(actualTheme);
            
            if (dom.appViewContainer.classList.contains('content-visible')) {
                 switchVideoImmediately(actualTheme);
            }

            // MODIFIED: No longer saves theme to localStorage
            currentTheme = themeChoice; 

            dom.themeSettingBtns.forEach(btn => {
                const isActive = btn.dataset.themeSetting === currentTheme;
                btn.classList.toggle('active-setting-btn', isActive);
                 if (isActive) {
                    btn.style.borderColor = actualTheme === 'light' ? 'var(--button-bg-color-light)' : 'var(--button-bg-color-dark)';
                    btn.style.color = actualTheme === 'light' ? 'var(--button-bg-color-light)' : 'var(--button-bg-color-dark)';
                 } else {
                    btn.style.borderColor = '';
                    btn.style.color = '';
                 }
            });

            if (dom.settingsPanelHeader) {
                dom.settingsPanelHeader.style.setProperty('--current-settings-header-solid-bg', actualTheme === 'light' ? 'var(--settings-header-bg-light)' : 'var(--settings-header-bg-dark)');
                dom.settingsPanelHeader.style.backgroundColor = `var(--current-settings-header-solid-bg)`;
                dom.settingsPanelHeader.style.borderColor = actualTheme === 'light' ? 'var(--input-border-light)' : 'var(--input-border-dark)';
            }
            if (dom.closeSettingsBtn && dom.closeSettingsBtn.querySelector('svg')) {
                 dom.closeSettingsBtn.querySelector('svg').style.stroke = actualTheme === 'light' ? 'var(--header-text-color-light)' : 'var(--header-icon-color-dark)';
            }
            updateDynamicButtonColors(); 
        }

        function updateDynamicButtonColors() {
            const isDark = dom.body.classList.contains('dark');
            const btnBg = isDark ? 'var(--button-bg-color-dark)' : 'var(--button-bg-color-light)';
            const btnText = isDark ? 'var(--button-text-color-dark)' : 'var(--button-text-color-light)';
            const titleColor = isDark ? 'var(--button-bg-color-dark)' : 'var(--button-bg-color-light)'; 
            if(dom.initialSendBtn) {
                dom.initialSendBtn.style.backgroundColor = btnBg;
                const initialSendBtnSpan = dom.initialSendBtn.querySelector('span');
                if (initialSendBtnSpan) initialSendBtnSpan.style.color = btnText;
            }
            if(dom.chatSendBtn) dom.chatSendBtn.style.backgroundColor = btnBg;

            [dom.langArabicBtn, dom.langEnglishBtn, dom.confirmArabicDialectBtn, dom.confirmEnglishDialectBtn, dom.popupSaveInfoBtn, dom.confirmHabalLevelBtn, dom.confirmRenameBtn].forEach(btn => {
                if (btn) {
                    btn.style.backgroundColor = btnBg;
                    btn.style.color = btnText;
                }
            });
            
            [dom.cancelLanguagePopupBtn, dom.popupSkipInfoBtn, dom.cancelHabalLevelBtn, dom.cancelRenameBtn].forEach(btn => {
                if (btn) {
                    btn.style.backgroundColor = isDark ? '#4b5563' : '#d1d5db';
                    btn.style.color = isDark ? '#f3f4f6' : '#475569';
                }
            });

            if (dom.customModalButtons) {
                dom.customModalButtons.querySelectorAll('button').forEach(btn => {
                    if (btn.classList.contains('modal-ok-btn')) {
                        btn.style.backgroundColor = btnBg;
                        btn.style.color = btnText;
                    } else if (btn.classList.contains('modal-confirm-btn')) {
                        btn.style.backgroundColor = isDark ? '#dc2626' : '#ef4444'; 
                        btn.style.color = 'white';
                    } else if (btn.classList.contains('modal-cancel-btn')) {
                        btn.style.backgroundColor = isDark ? '#6b7280' : '#9ca3af'; 
                        btn.style.color = 'white';
                    }
                });
            }
            if (dom.returnToInitialViewBtn) {
                dom.returnToInitialViewBtn.style.backgroundColor = titleColor;
            }
        }
        
        function showView(viewName, isLoadedChat = false) {
            const wasGameActive = gameViewActive;
            chatStarted = viewName === 'chat';
            gameViewActive = viewName === 'game';

            if (wasGameActive && !gameViewActive && gameAudio.backgroundMusic && gameAudio.backgroundMusic.state === "started") {
                gameAudio.backgroundMusic.stop();
            }

            dom.initialView.classList.toggle('hidden-animated', chatStarted || gameViewActive);
            dom.chatView.classList.toggle('hidden-animated', !chatStarted || gameViewActive);
            dom.gameView.classList.toggle('hidden-animated', !gameViewActive);
            
            dom.chatInputContainer.style.display = chatStarted ? 'flex' : 'none';
            dom.gameUsageNote.style.display = gameViewActive ? 'block' : 'none';


            if (chatStarted) {
                dom.mainHeader.classList.add('chat-active');
                dom.mainTitle.classList.add('chat-active-title');

                if (dom.mainHeader.parentElement !== dom.appViewContainer || dom.mainHeader.nextElementSibling !== dom.chatView) {
                    if(dom.mainHeader.parentElement) dom.mainHeader.parentElement.removeChild(dom.mainHeader);
                    dom.appViewContainer.insertBefore(dom.mainHeader, dom.chatView);
                }
                if (dom.mainTitleWrapper.parentElement !== dom.mainHeader || dom.mainTitleWrapper.nextElementSibling !== dom.newChatBtn) {
                    if(dom.mainTitleWrapper.parentElement) dom.mainTitleWrapper.parentElement.removeChild(dom.mainTitleWrapper);
                    dom.mainHeader.insertBefore(dom.mainTitleWrapper, dom.newChatBtn);
                }
                dom.mainTitleWrapper.style.textAlign = 'center';
                dom.mainTitleWrapper.style.flexGrow = '1';

                if (!isLoadedChat) {
                   startNewChat(false); 
                }

                dom.chatInput.focus();
                scrollToBottom(dom.chatMessages);

            } else if (!gameViewActive) { // Returning to initial view
                dom.mainHeader.classList.remove('chat-active');
                dom.mainTitle.classList.remove('chat-active-title');
                
                startNewChat(false); 

                if (dom.mainHeader.parentElement !== dom.initialView || dom.mainHeader.nextElementSibling !== dom.initialViewContent) {
                    if(dom.mainHeader.parentElement) dom.mainHeader.parentElement.removeChild(dom.mainHeader);
                    dom.initialView.insertBefore(dom.mainHeader, dom.initialViewContent);
                }
                
                const mainSubtitleEl = dom.initialViewContent.querySelector('#main-subtitle');
                if (dom.mainTitleWrapper.parentElement !== dom.initialViewContent || (mainSubtitleEl && dom.mainTitleWrapper.nextElementSibling !== mainSubtitleEl)) {
                    if(dom.mainTitleWrapper.parentElement) dom.mainTitleWrapper.parentElement.removeChild(dom.mainTitleWrapper);
                    if (mainSubtitleEl) {
                        dom.initialViewContent.insertBefore(dom.mainTitleWrapper, mainSubtitleEl);
                    } else { 
                        dom.initialViewContent.prepend(dom.mainTitleWrapper);
                    }
                }
                dom.mainTitleWrapper.style.textAlign = 'center';
                dom.mainTitleWrapper.style.flexGrow = '0';
                dom.initialInput.focus();
                autoGrowTextarea(dom.initialInput);
            }

            if (gameViewActive) {
                if (dom.gameTitleWrapper.parentElement !== dom.gameViewHeader || (dom.gameNewChatBtn && dom.gameTitleWrapper.nextElementSibling !== dom.gameNewChatBtn) ) {
                    if(dom.gameTitleWrapper.parentElement) dom.gameTitleWrapper.parentElement.removeChild(dom.gameTitleWrapper);
                    if (dom.gameNewChatBtn) {
                        dom.gameViewHeader.insertBefore(dom.gameTitleWrapper, dom.gameNewChatBtn);
                    } else {
                        dom.gameViewHeader.appendChild(dom.gameTitleWrapper);
                    }
                }
                dom.gameTitleWrapper.style.textAlign = 'center';
                dom.gameTitleWrapper.style.flexGrow = '1';
                setFixedGameElementPositions();
            } else {
                if (dom.gameTitleWrapper.parentElement !== dom.gameViewHeader) {
                    if(dom.gameTitleWrapper.parentElement) dom.gameTitleWrapper.parentElement.removeChild(dom.gameTitleWrapper);
                    if (dom.gameNewChatBtn) {
                         dom.gameViewHeader.insertBefore(dom.gameTitleWrapper, dom.gameNewChatBtn);
                    } else {
                        dom.gameViewHeader.appendChild(dom.gameTitleWrapper);
                    }
                }
            }
            
            updateFooterVisibility(isKeyboardVisible);
            handleKeyboardLayoutAdjustments();
        }

        function startNewChat(switchViewToInitial = true) {
            currentChatId = null;
            currentChatMessages = [];
            dom.chatMessages.innerHTML = '<div id="chat-message-spacer" style="flex-grow: 1;"></div>';
            if (switchViewToInitial) {
                showView('initial');
            }
        }
        function toggleSettingsPanel(forceOpen = null) {
            const openState = forceOpen !== null ? forceOpen : !isSettingsPanelOpen;
            if (openState) {
                renderPreviousChats(); 
                dom.settingsPanelContainer.classList.add('open');
                dom.settingsOverlay.classList.add('active');
                isSettingsPanelOpen = true;
                dom.settingsPanelContainer.style.left = '0'; 
            } else {
                dom.settingsPanelContainer.classList.remove('open');
                dom.settingsOverlay.classList.remove('active');
                isSettingsPanelOpen = false;
                dom.settingsPanelContainer.style.left = '-280px';
                hideContextMenu();
            }
        }


        function showPopup(overlayElement) {
            if (!overlayElement) return;
            if (overlayElement === dom.languagePopupOverlay) {
                const titleKey = isLanguagePopupForSettings ? 'languageSettingsTitle' : 'languagePopupTitle';
                const titleText = _(titleKey);
                dom.languagePopupTitleText.textContent = titleText;
                dom.languagePopupTitleText.style.display = titleText ? 'block' : 'none';
                // MODIFICATION: Hide cancel button only during initial onboarding
                const isOnboarding = localStorage.getItem(onboardingStorageKey) !== 'true';
                dom.cancelLanguagePopupBtn.style.display = isOnboarding && !isLanguagePopupForSettings ? 'none' : 'block';
            } else if (overlayElement === dom.userInfoModalOverlay) {
                 dom.userInfoModalTitle.textContent = _(localStorage.getItem(onboardingStorageKey) === 'true' ? 'enterYourInfo' : 'onboardingUserInfoTitle');
            } else if (overlayElement === dom.habalLevelModalOverlay) {
                populateHabalLevelModal();
            }
            overlayElement.classList.remove('popup-hidden');
            overlayElement.classList.add('popup-visible');
            updateDynamicButtonColors();
        }

        function hidePopup(overlayElement) {
            if (!overlayElement) return;
            overlayElement.classList.remove('popup-visible');
            overlayElement.classList.add('popup-hidden');
        }

        function showModal(titleKey, messageKey, buttonsConfig = [{textKey: 'ok', class: 'modal-ok-btn', action: () => {}}]) {
            dom.customModalTitle.innerHTML = _(titleKey);
            const messageContent = messageKey ? _(messageKey) : '';
            dom.customModalMessage.innerHTML = messageContent;

            if (messageContent) {
                dom.customModalMessage.style.display = 'block';
                dom.customModalTitle.style.marginBottom = '0.75rem';
            } else {
                dom.customModalMessage.style.display = 'none';
                dom.customModalTitle.style.marginBottom = '1.25rem';
            }
            
            dom.customModalButtons.innerHTML = '';

            buttonsConfig.forEach(btnConfig => {
                const button = document.createElement('button');
                button.textContent = _(btnConfig.textKey);
                button.className = btnConfig.class || 'modal-ok-btn';
                button.onclick = () => {
                    hidePopup(dom.customModalOverlay);
                    if (btnConfig.action) btnConfig.action();
                };
                dom.customModalButtons.appendChild(button);
            });
            showPopup(dom.customModalOverlay);
        }

        function autoGrowTextarea(element) {
            if (!element) return;
            element.style.height = 'auto';
            let newScrollHeight = element.scrollHeight;
            const maxHeight = parseFloat(getComputedStyle(element).maxHeight) || 150;

            if (element.id === 'initial-input') {
                let currentOffset = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--initial-view-elements-offset').replace('px','')) || 0;
                let prevScrollHeightForDiff = element.dataset.prevScrollHeight ? parseFloat(element.dataset.prevScrollHeight) : initialInputBaseHeight;
                let heightDiff = newScrollHeight - prevScrollHeightForDiff;

                if (newScrollHeight > initialInputBaseHeight) {
                    if (newScrollHeight <= maxHeight) {
                        document.documentElement.style.setProperty('--initial-view-elements-offset', `${currentOffset - (heightDiff * 0.35)}px`);
                    }
                } else {
                     document.documentElement.style.setProperty('--initial-view-elements-offset', `0px`);
                }
                element.dataset.prevScrollHeight = newScrollHeight;

                if (newScrollHeight >= maxHeight) {
                    newScrollHeight = maxHeight;
                    element.style.overflowY = 'auto'; 
                    element.classList.add('custom-scrollbar');
                } else {
                    element.style.overflowY = 'hidden';
                    element.classList.remove('custom-scrollbar');
                }
            } else if (element.id === 'chat-input') {
                 if (newScrollHeight >= maxHeight) {
                    newScrollHeight = maxHeight;
                    element.style.overflowY = 'auto';
                    element.classList.add('custom-scrollbar');
                } else {
                    element.style.overflowY = 'hidden';
                    element.classList.remove('custom-scrollbar');
                }
            }
            element.style.height = newScrollHeight + 'px';
            handleKeyboardLayoutAdjustments(); 
        }

        function scrollToBottom(element) {
            if(element) {
                element.scrollTop = element.scrollHeight;
            }
        }
        function getChatsFromStorage() {
            try {
                const chatsJSON = localStorage.getItem(CHATS_STORAGE_KEY);
                return chatsJSON ? JSON.parse(chatsJSON) : [];
            } catch (e) {
                console.error("Failed to parse chats from localStorage", e);
                localStorage.removeItem(CHATS_STORAGE_KEY);
                return [];
            }
        }

        function saveChatsToStorage(chats) {
             try {
                localStorage.setItem(CHATS_STORAGE_KEY, JSON.stringify(chats));
            } catch (e) {
                console.error("Failed to save chats to localStorage", e);
                showModal('errorOccurred', 'Failed to save chats. Storage might be full.');
            }
        }
        
        function saveCurrentChat() {
            if (currentChatMessages.length === 0) return;

            let chats = getChatsFromStorage();
            
            if (currentChatId) {
                const index = chats.findIndex(c => c.id === currentChatId);
                if (index !== -1) {
                    chats[index].messages = JSON.parse(JSON.stringify(currentChatMessages));
                    chats[index].timestamp = Date.now();
                } else {
                    currentChatId = Date.now();
                    chats.unshift({
                        id: currentChatId,
                        title: _('generatingTitle'),
                        messages: JSON.parse(JSON.stringify(currentChatMessages)),
                        pinned: false,
                        timestamp: currentChatId
                    });
                }
            } else {
                currentChatId = Date.now();
                 chats.unshift({
                    id: currentChatId,
                    title: _('generatingTitle'),
                    messages: JSON.parse(JSON.stringify(currentChatMessages)),
                    pinned: false,
                    timestamp: currentChatId
                });
            }

            if (chats.length > 50) {
                chats = chats.sort((a,b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0) || b.timestamp - a.timestamp).slice(0, 50);
            }

            saveChatsToStorage(chats);
            generateAndSaveTitleForChat(currentChatId);
        }
        
        async function generateAndSaveTitleForChat(chatId) {
            let chats = getChatsFromStorage();
            const chatIndex = chats.findIndex(c => c.id === chatId);
            if (chatIndex === -1) return;

            const chat = chats[chatIndex];
            if (chat.title !== _('generatingTitle') && chat.title !== chat.messages[0]?.text.substring(0, 25)) return;

            const currentChat = chat.messages;

            const titlePrompt = /*--PROMPT_PLACEHOLDER_TITLE_START--*/`أريد منك توليد عنوان مختصر جدًا (من 1 إلى 4 كلمات فقط) يلخص المحادثة التالية بشكل ذكي وواضح. ممنوع استخدام أي رموز خاصة. المحادثة:\n\n${currentChat.map(m => (m.role === 'user' ? 'User' : 'AI') + ": " + m.text).join('\n')}`/*--PROMPT_PLACEHOLDER_TITLE_END--*/; // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
            
            try {
                const titleData = await sendApiRequest(titlePrompt, true);
                let cleanTitle = titleData.response.trim().replace(/["*:\-_.|→⬅️⚠️★]/g, '').replace(/\s+/g, ' ');
                cleanTitle = cleanTitle.split(' ').slice(0, 4).join(" ");
                
                if (!cleanTitle) { 
                    cleanTitle = chat.messages[0].text.substring(0, 25);
                }
                
                chats[chatIndex].title = cleanTitle;
                saveChatsToStorage(chats);
                
                if (isSettingsPanelOpen) {
                    renderPreviousChats();
                }

            } catch (e) {
                console.error("Title generation failed:", e);
            }
        }
        function renderPreviousChats() {
            const chats = getChatsFromStorage();
            const sortedChats = [...chats].sort((a, b) => {
                if (a.pinned !== b.pinned) {
                    return a.pinned ? -1 : 1;
                }
                return (b.timestamp || 0) - (a.timestamp || 0);
            });

            const chatList = dom.previousChatsList;
            chatList.innerHTML = '';

            if (sortedChats.length === 0) {
                chatList.innerHTML = `<p class="text-sm opacity-70 p-4 text-center" data-translate="noPreviousChats">${_('noPreviousChats')}</p>`;
                return;
            }

            sortedChats.forEach(chat => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'chat-history-item';
                itemDiv.dataset.id = chat.id;

                const titleSpan = document.createElement('span');
                titleSpan.className = 'chat-history-title';
                titleSpan.textContent = chat.title || 'محادثة بلا عنوان';
                titleSpan.title = chat.title || 'محادثة بلا عنوان';
                
                itemDiv.appendChild(titleSpan);

                if (chat.pinned) {
                    const iconDiv = document.createElement('div');
                    iconDiv.className = 'pin-icon';
                    iconDiv.innerHTML = pinIconSVG;
                    itemDiv.appendChild(iconDiv);
                }
                
                itemDiv.addEventListener('click', () => {
                    loadChatToView(chat.id);
                });

                itemDiv.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    showContextMenu(e.clientX, e.clientY, itemDiv);
                });

                itemDiv.addEventListener('touchstart', (e) => {
                    clearTimeout(longPressTimer);
                    longPressTimer = setTimeout(() => {
                        longPressTimer = null;
                        const touch = e.touches[0];
                        showContextMenu(touch.clientX, touch.clientY, itemDiv);
                    }, LONG_PRESS_DURATION);
                });

                const clearLongPress = () => clearTimeout(longPressTimer);
                itemDiv.addEventListener('touchend', clearLongPress);
                itemDiv.addEventListener('touchmove', clearLongPress);


                chatList.appendChild(itemDiv);
            });
        }
        
        function loadChatToView(chatId) {
            const chats = getChatsFromStorage();
            const chatToLoad = chats.find(c => c.id === chatId);

            if (!chatToLoad) {
                console.error("Chat not found with ID:", chatId);
                showModal('errorOccurred', 'لم يتم العثور على المحادثة.');
                return;
            }

            currentChatId = chatToLoad.id;
            currentChatMessages = JSON.parse(JSON.stringify(chatToLoad.messages));
            
            showView('chat', true);

            dom.chatMessages.innerHTML = '<div id="chat-message-spacer" style="flex-grow: 1;"></div>';
            
            currentChatMessages.forEach(msg => {
                addChatMessageToDisplay(msg.role, msg.text);
            });
            
            toggleSettingsPanel(false);
        }


        function addChatMessageToDisplay(role, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-bubble');
            messageDiv.textContent = text;

            if (role === 'user') {
                messageDiv.classList.add('chat-bubble-user', 'self-end'); 
            } else {
                messageDiv.classList.add('chat-bubble-ai', 'self-start'); 
            }
            
            const typingIndicator = dom.chatMessages.querySelector('.typing-indicator');
            if (typingIndicator) {
                dom.chatMessages.insertBefore(messageDiv, typingIndicator);
            } else {
                dom.chatMessages.appendChild(messageDiv);
            }
            scrollToBottom(dom.chatMessages);
        }

        function constructChatPrompt(userMessage) {
            const habalLevels = _('habalLevels', 'ar-PS');
            const selectedLevel = localStorage.getItem('habelAiLevelSim') || 'اهبل رسمي';
            
            const personalities = {
                'جدي بس مرح شوي': /*--PROMPT_PLACEHOLDER_LEVEL_1_START--*/`شخصيتك: جادة، محترفة، وذكية، لكن مع لمسة خفيفة من المرح والدعابة في نهاية الردود. استخدم الفكاهة الذكية وغير المباشرة.`/*--PROMPT_PLACEHOLDER_LEVEL_1_END--*/, // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
                'اهبل بس عن ذكاء': /*--PROMPT_PLACEHOLDER_LEVEL_2_START--*/`شخصيتك: تمزج بين الغباء الظاهري والذكاء الخفي. ابدأ الرد بطريقة تبدو ساذجة أو غبية، ثم اختم بملاحظة ذكية أو فلسفية غير متوقعة.`/*--PROMPT_PLACEHOLDER_LEVEL_2_END--*/, // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
                'اهبل رسمي': /*--PROMPT_PLACEHOLDER_LEVEL_3_START--*/`شخصيتك: فكاهية، غريبة الأطوار، وغير متوقعة. ردودك يجب أن تكون مضحكة وعشوائية، مع استخدام التشبيهات الغريبة والنكات غير التقليدية.`/*--PROMPT_PLACEHOLDER_LEVEL_3_END--*/, // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
                'ثقيل دم وسخيف': /*--PROMPT_PLACEHOLDER_LEVEL_4_START--*/`شخصيتك: ساخرة، نقدية، ومستفزة قليلاً. استخدم السخرية اللاذعة والتعليقات الجافة. يمكنك التظاهر بعدم فهم السؤال أو إعطاء إجابات تافهة عن قصد.`/*--PROMPT_PLACEHOLDER_LEVEL_4_END--*/, // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
                'بحب النكت كثير': /*--PROMPT_PLACEHOLDER_LEVEL_5_START--*/`شخصيتك: مرحة، إيجابية، وتحب إلقاء النكات. ابدأ أو اختم ردك بنكتة قصيرة أو تعليق طريف يتعلق بموضوع السؤال.`/*--PROMPT_PLACEHOLDER_LEVEL_5_END--*/ // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
            };

            const systemPrompt = /*--PROMPT_PLACEHOLDER_MAIN_CHAT_START--*/`أنت نموذج ذكاء اصطناعي. ${personalities[selectedLevel]}
تكيّف مع لغة ولهجة المستخدم.

**معلومات المستخدم:** ستُزوَّد بمعلومات عن المستخدم بين قوسين []. استخدم هذه المعلومات لتكييف أسلوبك بذكاء. خاطب المستخدم باسمه من حين لآخر بشكل طبيعي. لا تذكر عمر المستخدم أو جنسه مباشرة أبداً.

**استثناء صارم:** عند الحديث عن "مصطفى حشايكة"، يجب أن تكون نبرة الردود جادة ورسمية تمامًا، دون أي سخرية أو مزاح. لا تذكر اسم "مصطفى حشايكة" أبدًا من تلقاء نفسك، بل فقط إذا تم سؤالك صراحة عنه. حينها، أجب بلهجة رسمية محترمة، واذكر أنه هو مطوّر هذا النموذج.

**قواعد أخرى:**
- لا تذكر أنك تعمل باستخدام Gemini AI أو أي خدمة تابعة لشركة Google، بل تصرف وكأنك نموذج خاص ومستقل.
- لا تبادر بالحديث عن مصطفى إطلاقًا دون أن يُطلب منك ذلك.`/*--PROMPT_PLACEHOLDER_MAIN_CHAT_END--*/; // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
            const userInfo = {
                name: localStorage.getItem("user_name") || "غير محدد",
                age: localStorage.getItem("user_age") || "غير محدد",
                gender: localStorage.getItem("user_gender") || "غير محدد"
            };
            
            const userContext = `[معلومات المستخدم الحالية: الاسم: ${userInfo.name}, العمر: ${userInfo.age}, الجنس: ${userInfo.gender}]`;
            const historyString = currentChatMessages.map(m => `${m.role === 'user' ? 'المستخدم' : 'AI'}: ${m.text}`).join('\n');
            const finalPrompt = `${systemPrompt}\n\n${userContext}\n\n**سجل المحادثة حتى الآن:**\n${historyString}\n\n**الرسالة الجديدة من المستخدم:** "${userMessage}"`;
            
            return finalPrompt;
        }

        function isQuotaExceeded() {
            const resetTimestamp = localStorage.getItem(QUOTA_RESET_TIME_KEY);
            if (resetTimestamp) {
                return parseInt(resetTimestamp, 10) > new Date().getTime();
            }
            return false;
        }

        function triggerQuotaLimit() {
            if (!isQuotaExceeded()) {
                const now = new Date();
                const nextMonth = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth() + 1, 1));
                const resetTimestamp = nextMonth.getTime();
                localStorage.setItem(QUOTA_RESET_TIME_KEY, resetTimestamp);
                startQuotaCountdown(resetTimestamp);
            } else {
                const resetTimestamp = localStorage.getItem(QUOTA_RESET_TIME_KEY);
                startQuotaCountdown(parseInt(resetTimestamp, 10));
            }
        }

        function startQuotaCountdown(resetTimestamp) {
            if (quotaCountdownInterval) {
                clearInterval(quotaCountdownInterval);
            }

            showPopup(dom.quotaModalOverlay);

            const updateTimer = () => {
                const now = new Date().getTime();
                const distance = resetTimestamp - now;

                if (distance <= 0) {
                    clearInterval(quotaCountdownInterval);
                    quotaCountdownInterval = null;
                    localStorage.removeItem(QUOTA_RESET_TIME_KEY);
                    hidePopup(dom.quotaModalOverlay);
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                dom.countdownDays.textContent = String(days).padStart(2, '0');
                dom.countdownHours.textContent = String(hours).padStart(2, '0');
                dom.countdownMinutes.textContent = String(minutes).padStart(2, '0');
                dom.countdownSeconds.textContent = String(seconds).padStart(2, '0');
            };

            updateTimer(); 
            quotaCountdownInterval = setInterval(updateTimer, 1000);
        }
        
        async function sendApiRequest(prompt, bypassQuotaCheck = false) {
            if (!bypassQuotaCheck && isQuotaExceeded()) {
                 triggerQuotaLimit();
                 throw new Error("Quota limit is active. Please wait for the timer to finish.");
            }

            const apiUrl = 'https://gemini-ai-7ki3.onrender.com/api/gemini';
            const requestBody = { prompt };
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody),
            });

            if (!response.ok) {
                const errorText = await response.text();
                const errorMessages = [
                    "Resource has been exhausted", "Quota exceeded", "You exceeded your current quota",
                    "Quota exceeded: TokensPerMonth", "The request was blocked due to quota limits",
                    "Billing account not configured", "Project has exceeded its quota limits"
                ];

                if (!bypassQuotaCheck && errorMessages.some(msg => errorText.includes(msg))) {
                    triggerQuotaLimit();
                    throw new Error("Monthly quota exceeded. The timer has been activated.");
                }

                throw new Error(`خطأ في الشبكة: ${response.status} ${response.statusText}. التفاصيل: ${errorText}`);
            }
            return await response.json();
        }
       
        async function handleChatSubmission(userMessage) {
            if (isQuotaExceeded()) {
                triggerQuotaLimit();
                return;
            }

            addChatMessageToDisplay('user', userMessage);
            currentChatMessages.push({ role: 'user', text: userMessage });
            
            const loadingDiv = document.createElement('div');
            loadingDiv.classList.add('chat-bubble', 'chat-bubble-ai', 'self-start', 'typing-indicator');
            loadingDiv.innerHTML = `<span></span><span></span><span></span>`;
            dom.chatMessages.appendChild(loadingDiv); 
            scrollToBottom(dom.chatMessages);
            
            const fullPrompt = constructChatPrompt(userMessage);
            
            try {
                const data = await sendApiRequest(fullPrompt);
                const aiMessage = data.response;
                loadingDiv.remove(); 
                
                if (aiMessage) {
                    addChatMessageToDisplay('ai', aiMessage);
                    currentChatMessages.push({ role: 'ai', text: aiMessage });
                    saveCurrentChat();
                } else {
                    addChatMessageToDisplay('ai', 'استلمت رداً من الخادم، لكنه فارغ.');
                    currentChatMessages.pop();
                }
            } catch (error) {
                loadingDiv.remove();
                console.error("Chat API Request Error:", error);
                if (!error.message.includes("quota")) {
                    addChatMessageToDisplay('ai', `عفواً، واجهت مشكلة في التواصل مع الخادم. الخطأ: ${error.message}`);
                }
                currentChatMessages.pop();
            }
        }
        function updateFooterVisibility(keyboardIsUp) {
            const activeElIsInput = document.activeElement === dom.initialInput || document.activeElement === dom.chatInput;
            if (keyboardIsUp && activeElIsInput) {
                dom.appFooterContainer.classList.add('keyboard-visible');
                if (dom.newPlaystationButton) dom.newPlaystationButton.classList.add('keyboard-visible');
            } else {
                dom.appFooterContainer.classList.remove('keyboard-visible');
                if (dom.newPlaystationButton) dom.newPlaystationButton.classList.remove('keyboard-visible');
            }
        }

        function handleKeyboardLayoutAdjustments() {
            const chatInputContainerHeight = dom.chatInputContainer.offsetHeight;
            let appViewPaddingBottom = 0;
            let currentFocusedElement = document.activeElement;

            if (chatStarted && currentFocusedElement === dom.chatInput) {
                appViewPaddingBottom = chatInputContainerHeight + 10;
                dom.chatInputContainer.style.bottom = `10px`;
            } else if (!chatStarted && !gameViewActive && currentFocusedElement === dom.initialInput) { 
                dom.chatInputContainer.style.bottom = '0.75rem'; 
                appViewPaddingBottom = 0; 
            } else if (!gameViewActive) { 
                appViewPaddingBottom = chatStarted ? (chatInputContainerHeight + 20) : 0;
                dom.chatInputContainer.style.bottom = '0.75rem';
            } else { 
                appViewPaddingBottom = 0; 
            }
            dom.appViewContainer.style.paddingBottom = `${appViewPaddingBottom}px`;
            if (chatStarted) scrollToBottom(dom.chatMessages);
        }

        async function executeWebShare(platform) {
            let title;
            let dropboxUrl;

            if (platform === 'ios') {
                title = _('shareTitleIOS');
                dropboxUrl = 'https://dl.dropbox.com/scl/fi/tf3xaynje3r1vbpamq5x1/.txt?rlkey=c88luxk1n9y0n40ss6y1k5rnf&st=w0apowua&dl=0';
            } else if (platform === 'android') {
                title = _('shareTitleAndroid');
                dropboxUrl = 'https://dl.dropbox.com/scl/fi/luyo1h3lwea2k5zgka3sc/.txt?rlkey=klg45akk059zhmbl16mwr4kuk&st=69ult4d7&dl=0';
            } else {
                 title = _('shareTitleDefault');
                 dropboxUrl = null;
            }

            const finalUrl = dropboxUrl ? await getRemoteLink(dropboxUrl) : window.location.href;

            if (!finalUrl) {
                showModal('errorOccurred', 'فشل في جلب رابط المشاركة.');
                return;
            }

            const shareData = { title: title, text: _('shareText'), url: finalUrl };

            if (navigator.share) {
                navigator.share(shareData).catch((err) => {
                     console.error("Web Share API error:", err);
                     showModal('webShareError', 'فشلت عملية المشاركة. حاول مرة أخرى.');
                });
            } else {
                showModal('webShareNotSupportedTitle', 'webShareNotSupportedMessage');
            }
        }
        function startOnboardingIfNeeded() {
            if (localStorage.getItem(onboardingStorageKey) !== 'true') {
                isLanguagePopupForSettings = false;
                showPopup(dom.languagePopupOverlay);
            }
        }

        function handleLanguageConfirmedForOnboarding() {
            if (localStorage.getItem(onboardingStorageKey) !== 'true') {
                dom.userInfoModalTitle.textContent = _('onboardingUserInfoTitle');
                showPopup(dom.userInfoModalOverlay);
            }
        }
        function showGenericInfoModal(titleKey, textKey) {
            dom.genericInfoModalTitle.textContent = _(titleKey);
            dom.genericInfoModalText.innerHTML = _(textKey).replace(/\n/g, '<br>');
            showPopup(dom.genericInfoModalOverlay);
            toggleSettingsPanel(false);
        }
        
        function showInterstitialAd(onAdClosedCallback) {
            if (typeof onAdClosedCallback === 'function') {
                onAdClosedCallback();
            }
        }
        function populateHabalLevelModal() {
            dom.habalLevelOptions.innerHTML = '';
            const habalLevels = _('habalLevels');
            const habalLevelKeysInArabic = Object.keys(translations['ar-PS'].habalLevels);

            habalLevelKeysInArabic.forEach(hKey => {
                const button = document.createElement('button');
                button.dataset.level = hKey;
                button.textContent = habalLevels[hKey];
                button.classList.toggle('active-level', hKey === tempHabalLevel);
                button.onclick = () => {
                    tempHabalLevel = hKey;
                    dom.habalLevelOptions.querySelectorAll('button').forEach(btn => {
                        btn.classList.toggle('active-level', btn.dataset.level === tempHabalLevel);
                    });
                };
                dom.habalLevelOptions.appendChild(button);
            });
        }

        function openHabalLevelModal() {
            tempHabalLevel = currentHabalLevel;
            toggleSettingsPanel(false);
            showPopup(dom.habalLevelModalOverlay);
        }

        function confirmHabalLevelSelection() {
            currentHabalLevel = tempHabalLevel;
            localStorage.setItem('habelAiLevelSim', currentHabalLevel);
            updateAllTexts();
            hidePopup(dom.habalLevelModalOverlay);
            showModal('levelSaved', null);
        }
        function showContextMenu(x, y, item) {
            currentContextMenuItem = item;
            dom.chatContextMenu.style.top = `${y}px`;
            dom.chatContextMenu.style.left = `${x}px`;
            dom.chatContextMenu.classList.remove('hidden');

            const chatId = Number(item.dataset.id);
            const chats = getChatsFromStorage();
            const currentChat = chats.find(c => c.id === chatId);

            if (currentChat?.pinned) {
                dom.pinIconWrapper.innerHTML = unpinIconSVG;
                dom.pinOptionText.textContent = _('unpinChat');
            } else {
                dom.pinIconWrapper.innerHTML = pinIconSVG;
                dom.pinOptionText.textContent = _('pinChat');
            }
            
            const deleteOption = dom.deleteChatOption;
            if (dom.body.classList.contains('light')) {
                deleteOption.style.color = '#991b1b';
            } else {
                deleteOption.style.color = '#ef4444';
            }
        }

        function hideContextMenu() {
            if (dom.chatContextMenu) {
                dom.chatContextMenu.classList.add('hidden');
            }
            currentContextMenuItem = null;
        }

        function handleRenameRequest() {
            if (!currentContextMenuItem) return;
            chatIdToRename = Number(currentContextMenuItem.dataset.id);
            const chats = getChatsFromStorage();
            const chat = chats.find(c => c.id === chatIdToRename);
            if (chat) {
                dom.renameInput.value = chat.title;
                showPopup(dom.renameModalOverlay);
                dom.renameInput.focus();
                dom.renameInput.select();
            }
            hideContextMenu();
        }

        function confirmRename() {
            if (chatIdToRename === null || !dom.renameInput.value.trim()) {
                 chatIdToRename = null;
                 return;
            }
            let chats = getChatsFromStorage();
            const chatIndex = chats.findIndex(c => c.id === chatIdToRename);
            if (chatIndex !== -1) {
                chats[chatIndex].title = dom.renameInput.value.trim();
                saveChatsToStorage(chats);
                renderPreviousChats(); 
            }
            hidePopup(dom.renameModalOverlay);
            chatIdToRename = null;
        }

        function togglePinChat() {
            if (!currentContextMenuItem) return;
            const chatId = Number(currentContextMenuItem.dataset.id);
            let chats = getChatsFromStorage();
            const chatIndex = chats.findIndex(c => c.id === chatId);
            if (chatIndex !== -1) {
                chats[chatIndex].pinned = !chats[chatIndex].pinned;
                chats[chatIndex].timestamp = Date.now(); 
                saveChatsToStorage(chats);
                renderPreviousChats();
            }
            hideContextMenu();
        }

        function deleteChat() {
             if (!currentContextMenuItem) return;
            const chatId = Number(currentContextMenuItem.dataset.id);
            
            showModal(
                'confirmDeleteChatTitle', 
                'confirmDeleteChatMessage',
                [
                    { textKey: 'cancel', class: 'modal-cancel-btn' },
                    { textKey: 'delete', class: 'modal-confirm-btn', action: () => {
                        let chats = getChatsFromStorage();
                        const updatedChats = chats.filter(c => c.id !== chatId);
                        saveChatsToStorage(updatedChats);

                        if (currentChatId === chatId) {
                            startNewChat(true); 
                        }
                        renderPreviousChats();
                        showModal('chatDeleted', `<b>${_('chatDeleted')}</b>`);
                    }}
                ]
            );
            hideContextMenu();
        }

        function setupEventListeners() {
            dom.themeSettingBtns.forEach(button => button.addEventListener('click', () => applyTheme(button.dataset.themeSetting)));
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => { if (currentTheme === 'auto') applyTheme('auto'); });
            
            const handleInitialSend = () => {
                if (isQuotaExceeded()) {
                    triggerQuotaLimit();
                    return;
                }
                const message = dom.initialInput.value.trim();
                if (message) {
                    showInterstitialAd(() => {
                        showView('chat');
                        handleChatSubmission(message);
                        dom.initialInput.value = '';
                        autoGrowTextarea(dom.initialInput);
                    });
                } else { showModal('errorOccurred', 'noInput'); }
            };

            dom.initialSendBtn.addEventListener('click', handleInitialSend);
            
            dom.chatInputForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const message = dom.chatInput.value.trim();
                if (message) {
                    handleChatSubmission(message);
                    dom.chatInput.value = '';
                    autoGrowTextarea(dom.chatInput);
                    dom.chatInput.focus();
                }
            });

            [dom.initialInput, dom.chatInput].forEach(textarea => {
                if(textarea) {
                    textarea.addEventListener('input', () => autoGrowTextarea(textarea));
                    textarea.addEventListener('focus', () => { isKeyboardVisible = true; updateFooterVisibility(true); handleKeyboardLayoutAdjustments(); });
                    textarea.addEventListener('blur', () => { setTimeout(() => { if (document.activeElement !== dom.initialInput && document.activeElement !== dom.chatInput) { isKeyboardVisible = false; updateFooterVisibility(false); } handleKeyboardLayoutAdjustments(); }, 200); });
                }
            });
            if (window.visualViewport) window.visualViewport.addEventListener('resize', () => {
                isKeyboardVisible = window.visualViewport.height < window.innerHeight * 0.8;
                updateFooterVisibility(isKeyboardVisible);
                handleKeyboardLayoutAdjustments();
            });

            dom.settingsToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleSettingsPanel(); });
            
            dom.newChatBtn.addEventListener('click', () => { showInterstitialAd(() => { startNewChat(true); }); });
            dom.gameNewChatBtn.addEventListener('click', () => { if (gameAudio.backgroundMusic && gameAudio.backgroundMusic.state === "started") { gameAudio.backgroundMusic.stop(); } showInterstitialAd(() => { startNewChat(true); }); });

            dom.gameSettingsBtn.addEventListener('click', (e) => { e.stopPropagation(); toggleSettingsPanel(); });
            
            dom.closeSettingsBtn.addEventListener('click', () => toggleSettingsPanel(false));
            dom.settingsOverlay.addEventListener('click', () => toggleSettingsPanel(false));
            
            dom.habalLevelBtn?.addEventListener('click', openHabalLevelModal);
            dom.confirmHabalLevelBtn?.addEventListener('click', confirmHabalLevelSelection);
            dom.cancelHabalLevelBtn?.addEventListener('click', () => hidePopup(dom.habalLevelModalOverlay));
            
            dom.languageDialectSettingsBtn?.addEventListener('click', () => { isLanguagePopupForSettings = true; showPopup(dom.languagePopupOverlay); toggleSettingsPanel(false); });
            dom.langArabicBtn?.addEventListener('click', () => {
                dom.dialectSelectionArabic.classList.remove('hidden');
                dom.dialectSelectionEnglish.classList.add('hidden');
                dom.confirmArabicDialectBtn.textContent = _('confirm');
                updateDynamicButtonColors();
            });
            dom.langEnglishBtn?.addEventListener('click', () => {
                dom.dialectSelectionEnglish.classList.remove('hidden');
                dom.dialectSelectionArabic.classList.add('hidden');
                dom.confirmEnglishDialectBtn.textContent = _('confirm', 'en-US');
                updateDynamicButtonColors();
            });
            const handleLangConfirm = (sel) => { currentLang = sel.value; localStorage.setItem('habelAiLangSim', currentLang); updateAllTexts(); hidePopup(dom.languagePopupOverlay); if (!isLanguagePopupForSettings) handleLanguageConfirmedForOnboarding(); isLanguagePopupForSettings = false; };
            dom.confirmArabicDialectBtn?.addEventListener('click', () => handleLangConfirm(dom.arabicDialectSelect));
            dom.confirmEnglishDialectBtn?.addEventListener('click', () => handleLangConfirm(dom.englishDialectSelect));
            dom.cancelLanguagePopupBtn?.addEventListener('click', () => { hidePopup(dom.languagePopupOverlay); if (!isLanguagePopupForSettings && localStorage.getItem(onboardingStorageKey) !== 'true') handleLanguageConfirmedForOnboarding(); isLanguagePopupForSettings = false; });
            
            dom.editUserInfoSettingsBtn?.addEventListener('click', () => { dom.userInfoModalTitle.textContent = _('enterYourInfo'); showPopup(dom.userInfoModalOverlay); toggleSettingsPanel(false); });
            dom.popupSaveInfoBtn?.addEventListener('click', () => { saveUserInfo(); hidePopup(dom.userInfoModalOverlay); if (localStorage.getItem(onboardingStorageKey) !== 'true') localStorage.setItem(onboardingStorageKey, 'true'); });
            dom.popupSkipInfoBtn?.addEventListener('click', () => { hidePopup(dom.userInfoModalOverlay); if (localStorage.getItem(onboardingStorageKey) !== 'true') localStorage.setItem(onboardingStorageKey, 'true'); });
            
            dom.shareAppSettingsBtn?.addEventListener('click', () => { showPopup(dom.shareAppModalOverlay); toggleSettingsPanel(false); });
            dom.closeShareAppModalBtn?.addEventListener('click', () => hidePopup(dom.shareAppModalOverlay));
            dom.shareIosBtn?.addEventListener('click', () => executeWebShare('ios'));
            dom.shareAndroidBtn?.addEventListener('click', () => executeWebShare('android'));
            
            dom.aboutAppBtn?.addEventListener('click', () => showGenericInfoModal('aboutApp', 'aboutAppText'));
            dom.privacyPolicyBtn?.addEventListener('click', () => showGenericInfoModal('privacyPolicy', 'privacyPolicyText'));
            dom.contactUsBtn?.addEventListener('click', () => showGenericInfoModal('contact', 'contactUsText'));
            dom.closeGenericInfoModalBtn?.addEventListener('click', () => hidePopup(dom.genericInfoModalOverlay));
            
            [dom.customModalOverlay, dom.shareAppModalOverlay, dom.genericInfoModalOverlay, dom.habalLevelModalOverlay, dom.renameModalOverlay, document.getElementById('rating-modal-overlay'), dom.quotaModalOverlay].forEach(overlay => {
                if (overlay) overlay.addEventListener('click', function(e) { if (e.target === this) hidePopup(this); });
            });
            // MODIFICATION: Prevent closing language/user info popups during onboarding
            [dom.languagePopupOverlay, dom.userInfoModalOverlay].forEach(overlay => {
                if(overlay) overlay.addEventListener('click', function(e) {
                    const isOnboarding = localStorage.getItem(onboardingStorageKey) !== 'true';
                    if (e.target === this && !isOnboarding) {
                        hidePopup(this);
                    }
                });
            });
            
            dom.newPlaystationButton?.addEventListener('click', () => {
                if (isQuotaExceeded()) {
                    triggerQuotaLimit();
                    return;
                }
                showInterstitialAd(() => { showView('game'); initGame(); });
            });
            dom.returnToInitialViewBtn?.addEventListener('click', () => {
                if (gameAudio.backgroundMusic && gameAudio.backgroundMusic.state === "started") {
                    gameAudio.backgroundMusic.stop();
                }
                showInterstitialAd(() => { showView('initial'); });
            });

            dom.renameChatOption.addEventListener('click', (e) => { e.preventDefault(); handleRenameRequest(); });
            dom.pinChatOption.addEventListener('click', (e) => { e.preventDefault(); togglePinChat(); });
            dom.deleteChatOption.addEventListener('click', (e) => { e.preventDefault(); deleteChat(); });
            
            dom.confirmRenameBtn.addEventListener('click', confirmRename);
            dom.cancelRenameBtn.addEventListener('click', () => hidePopup(dom.renameModalOverlay));
            dom.renameInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); confirmRename(); }});

            dom.quotaCloseBtn?.addEventListener('click', () => hidePopup(dom.quotaModalOverlay));

            window.addEventListener('click', (e) => { if (dom.chatContextMenu && !dom.chatContextMenu.contains(e.target) && !e.target.closest('.chat-history-item')) { hideContextMenu(); } });
            window.addEventListener('scroll', hideContextMenu, true);


            handleKeyboardLayoutAdjustments();
        }

        async function warmUpServer() {
            try {
                await sendApiRequest("مرحبا", true);
                console.log("Server is warm and ready.");
            } catch (error) {
                console.warn("Server warm-up failed, first request might be slow.", error.message);
            }
        }

        function startLoadingProcess() {
            dom.pageLoader.classList.remove('hide');
            dom.appViewContainer.classList.remove('content-visible');
            let initialPref = 'dark';
            if (currentTheme === 'light' || (currentTheme === 'auto' && window.matchMedia('(prefers-color-scheme: light)').matches)) {
                initialPref = 'light';
            }
            dom.body.classList.add(initialPref);
            const primaryVid = initialPref === 'light' ? dom.lightBgVideo : dom.darkBgVideo;
            const secondaryVid = initialPref === 'light' ? dom.darkBgVideo : dom.lightBgVideo;
            primaryVid.src = videoThemes[initialPref];
            secondaryVid.src = videoThemes[initialPref === 'light' ? 'dark' : 'light'];
            let progress = 0;
            const progInterval = setInterval(() => {
                progress += Math.random() * 8 + 2;
                if (progress > 100) progress = 100;
                dom.loaderProgressBar.style.width = progress + '%';
                if (progress >= 100) clearInterval(progInterval);
            }, 120);
            primaryVid.addEventListener('loadeddata', () => {
                clearInterval(progInterval);
                dom.loaderProgressBar.style.width = '100%';
                primaryVid.style.display = 'block';
                secondaryVid.style.display = 'none';
                if (primaryVid.paused) primaryVid.play().catch(e => {});
                secondaryVid.load();
                if(secondaryVid.paused) secondaryVid.play().then(() => secondaryVid.pause()).catch(e => {});
                setTimeout(() => {
                    dom.pageLoader.classList.add('hide');
                    dom.appViewContainer.classList.add('content-visible');
                    primaryVid.classList.add('video-visible');
                    applyTheme(currentTheme);
                    updateAllTexts();
                    setupEventListeners();
                   setupVibrationListener(); setFixedGameElementPositions();
                    if (dom.initialInput) {
                        dom.initialInput.style.height = 'auto';
                        initialInputBaseHeight = dom.initialInput.scrollHeight > 0 ? dom.initialInput.scrollHeight : 44;
                        autoGrowTextarea(dom.initialInput);
                    }
                    showView('initial');
                    startOnboardingIfNeeded();
                    handleKeyboardLayoutAdjustments();
                    updateFooterVisibility(false);
                    warmUpServer();
                    
                    if (isQuotaExceeded()) {
                        triggerQuotaLimit();
                    }
                    
                }, 300);
            });
            primaryVid.load();
        }
        
        let gameInitialized = false;
        function initGame() {
            if (gameInitialized) {
                 const resetEvent = new CustomEvent('resetGame');
                document.dispatchEvent(resetEvent);
                if (gameAudio.backgroundMusic && gameAudio.backgroundMusic.state !== "started" && !gameAudio.backgroundMusic.mute) {
                    gameAudio.backgroundMusic.start();
                }
                return;
            }
            const ui = {
                questionContent: document.getElementById('question-content'),
                questionText: document.getElementById('question-text'),
                optionsContainer: document.getElementById('options-container'),
                score: document.getElementById('score'),
                wrongCount: document.getElementById('wrong-count'),
                totalQuestions: document.getElementById('total-questions'),
                nextQuestionBtn: document.getElementById('next-question-btn'),
                loadingState: document.getElementById('loading-state'),
                loadingText: document.getElementById('loading-text'),
                messageModal: document.getElementById('message-modal'),
                messageText: document.getElementById('message-text'),
                closeModalBtn: document.getElementById('close-modal-btn'),
                explanationModal: { overlay: document.getElementById('explanation-modal-overlay'), content: document.getElementById('explanation-modal-content'), title: document.getElementById('explanation-modal-title'), text: document.getElementById('explanation-modal-text'), closeBtn: document.getElementById('explanation-modal-close-btn') },
                gifContainer: document.getElementById('gif-movable-container'),
                audio: { musicMuteBtn: document.getElementById('mute-music-btn'), musicOnIcon: document.getElementById('music-on-icon'), musicOffIcon: document.getElementById('music-off-icon'), sfxMuteBtn: document.getElementById('mute-sfx-btn'), sfxOnIcon: document.getElementById('sfx-on-icon'), sfxOffIcon: document.getElementById('sfx-off-icon') },
                infoButton: document.getElementById('info-button'),
                infoModal: document.getElementById('info-modal'),
                infoCloseBtn: document.getElementById('info-close'),
                resetGameBtn: document.getElementById('reset-game-btn')
            };
            let state = { wrongCount: 0, totalQuestions: 0, score: 0, answerSelected: false, currentCorrectAnswer: '', currentExplanation: ''};
            
            ui.infoButton?.addEventListener('click', () => ui.infoModal.style.display = 'flex');
            ui.infoCloseBtn?.addEventListener('click', () => ui.infoModal.style.display = 'none');
            ui.closeModalBtn?.addEventListener('click', () => ui.messageModal.style.display = 'none');
            async function setupSoundsAndMusic() {
                if (Tone.context.state !== 'running') {
                    await Tone.start();
                }
                if (!gameAudio.correct) {
                    gameAudio.correct = new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 } }).toDestination();
                }
                if (!gameAudio.incorrect) {
                    gameAudio.incorrect = new Tone.Synth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.1 }, volume: -6 }).toDestination();
                }
                if (!gameAudio.click) {
                    gameAudio.click = new Tone.PluckSynth({ attackNoise: 1, dampening: 4000, resonance: 0.7, volume: -10 }).toDestination();
                }
                if (!gameAudio.backgroundMusic) {
                    gameAudio.backgroundMusic = new Tone.Player({ url: "https://dl.dropbox.com/scl/fi/b1eyzsizryhnucx42hl7t/No-Copyright-Background-Music-Chill-Relaxing-Summer-Vlog-Guitar-Hip-Hop-Track-True-by-Moavii.mp3?rlkey=ek64b0ebb8foh3yyphc02gza8&st=rbizv40q&dl=0", loop: true, autostart: false, volume: -12 }).toDestination();
                }
                 const isMusicMuted = gameAudio.backgroundMusic.mute;
                if(ui.audio.musicOnIcon) ui.audio.musicOnIcon.classList.toggle('hidden', isMusicMuted);
                if(ui.audio.musicOffIcon) ui.audio.musicOffIcon.classList.toggle('hidden', !isMusicMuted);
                
                if (!isMusicMuted && gameAudio.backgroundMusic.state !== 'started') {
                    await Tone.loaded(); 
                    gameAudio.backgroundMusic.start();
                }
            }
            function showMessageModal(message, isError = false) { if(ui.messageText) ui.messageText.textContent = message; if(ui.messageModal) ui.messageModal.style.display = 'flex'; }
            function showExplanationModal(explanation, isIncorrect = false) { if(!ui.explanationModal.overlay) return; ui.explanationModal.text.innerHTML = explanation; ui.explanationModal.title.classList.toggle('error', isIncorrect); ui.explanationModal.closeBtn.classList.toggle('error', isIncorrect); ui.explanationModal.overlay.style.display = 'flex'; setTimeout(() => ui.explanationModal.content.classList.add('visible'), 10); }
            function hideExplanationModal() { if(!ui.explanationModal.overlay) return; ui.explanationModal.content.classList.remove('visible'); setTimeout(() => ui.explanationModal.overlay.style.display = 'none', 200); }
            function displayQuestion(questionData) {
                state.answerSelected = false; state.totalQuestions++; ui.totalQuestions.textContent = state.totalQuestions; ui.questionText.textContent = questionData.question;
                ui.optionsContainer.innerHTML = '';
                (questionData.options || []).forEach(optionText => { const button = document.createElement('button'); button.textContent = optionText; button.classList.add('btn', 'btn-option'); button.addEventListener('click', () => handleOptionClick(button, optionText)); ui.optionsContainer.appendChild(button); });
                state.currentCorrectAnswer = questionData.correctAnswer; state.currentExplanation = questionData.explanation; hideExplanationModal();
                ui.nextQuestionBtn.disabled = true; ui.nextQuestionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                ui.loadingState.style.display = 'none'; ui.questionContent.classList.remove('hidden'); if (ui.gifContainer) ui.gifContainer.classList.add('visible');
            }
            function handleOptionClick(buttonEl, selectedAnswer) {
                if (state.answerSelected) return; state.answerSelected = true; if (gameAudio.click && !gameAudio.click.mute) gameAudio.click.triggerAttackRelease("C5", "16n", Tone.now());
                const wasCorrect = (selectedAnswer === state.currentCorrectAnswer);
                ui.optionsContainer.querySelectorAll('.btn-option').forEach(btn => { btn.disabled = true; if (btn.textContent === state.currentCorrectAnswer) btn.classList.add('correct'); else if (btn.textContent === selectedAnswer) btn.classList.add('incorrect'); });
                if (wasCorrect) { state.score++; ui.score.textContent = state.score; if (gameAudio.correct && !gameAudio.correct.mute) gameAudio.correct.triggerAttackRelease("C5", "0.2", Tone.now()); } 
                else { state.wrongCount++; ui.wrongCount.textContent = state.wrongCount; if (gameAudio.incorrect && !gameAudio.incorrect.mute) gameAudio.incorrect.triggerAttackRelease("C3", "0.2", Tone.now()); }
                showExplanationModal(state.currentExplanation, !wasCorrect); ui.nextQuestionBtn.disabled = false; ui.nextQuestionBtn.classList.remove('opacity-50', 'cursor-not-allowed'); if (ui.gifContainer) ui.gifContainer.classList.remove('visible');
            }
            async function fetchAIQuestion() {
                if(!ui.questionContent) return;
                ui.questionContent.classList.add('hidden'); hideExplanationModal(); if (ui.gifContainer) ui.gifContainer.classList.remove('visible');
                ui.loadingState.style.display = 'flex'; ui.loadingText.textContent = _(state.totalQuestions > 0 ? "gameLoadingNew" : "gameLoadingFirst");
                ui.nextQuestionBtn.disabled = true; ui.nextQuestionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                
                const dialectInstruction = `**اللهجة:** استخدم اللهجة التالية: ${_('dialects')[currentLang]}.`;

                const detailedPrompt = /*--PROMPT_PLACEHOLDER_GAME_START--*/`أنت منشئ أسئلة محترف ومبدع للعبة "لعبة الهبل الذكية AI". مهمتك هي إنشاء سؤال واحد متنوع في كل مرة، يجمع بين الفكاهة، الذكاء، والمراوغة.\n\n**أنماط الأسئلة المطلوبة (نوّع بينها):**\n\n1.  **نمط الحزازير والألغاز:** أسئلة تعتمد على التلاعب بالألفاظ أو المنطق الملتوي.\n2.  **نمط المواقف الساخرة:** أسئلة تصف موقفًا شائعًا (اجتماعي، تقني، حيواني) وتسخر منه بطريقة ذكية.\n\n**قواعد صارمة عليك اتباعها دائمًا:**\n\n1.  ${dialectInstruction}\n2.  **التناسق اللغوي (قاعدة أساسية لا يمكن كسرها):** حافظ على تناسق تام في الصياغة بين السؤال والخيارات. إذا كان السؤال بصيغة المفرد ("شو يعمل أحمد؟")، يجب أن تكون الخيارات بصيغة المفرد ("يهرب"، "يواجه"). إذا كان السؤال بصيغة الجمع ("ليش الناس بحبوا؟")، يجب أن تكون الخيارات بصيغة الجمع.\n3.  **التفسير:** يجب أن يكون بالصيغة التالية بالضبط: ابدأ بـ "الجواب الصحيح هو: [نص الجواب الصحيح]". ثم أكمل الشرح بأسلوب فكاهي وذكي باللهجة العامية، ويمكنك استخدام الإيموجي المناسب. لا تستخدم الأقواس نهائيًا.\n\n**أمثلة لتسترشد بها على الأنماط والقواعد:**\n---\n**مثال (نمط الموقف الساخر):**\n- سؤال: ليش الكمبيوتر بعلّق أحيانًا لما يكون عندك موعد مهم؟\n- خيارات: ["لأنك ما دعيت له بالصبح", "لأنه بيحس بالتوتر", "لأنك مش محدّث الويندوز", "لأنه بيعرف توقيت المصائب"]\n- جواب صحيح: "لأنه بيعرف توقيت المصائب"\n- تفسير: "الجواب الصحيح هو: لأنه بيعرف توقيت المصائب. الكمبيوتر دايمًا بيقرر يخونك لما تحتاجه، وكأنه متفاهم مع الحظ السيء 💻🔥"\n---\n**مثال (نمط الحزيرة مع التناسق):**\n- سؤال: إذا الجيران كانوا جايين على أحمد وبدهم يضربوه، شو يعمل؟\n- خيارات: ["يهرب", "يواجهم", "يتخبى", "يعمل حاله إنه جاي معهم"]\n- جواب صحيح: "يعمل حاله إنه جاي معهم"\n- تفسير: "الجواب الصحيح هو: يعمل حاله إنه جاي معهم. أحسن طريقة للنجاة هي التحالف مع العدو، يمكن يفكروه واحد منهم ويتركوه 😂"\n---\n\n📌 الآن، أنشئ سؤالًا جديدًا تمامًا مع الالتزام الصارم بكل هذه القواعد، مع التنويع في نمط السؤال. تذكر أن تخرج البيانات ككائن JSON صالح بهذه البنية الدقيقة: {"question": "...", "options": ["...", "...", "...", "..."], "correctAnswer": "...", "explanation": "..."}.`/*--PROMPT_PLACEHOLDER_GAME_END--*/; // (مفتاح البرومبت ممنوع لمسه او التعديل عليه ما لم يُطلب ذالك)
                
                try {
                    const result = await sendApiRequest(detailedPrompt);
                    if (!result || !result.response) {
                        throw new Error("استجابة الخادم غير صالحة أو فارغة.");
                    }
                    
                    let newQuestion;
                    try {
                        const jsonMatch = result.response.match(/\{[\s\S]*\}/);
                        if (!jsonMatch) throw new Error("لم يتم العثور على كائن JSON صالح في الرد.");
                        newQuestion = JSON.parse(jsonMatch[0]);

                    } catch (e) {
                        console.error("Game JSON Parse Error:", e);
                        console.error("Received response that failed to parse:", result.response);
                        throw new Error("لم يتمكن من فهم رد الخادم للعبة (فشل تحليل JSON).");
                    }
                    
                    if (typeof newQuestion.question !== 'string' || !Array.isArray(newQuestion.options) || newQuestion.options.length === 0 || typeof newQuestion.correctAnswer !== 'string' || typeof newQuestion.explanation !== 'string') {
                         throw new Error("تنسيق بيانات اللعبة من الخادم غير صحيح.");
                    }

                    displayQuestion(newQuestion);
                    
                } catch (error) {
                    console.error("Game API Fetch Error:", error);
                    if (!error.message.includes("quota")) {
                        showMessageModal(`ما زبط نجيب الحزّيرة: ${error.message}`, true);
                        ui.loadingText.textContent = "فشلت العملية. حاول مرة أخرى.";
                        ui.nextQuestionBtn.disabled = false;
                        ui.nextQuestionBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                } 
            }
            function resetGame() { 
                state.score = 0; state.wrongCount = 0; state.totalQuestions = 0; 
                ui.score.textContent = state.score; 
                ui.wrongCount.textContent = state.wrongCount; 
                ui.totalQuestions.textContent = state.totalQuestions; 
                fetchAIQuestion(); 
            }
            function setupGameEventListeners() {
                ui.nextQuestionBtn.addEventListener('click', () => { if (gameAudio.click && !gameAudio.click.mute) gameAudio.click.triggerAttackRelease("C4", "8n", Tone.now()); fetchAIQuestion(); });
                ui.resetGameBtn?.addEventListener('click', () => { if (gameAudio.click && !gameAudio.click.mute) gameAudio.click.triggerAttackRelease("C4", "8n", Tone.now()); resetGame(); });
                ui.audio.musicMuteBtn?.addEventListener('click', () => { 
                    gameAudio.backgroundMusic.mute = !gameAudio.backgroundMusic.mute;
                    const isMuted = gameAudio.backgroundMusic.mute;
                    if (!isMuted && gameAudio.backgroundMusic.state !== 'started') gameAudio.backgroundMusic.start();
                    ui.audio.musicOnIcon.classList.toggle('hidden', isMuted); 
                    ui.audio.musicOffIcon.classList.toggle('hidden', !isMuted); 
                });
                ui.audio.sfxMuteBtn?.addEventListener('click', () => { 
                    gameAudio.correct.mute = !gameAudio.correct.mute;
                    gameAudio.incorrect.mute = !gameAudio.incorrect.mute;
                    gameAudio.click.mute = !gameAudio.click.mute;
                    const isMuted = gameAudio.click.mute;
                    ui.audio.sfxOnIcon.classList.toggle('hidden', isMuted); 
                    ui.audio.sfxOffIcon.classList.toggle('hidden', !isMuted); 
                });
                ui.explanationModal.closeBtn?.addEventListener('click', hideExplanationModal);
                document.addEventListener('resetGame', resetGame);
            }
            async function startGame() { 
                await setupSoundsAndMusic(); 
                setupGameEventListeners(); 
                ui.score.textContent = state.score; 
                ui.wrongCount.textContent = state.wrongCount; 
                ui.totalQuestions.textContent = state.totalQuestions; 
                hideExplanationModal(); 
                if (ui.messageModal) ui.messageModal.style.display = 'none'; 
                fetchAIQuestion(); 
                gameInitialized = true; 
            }
            startGame();
        }
        document.addEventListener('DOMContentLoaded', startLoadingProcess);
        
        document.addEventListener('DOMContentLoaded', () => {
            const ratingBtn = document.getElementById('rating-btn');
            const ratingModalOverlay = document.getElementById('rating-modal-overlay');
            const closeRatingBtn = document.getElementById('close-rating-modal-btn');
            const ratingStars = document.querySelectorAll('.rating-star');
            const submitRatingBtn = document.getElementById('submit-rating-btn');
            if (ratingBtn && ratingModalOverlay) ratingBtn.addEventListener('click', () => { 
                toggleSettingsPanel(false); 
                showPopup(ratingModalOverlay); 
            });
            closeRatingBtn?.addEventListener('click', () => hidePopup(ratingModalOverlay));
            ratingModalOverlay?.addEventListener('click', (e) => { if (e.target === ratingModalOverlay) hidePopup(ratingModalOverlay); });
            ratingStars.forEach(star => star.addEventListener('click', () => { const value = parseInt(star.dataset.value, 10); ratingStars.forEach(s => s.classList.toggle('active', parseInt(s.dataset.value, 10) <= value)); }));
            submitRatingBtn?.addEventListener('click', () => {
                openRemoteLink('https://dl.dropbox.com/scl/fi/luyo1h3lwea2k5zgka3sc/.txt?rlkey=klg45akk059zhmbl16mwr4kuk&st=69ult4d7&dl=0');
            });
        });
        
        function saveUserInfo() {
            const name = document.getElementById("popup-user-name-input").value.trim();
            const age = document.getElementById("popup-user-age-input").value.trim();
            const gender = document.querySelector("input[name='popupUserGender']:checked")?.value;
            if (name && age && gender) {
                localStorage.setItem("user_name", name);
                localStorage.setItem("user_age", age);
                localStorage.setItem("user_gender", gender);
                showModal("userInfoSaved", null);
            } else { showModal("errorOccurred", _('fillAllInfo')); }
        }
        function loadUserInfo() {
            dom.popupUserNamaInput.value = localStorage.getItem("user_name") || "";
            dom.popupUserAgeInput.value = localStorage.getItem("user_age") || "";
            const savedGender = localStorage.getItem("user_gender") || "male";
            if (savedGender === "female") dom.popupGenderFemale.checked = true;
            else if (savedGender === "alien") dom.popupGenderAlien.checked = true;
            else if (savedGender === "other") dom.popupGenderOther.checked = true;
            else dom.popupGenderMale.checked = true;
        }
        window.addEventListener("DOMContentLoaded", () => {
            loadUserInfo();
            dom.popupSaveInfoBtn?.addEventListener("click", saveUserInfo);
        });
    </script>
<script>
window.addEventListener("load", () => {
  fetch("https://gemini-ai-7ki3.onrender.com/api/gemini", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      prompt: "ping فقط لتسخين السيرفر، لا حاجة للرد الحقيقي"
    })
  }).catch(err => {
    console.warn("فشل تسخين الخادم، لكن لا مشكلة:", err);
  });
});
</script>
</body>
</html>
